<group name="MITRE ATT&CK">
<!--
Event to test with /var/ossec/bin/ossec-logtest

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"5145","version":"0","level":"0","task":"12811","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-12-04T12:45:38.962884600Z","eventRecordID":"267092","processID":"4","threadID":"284","channel":"Security","computer":"DESKTOP-D33AN6I","severityValue":"AUDIT_SUCCESS","message":"Se salió de un proceso."},"eventdata":{"subjectUserSid":"S-1-5-21-2635242741-4024004514-10403589-1001","subjectUserName":"Zenidd","subjectDomainName":"DESKTOP-D33AN6I","subjectLogonId":"0x6e03e","ObjectType":"File","IpAddress":"fe80::31ea:6c3c:f40d:1973","IpPort":"56926","ShareName":"\\admin$","ShareLocalPath":"\\??\\C:\\Documents","RelativeTargetName":"5501-WKSTN1-4020-stdout","AccessMask":"0x100081","AccessList":"%%1541 %%4416 %%4423","AccessReason":"%%1541: %%1801 D:(A;;FA;;;WD) %%4416: %%1801 D:(A;;FA;;;WD) %%4423: %%1801 D:(A;;FA;;;WD)"}}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"5142","version":"0","level":"0","task":"12808","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-12-04T12:45:38.962884600Z","eventRecordID":"6273","processID":"4","threadID":"4","channel":"Security","computer":"DESKTOP-D33AN6I","severityValue":"AUDIT_SUCCESS","message":"Se agregó un objeto de recurso compartido de red."},"eventdata":{"subjectUserSid":"S-1-5-21-2635242741-4024004514-10403589-1001","subjectUserName":"IEUser","subjectDomainName":"DESKTOP-D33AN6I","subjectLogonId":"0x128a9","IpAddress":"fe80::31ea:6c3c:f40d:1973","ShareName":"\\*\\PRINT","ShareLocalPath":"c:\\windows\\system32"}}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"4648","version":"0","level":"0","task":"12544","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-12-04T12:45:38.962884600Z","eventRecordID":"433350","processID":"524","threadID":"2668","channel":"Security","computer":"PC01.example.corp","severityValue":"AUDIT_SUCCESS","message":"Se intentó iniciar sesión con credenciales explícitas."},"eventdata":{"subjectUserSid":"S-1-5-21-1587066498-1489273250-1035260531-1106","subjectUserName":"user01","subjectDomainName":"EXAMPLE","subjectLogonId":"0x18a7875","LogonGuid":"{3523b8be-1c1a-a740-a8c3-4cc91a5f3b14}","TargetUserName":"administrator","TargetDomainName":"example","TargetLogonGuid":"{00000000-0000-0000-0000-000000000000}""TargetServerName":"WIN-77LTAPHIQ1R.example.corp","TargetInfo":"WIN-77LTAPHIQ1R.example.corp","ProcessId":"0x44c","ProcessName":"C:\Windows\System32\wbem\WMIC.exe","IpAddress":"-","IpPort":"-"}}}

-->
<!-- LATERAL MOVEMENT -->
<!-- Must config the windows agent to get events 5145 -->
<rule id="100200" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">5145</field>
   <field name="win.eventdata.ShareName">\.*(d\$)|(admin\$)|(c\$)|(C\$)|(ipc\$)|(IPC\$)\.*</field>
   <description>Mitre ATT&CK T1077, Lateral movement, Windows admin shares</description>
   <options>no_full_log</options>
</rule>
<rule id="100201" level="7">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">5142</field>
   <description>Mitre ATT&CK T1105, Lateral movement, Remote File Copy, Net Share drive</description>
   <options>no_full_log</options>
</rule>
<rule id="100202" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4648</field>
   <field name="win.eventdata.ProcessName">C:\\Windows\\System32\\wbem\\WMIC.exe</field>
   <description>Mitre ATT&CK T1021, Lateral movement, Remote services, WMI Remote Access</description>
   <options>no_full_log</options>
</rule>
<!--
{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"4624","version":"2","level":"0","task":"12544","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-12-04T12:45:38.962884600Z","eventRecordID":"10113","processID":"620","threadID":"5596","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"Se inició sesión correctamente en una cuenta."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","subjectUserName":"IEUser","subjectDomainName":"MSEDGEWIN10","subjectLogonId":"0x2e4ce","TargetUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","TargetUserName":"IEUser","TargetDomainName":"MSEDGEWIN10","TargetLogonId":"0x38f87e","LogonType":"9","LogonProcessName":"seclogo","AuthenticationPackageName":"Negotiate","WorkstationName":"-","LogonGuid":"{00000000-0000-0000-0000-000000000000}","TransmittedServices":"-","LmPackageName":"-","KeyLength":"0","ProcessId":"0x1b90","ProcessName":"C:\Windows\System32\svchost.exe","IpAddress":"::1","IpPort":"0","ImpersonationLevel":"%%1833","RestrictedAdminMode":"-","TargetOutboundUserName":"l","TargetOutboundDomainName":"o","VirtualAccount":"%%1843","TargetLinkedLogonId":"0x0","ElevatedToken":"%%1843"}}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"4624","version":"2","level":"0","task":"12544","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-12-04T12:45:38.962884600Z","eventRecordID":"10113","processID":"620","threadID":"5596","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"Se inició sesión correctamente en una cuenta."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","subjectUserName":"-","subjectDomainName":"-","subjectLogonId":"0x0","TargetUserSid":"S-1-5-7","TargetUserName":"ANONYMOUS LOGON","TargetDomainName":"NT AUTHORITY","TargetLogonId":"0x1d12916","LogonType":"3","LogonProcessName":"NtLmSsp","AuthenticationPackageName":"NTLM","WorkstationName":"-","LogonGuid":"{00000000-0000-0000-0000-000000000000}","TransmittedServices":"-","LmPackageName":"NTLM V1","KeyLength":"128","ProcessId":"0x0","ProcessName":"-","IpAddress":"127.0.0.1","IpPort":"59336","ImpersonationLevel":"%%1833"}}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"4703","version":"0","level":"0","task":"13317","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-12-04T12:45:38.962884600Z","eventRecordID":"11983","processID":"4","threadID":"248","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"Se inició sesión correctamente en una cuenta."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","subjectUserName":"IEUser","subjectDomainName":"MSEDGEWIN10","subjectLogonId":"0x342ba","TargetUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","TargetUserName":"IEUser","TargetDomainName":"MSEDGEWIN10","TargetLogonId":"0x342ba","ProcessName":"C:\Users\IEUser\Desktop\x64\mimikatz.exe","ProcessId":"0x8fc","EnabledPrivilegeList":"SeDebugPrivilege","DisabledPrivilegeList":"-"}}}
-->
<!-- PRIVILEGE ESCALATION -->

<rule id="100220" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4624</field>
   <field name="win.eventdata.LogonType">9</field>
   <description>Mitre ATT&CK T1134, Privilege Escalation, Access Token Manipulation, UAC Token Duplication</description>
   <options>no_full_log</options>
</rule>
<rule id="100221" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4624</field>
   <field name="win.eventdata.LogonType">3</field>
   <field name="win.eventdata.TargetUserName">ANONYMOUS LOGON</field>
   <field name="win.eventdata.TargetUserSid">S-1-5-7</field>
   <field name="win.eventdata.IpAddress">127.0.0.1</field>
   <description>Mitre ATT&CK T1134, Privilege Escalation, Access Token Manipulation, Juicy Potatoe</description>
   <options>no_full_log</options>
</rule>
<rule id="100222" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4703</field>
   <field name="win.eventdata.EnabledPrivilegeList">SeDebugPrivilege</field>
   <description>Mitre ATT&CK T1134, Privilege Escalation, Access Token Manipulation, SeDebugPrivilege Enabled</description>
   <options>no_full_log</options>
</rule>

<!--
{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"4624","version":"0","level":"0","task":"12544","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-12-04T12:45:38.962884600Z","eventRecordID":"5315","processID":"480","threadID":"395","channel":"Security","computer":"PC02.example.corp","severityValue":"AUDIT_SUCCESS","message":"Se inició sesión correctamente en una cuenta."},"eventdata":{"subjectUserSid":"S-1-5-18","SubjectUserName":"PC02$","SubjectDomainName":"EXAMPLE", "SubjectLogonId":"0x3e7","TargetUserSid":2S-1-5-21-3583694148-1414552638-2922671848-1000","TargetUserName":"IEUser", "TargetDomainName":"PC02", "TargetLogonId":"0x45120", "LogonType":"10", "LogonProcessName":"User32","AuthenticationPackageName":"Negotiate", "WorkstationName":"PC02", "LogonGuid":"{00000000-0000-0000-0000-000000000000}", "TransmittedServices":"-", "LmPackageName":"-", "KeyLength":"0", "ProcessId":"0x658""ProcessName":"C:\Windows\System32\winlogon.exe", "IpAddress":"127.0.0.1", "IpPort":"49164" }}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"5156","version":"1","level":"0","task":"12810","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-02-13T18:04:01.632120800Z","eventRecordID":"227727","processID":"4","threadID":"56","channel":"Security","computer":"PC01.example.corp","severityValue":"AUDIT_SUCCESS","message":"The Windows Filtering Platform has permitted a connection."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","ProcessID":"3324","Application":"\\device\\harddiskvolume1\\users\\user01\\desktop\\plink.exe","Direction":"%%14593","SourceAddress":"127.0.0.1","SourcePort":"49271","DestAddress":"127.0.0.2","DestPort":"3389","Protocol":"6","FilterRTID":"0","LayerName":"%%14611","LayerRTID":"48","RemoteUserID":"S-1-0-0","RemoteMachineID":"S-1-0-0" }}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"5156","version":"0","level":"0","task":"13826","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-08-05T09:25:03.867961600Z","eventRecordID":"10091","processID":"620","threadID":"1948","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"The Windows Filtering Platform has permitted a connection."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","ProcessID":"4556","Application":"\\device\\harddiskvolume2\\documents\\listener.exe","Direction":"%%14592","SourceAddress":"127.0.0.1","SourcePort":"3333","DestAddress":"10.0.0.100","DestPort":"6667","Protocol":"6","FilterRTID":"70201","LayerName":"%%14610","LayerRTID":"44","RemoteUserID":"S-1-0-0","RemoteMachineID":"S-1-0-0"}}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"5158","version":"0","level":"0","task":"13826","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-08-05T09:25:03.867961600Z","eventRecordID":"10091","processID":"620","threadID":"1948","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"The Windows Filtering Platform has permitted a bind to a local port."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","ProcessId":"4556","Application":"\\device\\harddiskvolume2\\documents\\listener.exe","SourceAddress":"0.0.0.0","SourcePort":"5800","Protocol":"6","FilterRTID":"0","LayerName":"%%14608","LayerRTID":"36" }}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"5156","version":"0","level":"0","task":"13826","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-08-05T09:25:03.867961600Z","eventRecordID":"10091","processID":"620","threadID":"1948","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"The Windows Filtering Platform has permitted a connection."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","ProcessID":"4556","Application":"\\device\\harddiskvolume2\\documents\\listener.exe","Direction":"%%14592","SourceAddress":"127.0.0.1","SourcePort":"3333","DestAddress":"10.0.0.100","DestPort":"5938","Protocol":"6","FilterRTID":"70201","LayerName":"%%14610","LayerRTID":"44","RemoteUserID":"S-1-0-0","RemoteMachineID":"S-1-0-0"}}}

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"5156","version":"0","level":"0","task":"13826","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-08-05T09:25:03.867961600Z","eventRecordID":"10091","processID":"620","threadID":"1948","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"The Windows Filtering Platform has permitted a connection."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","ProcessID":"4556","Application":"\\device\\harddiskvolume2\\documents\\listener.exe","Direction":"%%14592","SourceAddress":"127.0.0.1","SourcePort":"3333","DestAddress":"10.0.0.100","DestPort":"8200","Protocol":"6","FilterRTID":"70201","LayerName":"%%14610","LayerRTID":"44","RemoteUserID":"S-1-0-0","RemoteMachineID":"S-1-0-0"}}}
-->
<!-- COMMAND AND CONTROL -->

<rule id="100240" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4624</field>
   <field name="win.eventdata.LogonType">10</field>
   <field name="win.eventdata.IpAddress">127.0.0.1</field>
   <description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH</description>
   <options>no_full_log</options>
</rule>
<rule id="100241" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">5156</field>
   <field name="win.eventdata.DestPort">3389</field>
   <field name="win.eventdata.SourceAddress">127.0.0.1</field>
   <description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH</description>
   <options>no_full_log</options>
</rule>
<rule id="100242" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">5156</field>
   <field name="win.eventdata.DestPort">6667</field>
   <description>Mitre ATT&CK T1219, Command and Control, Remote Access Tools, IRC Traffic</description>
   <options>no_full_log</options>
</rule>
<rule id="100243" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">5158</field>
   <field name="win.eventdata.SourcePort">5800|5900</field>
   <description>Mitre ATT&CK T1219, Command and Control, Remote Access Tools, VNC Traffic</description>
   <options>no_full_log</options>
</rule>
<rule id="100243" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">5156</field>
   <field name="win.eventdata.DestPort">5938</field>
   <description>Mitre ATT&CK T1219, Command and Control, Remote Access Tools, Teamviewer Traffic</description>
   <options>no_full_log</options>
</rule>
<rule id="100243" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">5156</field>
   <field name="win.eventdata.DestPort">8200</field>
   <description>Mitre ATT&CK T1219, Command and Control, Remote Access Tools, Go2assist/LogMeIn Traffic</description>
   <options>no_full_log</options>
</rule>
<!--

{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"4799","version":"0","level":"0","task":"13826","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-08-05T09:25:03.867961600Z","eventRecordID":"10091","processID":"620","threadID":"1948","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"Se enumeró la pertenencia a grupos locales con seguridad habilitada."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","TargetUserName":"Administrators","TargetDomainName":"Builtin","TargetSid":"S-1-5-32-544","SubjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","SubjectUserName":"IEUser","SubjectDomainName":"MSEDGEWIN10","SubjectLogonId":"0x2e47a","CallerProcessId":"0x5c0","CallerProcessName":"C:\\Windows\\System32\\net1.exe"}}}

-->
<!-- DISCOVERY -->

<rule id="100260" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4799</field>
   <description>Mitre ATT&CK T1087, Discovery, Account Discovery, A security-enabled local group membership was enumerated</description>
   <options>no_full_log</options>
</rule>

<!--
{"win":{"system":{"providerName":"Microsoft-Windows-Security-Auditing","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"4928","version":"0","level":"0","task":"14083","opcode":"0","keywords":"0x8020000000000000","systemTime":"2019-08-05T09:25:03.867961600Z","eventRecordID":"10091","processID":"524","threadID":"1948","channel":"Security","computer":"MSEDGEWIN10","severityValue":"AUDIT_SUCCESS","message":"An Active Directory replica source naming context was established."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","DestinationDRA":"CN=NTDS Settings,CN=DC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=contoso,DC=local","SourceDRA":"CN=NTDS Settings,CN=WIN2012R2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=contoso,DC=local","SourceAddr":"ddec0cff-6ceb-4a59-b13f-1724c38a0970.\\_msdcs.contoso.local","NamingContext":"DC=ForestDnsZones,DC=contoso,DC=local","Options":"368","StatusCode":"0"}}}
-->

<!-- DEFENSE EVASION -->
<!-- Detailed Directory Service Replication Auditing must be enabled -->
<rule id="100280" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4928|4929</field>
   <description>Mitre ATT&CK T1207, Defense Evasion, DCShadow, Check if the source of events is not a legitimate domain controller</description>
   <options>no_full_log</options>
</rule>
</group>

<!-- PERSISTENCE -->
<rule id="100300" level="10">
   <if_sid>60103</if_sid>
   <field name="win.system.eventID">4756</field>
   <description>Mitre ATT&CK T1098, Persistence,  A member was added to a security-enabled universal group</description>
   <options>no_full_log</options>
</rule>

