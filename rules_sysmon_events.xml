<group name="MITRE ATT&CK_sysmon">

	<!-- GENERAL RULES 100100-->
	<!--
	<ProcessCreate onmatch="include">
	   <Image condition="end with">rundll32.exe</Image>
	</ProcessCreate>
	-->
	<rule id="100100" level="0">
		<if_group>sysmon_event1</if_group>	   
		<field name="win.eventdata.Image">\\rundll32.exe</field>
		<description>Mitre ATT&CK T1085, Rundll32,</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<ParentImage condition="end with">mshta.exe</ParentImage>
	</ProcessCreate>
	-->
	<rule id="100101" level="0">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.parentImage">\\mshta.exe</field>
	   <description>Mitre ATT&CK T1170, Microsoft HTML Application execution</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<ParentImage condition="end with">WINWORD.exe</ParentImage>
		<ParentImage condition="end with">EXCEL.exe</ParentImage>
		<ParentImage condition="end with">POWERPNT.exe</ParentImage>
		<ParentImage condition="end with">MSPUB.exe</ParentImage>
		<ParentImage condition="end with">VISIO.exe</ParentImage>
	</ProcessCreate>
	-->
	<rule id="100102" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentImage">\\WINWORD.EXE||\\EXCEL.EXE||\\POWERPNT.exe||\\MSPUB.exe||\\VISIO.exe</field>
		<description>Mitre ATT&CK T1059, MS Word - Ms EXCEL run</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<CreateRemoteThread onmatch="include">
		<TargetImage condition="is">C:\Windows\system32\lsass.exe</TargetImage>
	</CreateRemoteThread>
	-->
	<rule id="100103" level="0">
		<if_group>sysmon_event8</if_group>
		<field name="win.eventdata.TargetImage">\\lsass.exe</field>
		<description>Mitre ATT&CK S0121, Credential Access</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<NetworkConnect onmatch="include">
		<Image condition="end with">rundll32.exe</Image>
	</NetworkConnect>
	-->
	<rule id="100104" level="0">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.image">rundll32.exe</field>
		<description>Mitre ATT&CK T1085, Rundll32 Internet Connection</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<Image condition="end with">certutil.exe</Image>
	</ProcessCreate>
	-->
	<rule id="100105" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">certutil.exe</field>
		<description>Mitre ATT&CK S0160, Detetcs a suspicious Microsoft certutil execution with sub commands</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<ParentImage condition="contains">cscript.exe</Image>
		<ParentImage condition="contains">wscript.exe</Image>
	</ProcessCreate>
	-->
	<rule id="100106" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\wscript.exe||\\cscript.exe</field>
		<description>Mitre ATT&CK T1059, Execution , Command-Line Interface, wscript/cscript.exe</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<Image condition="end with">regsvr32.exe</Image>
	</ProcessCreate>
	-->
	<rule id="100107" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\regsvr32.exe</field>
		<description>Mitre ATT&CK T1117, Execution, Regsvr32</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<Image condition="end with">wmic.exe</Image>
	</ProcessCreate>
	-->
	<rule id="100108" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\wmic.exe</field>
		<description>>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, Detects WMI execution</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<Image condition="end with">bitsadmin.exe</Image>
	</ProcessCreate>
	-->
	<rule id="100109" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">bitsadmin.exe</field>
		<description>Mitre ATT&CK T1197,  Defense Evasion, BITS Jobs</description>
		<options>no_full_log</options>
	</rule>
	
	<!--
	<ProcessCreate onmatch="include">
		<ParentImage condition="end with">mmc.exe</Image>
	</ProcessCreate>
	-->
	<rule id="100110" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\mmc.exe</field>
		<description>Mitre ATT&CK T1175, Lateral Movement, Component Object Model and Distributed COM</description>
		<options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!-- NEW RULES FOR SYSMON 19,20,21 EVENTS (101600)-->

	<rule id="101601" level="0">
		<if_sid>18100</if_sid>
		<match>Microsoft-Windows-Sysmon/Operational: INFORMATION(19)</match>
		<description>Sysmon - Event 19</description>
		<group>sysmon_event_19,</group>
	</rule>
	<rule id="101602" level="0">
		<if_sid>18100</if_sid>
		<match>Microsoft-Windows-Sysmon/Operational: INFORMATION(20)</match>
		<description>Sysmon - Event 20</description>
		<group>sysmon_event_20,</group>
	</rule>
	<rule id="101603" level="0">
		<if_sid>18100</if_sid>
		<match>Microsoft-Windows-Sysmon/Operational: INFORMATION(21)</match>
		<description>Sysmon - Event 21</description>
		<group>sysmon_event_21,</group>
	</rule>
	<rule id="101604" level="0">
		<if_sid>18100</if_sid>
		<match>Microsoft-Windows-Sysmon/Operational: INFORMATION(22)</match>
		<description>Sysmon - Event 22</description>
		<group>sysmon_event_22,</group>
	</rule>

	<rule id="101605" level="0">
		<if_sid>61600</if_sid>
		<field name="win.system.eventID">^19$</field>
		<description>Sysmon - Event 19: WmiEventFilter</description>
		<options>no_full_log</options>
		<group>sysmon_event_19,</group>
	</rule>
	<rule id="101606" level="0">
		<if_sid>61600</if_sid>
		<field name="win.system.eventID">^20$</field>
		<description>Sysmon - Event 20: WmiEventConsumer</description>
		<options>no_full_log</options>
		<group>sysmon_event_20,</group>
	</rule>
	<rule id="101607" level="0">
		<if_sid>61600</if_sid>
		<field name="win.system.eventID">^21$</field>
		<description>Sysmon - Event 21: WmiEventConsumerToFilter</description>
		<options>no_full_log</options>
		<group>sysmon_event_21,</group>
	</rule>
	<rule id="101608" level="0">
		<if_sid>61600</if_sid>
		<field name="win.system.eventID">^22$</field>
		<description>Sysmon - Event 22: DNS Query</description>
		<options>no_full_log</options>
		<group>sysmon_event_22,</group>
	</rule>

	<!------------------------------------------------------------------------------------------------------------------------------->
	<!--
	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"3","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Network connection detected."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-05-14 01:29:00.318","ProcessGuid":"{365abb72-19e0-5cda-0000-001006711000}","ProcessId":"1932","Image":"C:\\Windows\\System32\\mshta.exe","User":"IEWIN7\\IEUser","Protocol":"tcp","Initiated":"false","SourceIsIpv6":"false","SourceIp":"10.0.2.16","SourceHostname":"IEWIN7","SourcePort":"49168","SourcePortName":"","DestinationIsIpv6":"false","DestinationIp":"10.0.2.17","DestinationHostname":"","DestinationPort":"55683","DestinationPortName":""}}}
	-->
	<!-- LATERAL MOVEMENT 100500-->
	<!--
	<NetworkConnect onmatch="include">
	   <Image condition="image">mshta.exe</Image>
	</NetworkConnect>
	-->
	<rule id="100501" level="12">
	   <if_group>sysmon_event3</if_group>
	   <field name="win.eventdata.Image">\\mshta.exe</field>
	   <description>Mitre ATT&CK T1175, Lateral Movement, Component Object Model and Distributed COM, LethalHTA</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	 <ProcessCreate onmatch="include">
		<ParentImage condition="end with">wsmprovhost.exe</ParentImage>
	 </ProcessCreate>
	--> 
	<rule id="100502" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.ParentImage">\\wsmprovhost.exe</field>
		<description>Mitre ATT&CK T1028, Lateral Movement, Windows Remote Management, Powershell remoting wsmprovhost</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	 <ProcessCreate onmatch="include">
		<ParentImage condition="contains">WinrsHost.exe</ParentImage>
	 </ProcessCreate>
	--> 
	<rule id="100503" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.ParentImage">\.*WinrsHost.exe\.*</field>
		<description>Mitre ATT&CK T1028, Lateral Movement, Windows Remote Management, Host Process for WinRM's Remote Shell plugin</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains">*\certutil.exe *-urlcache* http*</CommandLine>
		<CommandLine condition="contains">*\certutil.exe *-urlcache* ftp*</CommandLine>
		<CommandLine condition="contains">*\certutil.exe *-URL*</CommandLine>
		<CommandLine condition="contains">*\certutil.exe *-ping*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100504" level="12">
		<if_sid>100105</if_sid>
		<field name="win.eventdata.commandline">URL||urlcache||ping</field>
		<description>Mitre ATT&CK T1105, Lateral Movement, Remote File Copy, Detetcs a suspicious Microsoft certutil execution with sub commands</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<ParentImage condition="end with">mmc.exe</ParentImage>
	</ProcessCreate>
	-->
	<rule id="100505" level="12">
		<if_sid>100110</if_sid>
		<field name="win.eventdata.image">\\cmd.exe||\\powershell.exe</field>
		<description>Mitre ATT&CK T1175, Lateral Movement, Component Object Model and Distributed COM, Processes started by MMC could by a sign of lateral movement using MMC application COM object</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains">*transport=dt_socket,address=*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100506" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.commandline">transport=dt_socket,address=</field>
		<description>Mitre ATT&CK T1210, Lateral Movement , Exploitation of Remote Services, Detects a JAVA process running with remote debugging allowing more than just localhost to connect</description>
		<options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!-- PRIVILEGE ESCALATION 100600-->
	<!--
	<RegistryEvent onmatch="include">
	   <TargetObject condition="is">HKU\*\exefile\shell\runas\command\IsolatedCommand</TargetObject>
	</RegistryEvent>
	-->
	<rule id="100601" level="12">
	   <if_group>sysmon_event_13</if_group>
	   <field name="win.eventdata.TargetObject">HKU\\\.*\\exefile\\shell\\runas\\command\\IsolatedCommand</field>
	   <description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control,  Fileless UAC Bypass using sdclt.exe</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<RegistryEvent onmatch="include">
	   <TargetObject condition="is">HKU\*\ms-settings\shell\open\command\DelegateExecute</TargetObject>
	   <TargetObject condition="is">HKU\*\ms-settings\shell\open\command\(Default)</TargetObject>
	   <TargetObject condition="is">HKU\*\ms-settings\shell\open\command</TargetObject>
	</RegistryEvent>
	-->
	<rule id="100602" level="12">
	   <if_group>sysmon_event_13</if_group>
	   <field name="win.eventdata.TargetObject">HKU\\\.*\\ms-settings\\shell\\open\\command\\DelegateExecute|HKU\\\.*\\ms-settings\\shell\\open\\command\\(Default)|HKU\\\.*\\ms-settings\\shell\\open\\command</field>
	   <description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control,  UAC Bypass – Fodhelper - UACME 33</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	 <ProcessCreate onmatch="include">
		<ParentCommandLine condition="is">C:\Windows\System32\eventvwr.exe</ParentCommandLine>
	 </ProcessCreate>
	--> 
	<rule id="100603" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.ParentCommandLine">C:\\Windows\\System32\\eventvwr.exe</field>
		<description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control, Fileless UAC Bypass Using eventvwr.exe</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<FileCreate onmatch="include">
	   <TargetFilename condition="contains">*\AppData\Local\Temp\comctl32.dll</TargetFilename>
	</FileCreate>
	-->
	<rule id="100604" level="12">
	   <if_group>sysmon_event_11</if_group>
	   <field name="win.eventdata.TargetFilename">\.*\\AppData\\Local\\Temp\\comctl32.dll</field>
	   <description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 22</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<FileCreate onmatch="include">
	   <TargetFilename condition="contains">*\AppData\Local\Temp\dismcore.dll</TargetFilename>
	</FileCreate>
	-->
	<rule id="100605" level="12">
	   <if_group>sysmon_event_11</if_group>
	   <field name="win.eventdata.TargetFilename">\.*\\AppData\\Local\\Temp\\dismcore.dll</field>
	   <description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 23</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<FileCreate onmatch="include">
	   <TargetFilename condition="contains">*\AppData\Local\Temp\wow64log.dll</TargetFilename>
	</FileCreate>
	-->
	<rule id="100606" level="12">
	   <if_group>sysmon_event_11</if_group>
	   <field name="win.eventdata.TargetFilename">\.*\\AppData\\Local\\Temp\\wow64log.dll</field>
	   <description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 32</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<FileCreate onmatch="include">
	   <TargetFilename condition="contains">*\AppData\Local\Temp\mscoree.dll</TargetFilename>
	</FileCreate>
	-->
	<rule id="100607" level="12">
	   <if_group>sysmon_event_11</if_group>
	   <field name="win.eventdata.TargetFilename">\.*\\AppData\\Local\\Temp\\mscoree.dll</field>
	   <description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 36</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<FileCreate onmatch="include">
	   <TargetFilename condition="contains">*\AppData\Local\Temp\GdiPlus.dll</TargetFilename>
	</FileCreate>
	-->
	<rule id="100608" level="12">
	   <if_group>sysmon_event_11</if_group>
	   <field name="win.eventdata.TargetFilename">\.*\\AppData\\Local\\Temp\\GdiPlus.dll</field>
	   <description>Mitre ATT&CK T1088, Privilege Escalation, Bypass User Account Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 37</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	 <ProcessCreate onmatch="include">
		<ParentCommandLine condition="contains">\\.\pipe</ParentCommandLine>
	 </ProcessCreate>
	--> 
	<rule id="100609" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.CommandLine">\.*\\\\.\\pipe\.*</field>
		<description>Mitre ATT&CK T1055, Privilege Escalation, Process Injection, NamedPipeImpersonation</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
	<CommandLine condition="contains">*cmstp.exe*/au*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100610" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.CommandLine">\.*cmstp.exe /au\.*</field>
	   <description>Mitre ATT&CK T1088,  Privilege Escalation, Bypass User Account Control, CMSTP bypass user account control</description>
	   <options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!--
	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"3","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Network connection detected."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-05-02 14:48:51.664","ProcessGuid":"{365abb72-0244-5ccb-0000-00109ae70b00}","ProcessId":"1508","Image":"C:\\Windows\\System32\\svchost.exe","User":"IEWIN7\\IEUser","Protocol":"tcp","Initiated":"true","SourceIsIpv6":"false","SourceIp":"10.0.2.15","SourceHostname":"IEWIN7.home","SourcePort":"3389","SourcePortName":"","DestinationIsIpv6":"false","DestinationIp":"127.0.0.1","DestinationHostname":"","DestinationPort":"443","DestinationPortName":"https"}}}
	-->
	<!-- COMMAND AND CONTROL 100700-->
	<!--
	Must change sysmon configuration to include TargetObject in section
	<NetworkConnect onmatch="include">
	   <DestinationIp condition="is">127.0.0.1</DestinationPort>
	   <DestinationIp condition="is">::1</DestinationPort>
	</NetworkConnect>
	-->
	<rule id="100701" level="12">
	   <if_group>sysmon_event3</if_group>
	   <field name="win.eventdata.SourceIp">127.\.*|::1</field>
	   <field name="win.eventdata.DestinationIp">127.\.*|::1</field>   
	   <description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include TargetObject in section
	<NetworkConnect onmatch="include">
	   <DestinationPort condition="is">3389</DestinationPort>
	</NetworkConnect>
	-->
	<rule id="100702" level="12">
	   <if_group>sysmon_event3</if_group>
	   <field name="win.eventdata.Image">(\.*)\\w3wp.exe</field>
	   <field name="win.eventdata.DestinationPort">^3389$|^445$</field>
	   <field name="win.eventdata.DestinationIp">127.\.*|::1</field>   
	   <description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP & SMB Tunneling using SECFORCE/Tunna</description>
	   <options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!-- DISCOVERY 100800-->
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains">net*group*</CommandLine>
		<CommandLine condition="contains">net*localgroup*</CommandLine>
		<CommandLine condition="contains">net*view*</CommandLine>
		<CommandLine condition="contains">net*account*</CommandLine>
		<CommandLine condition="contains">net*use*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100801" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\net.exe||\\net1.exe</field>
		<field name="win.eventdata.commandline">group||localgroup||user||view||accounts||use</field>
		<description>Mitre ATT&CK T1087, Discovery, Account Discovery, Detects execution of Net.exe whether suspicious or benign</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains">net*share</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100802" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\net.exe||\\net1.exe</field>
		<field name="win.eventdata.commandline">share</field>
		<description>Mitre ATT&CK T1135, Discovery, Network Share Discovery, Detects execution of Net.exe whether suspicious or benign</description>
		<options>no_full_log</options>
	</rule>
	<rule id="100803" level="12">
		<if_sid>100108</if_sid>
		<field name="win.eventdata.commandline">AntiVirusProduct get||FirewallProduct get</field>
		<description>Mitre ATT&CK T1010, Discovery, Application Window Discovery , Discovery through Windows Management Instrumentation</description>
		<options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!--
	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"12","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Registry object added or deleted."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"Defense Evasion - PowerShell CLM Setting Changed","EventType":"DeleteValue","UtcTime":"2019-05-16 13:10:13.759","ProcessGuid":"{dfae8213-5b49-5cdd-0000-0010ee520500}","ProcessId":"3580","Image":"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","TargetObject":"HKLM\\System\\CurrentControlSet\\Control\\SESSION MANAGER\\Environment\\__PSLockdownPolicy"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"13","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Registry value set."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"technique_id=T1088,technique_name=Bypass User Account Control","EventType":"SetValue","UtcTime":"2019-05-16 14:17:15.758","ProcessGuid":"{dfae8213-70eb-5cdd-0000-0010f66d0a00}","ProcessId":"3788","Image":"C:\\Windows\\system32\\reg.exe","TargetObject":"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\EnableLUA","Details":"DWORD (0x00000000)"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"7","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Image loaded."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"dll side loading","UtcTime":"2019-04-27 15:57:53.509","ProcessGuid":"{365abb72-7c01-5cc4-0000-00102b3e0c00}","ProcessId":"2680","Image":"C:\\Users\\IEUser\\Downloads\\Flash_update.exe","ImageLoaded":"C:\\Windows\\System32\\winmm.dll","FileVersion":"6.1.7600.16385 (win7_rtm.090713-1255)","Description":"MCI API DLL","Product":"Microsoft® Windows® Operating System","Company":"Microsoft Corporation","Hashes":"SHA1=41905C387FA657D91DA8A743ABC04B6C11A38B52,MD5=D5AEFAD57C08349A4393D987DF7C715D,SHA256=C36A45BC2448DF30CD17BD2F8A17FC196FAFB685612CACCEB22DC7B58515C201,IMPHASH=1A7210F2C9930AF9B51025300C67DA77","Signed":"true","Signature":"Microsoft Windows","SignatureStatus":"Valid"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"1","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Process Create."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"technique_id=T1158,technique_name=Hidden Files and DirectoriesHidden Files and Directories","UtcTime":"2019-05-19 17:32:00.478","ProcessGuid":"{dfae8213-9310-5ce1-0000-0010eaba0a00}","ProcessId":"2728","Image":"C:\\Windows\\System32\\attrib.exe","FileVersion":"6.3.9600.16384 (winblue_rtm.130821-1623)","Description":"Attribute Utility","Product":"Microsoft® Windows® Operating System","Company":"Microsoft Corporation","CommandLine":"attrib +h nbtscan.exe","CurrentDirectory":"c:\\ProgramData\\","User":"insecurebank\\Administrator","LogonGuid":"{dfae8213-9133-5ce1-0000-0020cc660500}","LogonId":"0x566cc","TerminalSessionId":"2","IntegrityLevel":"High","Hashes":"SHA1=B71C1331AC5FA214076E5CD5C885712447057B96,MD5=116D463D2F5DBF76F7E2F5C6D8B5D3BB,SHA256=EBE94E294D86C714BED13EF018E70F75C37F8D8259144C0C847637EDC0222ECB,IMPHASH=461A33302E82ED68F1A74C083E27BD02","ParentProcessGuid":"{dfae8213-91cc-5ce1-0000-0010bef40600}","ParentProcessId":"3408","ParentImage":"C:\\Windows\\System32\\cmd.exe","ParentCommandLine":"C:\\Windows\\system32\\cmd.exe"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"1","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Process Create."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-05-23 17:46:04.651","ProcessGuid":"{365abb72-dc5c-5ce6-0000-001066e27200}","ProcessId":"4088","Image":"C:\\Windows\\System32\\netsh.exe","FileVersion":"6.1.7600.16385 (win7_rtm.090713-1255)","Description":"Network Command Shell","Product":"Microsoft® Windows® Operating System","Company":"Microsoft Corporation","CommandLine":"netsh I p a v l=8001 listena=1.2.3.4 connectp=3389 c=1.2.3.5","CurrentDirectory":"c:\\","User":"IEWIN7\\IEUser","LogonGuid":"{365abb72-ce6c-5ce6-0000-002047f30000}","LogonId":"0xf347","TerminalSessionId":"1","IntegrityLevel":"High","Hashes":"SHA1=7DA1852DF83C58841AD35248AD2A20D7FFBB7FA0,MD5=784A50A6A09C25F011C3143DDD68E729,SHA256=661F5D4CE4F0A6CB32669A43CE5DEEC6D5A9E19B2387F22C5012405E92169943,IMPHASH=33B8120C37D7861778989FBFD16214E1","ParentProcessGuid":"{365abb72-dc3e-5ce6-0000-00102bc97200}","ParentProcessId":"712","ParentImage":"C:\\Windows\\System32\\cmd.exe","ParentCommandLine":"C:\\Windows\\system32\\cmd.exe"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"13","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Registry value set."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"technique_id=T1088,technique_name=Bypass User Account Control","EventType":"SetValue","UtcTime":"2019-05-16 14:17:15.758","ProcessGuid":"{dfae8213-70eb-5cdd-0000-0010f66d0a00}","ProcessId":"3788","Image":"C:\\Windows\\system32\\reg.exe","TargetObject":"HKLM\\SOFTWARE\\Microsoft\\PowerShell\\1\\ShellIds\\Microsoft.PowerShell\\ExecutionPolicy","Details":"DWORD (0x00000000)"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"13","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Registry value set."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"technique_id=T1088,technique_name=Bypass User Account Control","EventType":"SetValue","UtcTime":"2019-05-16 14:17:15.758","ProcessGuid":"{dfae8213-70eb-5cdd-0000-0010f66d0a00}","ProcessId":"3788","Image":"C:\\Windows\\system32\\reg.exe","TargetObject":"HKU\\Software\\Microsoft\\Office\\12.0\\PowerPoint\\Security\\AccessVBOM","Details":"DWORD (0x00000000)"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"1","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Process Create."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-05-22 04:02:11.287","ProcessGuid":"{2B86A809-DAD0-5990-0000-0010CE3A9E02}","ProcessId":"3780","Image":"C:\\Windows\\System32\\forfiles.exe","FileVersion":"6.1.7601.17514 (win7sp1_rtm.101119-1850)","Description":"Windows Command Processor","Product":"Microsoft® Windows® Operating System","Company":"Microsoft Corporation","CommandLine":"C:\\Windows\\system32\\forfiles.exe /p c:\\windows\\system32 /m notepad.exe /c calc.exe","CurrentDirectory":"C:\\Windows\\system32\\","User":"domain.local\\windows_user","LogonGuid":"{2B86A809-DAA8-5990-0000-0020F0D19502}","LogonId":"0xf05d","TerminalSessionId":"1","IntegrityLevel":"High","Hashes":"SHA1=EE8CBF12D87C4D388F09B4F69BED2E91682920B5,MD5=AD7B9C14083B52BC532FBA5948342B98,SHA256=17F746D82695FA9B35493B41859D39D786D32B23A9D2E00F4011DEC7A02402AE,IMPHASH=CEEFB55F764020CC5C5F8F23349AB163","ParentProcessGuid":"{365abb72-c9c1-5ce4-0000-00100b222e00}","ParentProcessId":"3156","ParentImage":"C:\\Windows\\explorer.exe","ParentCommandLine":"C:\\Windows\\Explorer.EXE"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"255","version":"3","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"ERROR","message":"Error report"},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","UtcTime":"2019-04-27 00:10:34.254","ID":"DriverCommunication","Description":"Failed to retrieve events - Last error: The i/O operation has been aborted because of either a thread exit or an application request."}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"12","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Registry object added or deleted"},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"technique_id=T1130,technique_name=Install Root Certificate","EventType":"CreateKey","UtcTime":"2019-04-18 16:55:51.245","ProcessGuid":"{365abb72-ac09-5cb8-0000-0010939a0700}","ProcessId":"3192","Image":"C:\\Windows\\Sysmon.exe","TargetObject":"HKLM\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates"}}}
	-->
	<!-- DEFENSE EVASION 100900-->
	<!--
	Must change sysmon configuration to include TargetObject in section
	<RegistryEvent onmatch="include" name="Mitre ATT&CK T1089, Defense Evasion, Disabling Security Tools, Powershell Constrained Language Mode disabled">
	   <TargetObject condition="is">HKLM\System\CurrentControlSet\Control\SESSION MANAGER\Environment\__PSLockdownPolicy</TargetObject>
	</RegistryEvent>
	-->
	<rule id="100901" level="12">
	   <if_group>sysmon_event_12</if_group>
	   <field name="win.eventdata.TargetObject">HKLM\\System\\CurrentControlSet\\Control\\SESSION MANAGER\\Environment\\__PSLockdownPolicy</field>
	   <description>Mitre ATT&CK T1089, Defense Evasion, Disabling Security Tools, Powershell Constrained Language Mode disabled</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include TargetObject in section
	<RegistryEvent onmatch="include">
	   <TargetObject condition="is">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\system\EnableLUA</TargetObject>
	</RegistryEvent>
	-->
	<rule id="100902" level="12">
	   <if_group>sysmon_event_13</if_group>
	   <field name="win.eventdata.TargetObject">HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\EnableLUA</field>
	<!--  YOU CANNOT FILTER ON THE "Details" ATTRIBUTE, DUE TO PERFORMANCE ISSUES 
	   <field name="win.eventdata.Details">DWORD (0x00000000)</field>
	-->   
	   <description>Mitre ATT&CK T1088, Defense Evasion, Bypass User Account Control,  Disabled UAC if Details field has value 0x00000000D</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ImageLoad onmatch="include">
	  <Signed condition="is">false</Signed>
	</ImageLoad>
	-->
	<rule id="100903" level="12">
	   <if_group>sysmon_event7</if_group>
	   <field name="win.eventdata.Signed">false</field>
	   <field name="win.eventdata.ImageLoaded">\.*\.dll$</field>
	   <description>Mitre ATT&CK T1073, Defense Evasion, DLL Side-Loading, DLL not signed loaded</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include TargetObject in section
	<RegistryEvent onmatch="include">
	   <TargetObject condition="is">HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging\EnableScriptBlockLogging</TargetObject>
	</RegistryEvent>
	-->
	<rule id="100904" level="12">
	   <if_group>sysmon_event_13</if_group>
	   <field name="win.eventdata.TargetObject">HKLM\\SOFTWARE\\Wow6432Node\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\\EnableScriptBlockLogging</field>
	<!--  YOU CANNOT FILTER ON THE "Details" ATTRIBUTE, DUE TO PERFORMANCE ISSUES 
	   <field name="win.eventdata.Details">DWORD (0x00000000)</field>
	-->   
	   <description>Mitre ATT&CK T1089, Defense Evasion, Disabling Security Tools, disabled PowerShell Audit Settings if Details field has value 0x00000000</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include CommandLine in section
	<ProcessCreate onmatch="include">
	  <CommandLine condition="contains">attrib +h</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100905" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.CommandLine">\.*attrib +h\.*</field>
	   <description>Mitre ATT&CK T1158, Defense Evasion, Hidden Files and Directories, hiding files via attrib cmdlet</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include CommandLine in section
	<ProcessCreate onmatch="include">
	  <CommandLine condition="contains">*netsh*connectp=3389*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100906" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.CommandLine">\.*netsh\.*connectp=3389\.*</field>
	   <description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Port fordwarding via netsh</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include TargetObject in section
	<RegistryEvent onmatch="include">
	   <TargetObject condition="is">HKLM\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.PowerShell\ExecutionPolicy</TargetObject>
	</RegistryEvent>
	-->
	<rule id="100907" level="12">
	   <if_group>sysmon_event_13</if_group>
	   <field name="win.eventdata.TargetObject">HKLM\\SOFTWARE\\Microsoft\\PowerShell\\1\\ShellIds\\Microsoft.PowerShell\\ExecutionPolicy</field>
	   <description>Mitre ATT&CK T1089, Defense Evasion, Disabling Security Tools, Change in Powershell execution policy</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include TargetObject in section
	<RegistryEvent onmatch="include">
	   <TargetObject condition="is">HKU\*\Software\Microsoft\Office\*\Excel\Security\AccessVBOM</TargetObject>
	   <TargetObject condition="is">HKU\*\Software\Microsoft\Office\*\PowerPoint\Security\AccessVBOM</TargetObject>
	   <TargetObject condition="is">HKU\*\Software\Microsoft\Office\*\Word\Security\AccessVBOM</TargetObject>
	   <TargetObject condition="is">HKU\*\Software\Microsoft\Office\*\Access\Security\AccessVBOM</TargetObject>
	   <TargetObject condition="is">HKU\*\Software\Microsoft\Office\*\Outlook\Security\AccessVBOM</TargetObject>
	</RegistryEvent>
	-->
	<rule id="100908" level="12">
	   <if_group>sysmon_event_13</if_group>
	   <field name="win.eventdata.TargetObject">HHKU\\\.*\\Software\\Microsoft\\Office\\\.*\\Excel|PowerPoint|Word|Access|Outlook\\Security\\AccessVBOM</field>
	   <description>Mitre ATT&CK T1089, Defense Evasion, Disabling Security Tools, Disable Trust access for VBA into Office</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<Image condition="end with">forfiles.exe</Image>
	 </ProcessCreate>
	-->
	<rule id="100909" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.Image">\\forfiles.exe</field>
	   <description>Mitre ATT&CK T1202,  Defense Evasion, Indirect Command Execution, Forfiles Indirect Command Execution</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	Must change sysmon configuration to include CommandLine in section
	<ProcessCreate onmatch="include">
	  <CommandLine condition="contains">*unload*sysmon*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100910" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.Image">\\fltmc.exe</field>
	   <field name="win.eventdata.CommandLine">\.*unload\.*sysmon\.*</field>
	   <description>Mitre ATT&CK T1089, Defense Evasion, Disabling Security Tools, Sysmon driver unloaded via Filter Manager Control Program</description>
	   <options>no_full_log</options>
	</rule>
	<rule id="100911" level="12">
	   <field name="win.system.eventID">^255$</field>
	   <field name="win.eventdata.ID">DriverCommunication</field>
	   <description>Mitre ATT&CK T1089,  Defense Evasion, Disabling Security Tools, Posible sysmon driver unloading</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<RegistryEvent onmatch="include">
	   <TargetObject condition="is">HKLM\SOFTWARE\Policies\Microsoft\SystemCertificates\Root\Certificates</TargetObject>    
	</RegistryEvent>
	-->
	<rule id="100912" level="12">
	   <field name="win.eventdata.TargetObject">HKLM\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates</field>
	   <description>Mitre ATT&CK T1130, Defense Evasion, Install Root Certificate</description>
	   <options>no_full_log</options>
	</rule>
	<rule id="100913" level="12">
		<if_sid>100100</if_sid>
		<field name="win.eventdata.ImageLoaded">\\vaultcli.dll</field>
		<description>Mitre ATT&CK T1064, Defense Evasion, Scripting, Possible Mimikatz Running In-Memory Detection</description>
		<options>no_full_log</options>
	</rule>
	<rule id="100914" level="12">
		<if_sid>100100</if_sid>
		<field name="win.eventdata.ImageLoaded">\\wlanapi.dll</field>
		<description>Mitre ATT&CK T1064, Defense Evasion, Scripting, Possible Mimikatz In-Memory Detection</description>
		<options>no_full_log</options>
	</rule>

	<!-- You can define your own local networks setting vars like local_net_x and creating OR in rule -->
	<var name="local_net_1">192.</var>

	<rule id="100915" level="12">
		<if_sid>100104</if_sid>
		<match>!$local_net_1</match>
		<description>Mitre ATT&CK T1085, Defense Evasion, Rundll32, Detects a rundll32 that communicates with public IP addresses</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains">*\certutil.exe * -decode *</CommandLine>
		<CommandLine condition="contains">*\certutil.exe * -decodehex *</CommandLine>
	</ProcessCreate>
	-->
	<rule id="100916" level="12">
		<if_sid>100105</if_sid>
		<field name="win.eventdata.commandline">decode||decodehex</field>
		<description>Mitre ATT&CK T1140, Defense Evasion, Deobfuscate/Decode Files or Information, Detetcs a suspicious Microsoft certutil execution with sub commands</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<DriverLoad onmatch="include">
		<ImageLoaded condition="contains">\Temp</ImageLoaded>
	</DriverLoad>
	-->
	<rule id="100917" level="12">
		<if_group>sysmon_event6</if_group>
		<field name="win.eventdata.imageLoaded">\\Temp</field>
		<description>Mitre ATT&CK T1014, Defense Evasion, Rootkit, Detects a driver load from a temporary directory</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<Image condition="contains">*\PerfLogs\*</Image>
		<Image condition="contains">*\$Recycle.bin\*</Image>
		<Image condition="contains">*\Intel\Logs\*</Image>
		<Image condition="contains">*\Users\All Users\*</Image>
		<Image condition="contains">*\Users\Default\*</Image>
		<Image condition="contains">*\Users\Public\*</Image>
		<Image condition="contains">*\Users\NetworkService\*</Image>
		<Image condition="contains">*\Windows\Fonts\*</Image>
		<Image condition="contains">*\Windows\Debug\*</Image>
		<Image condition="contains">*\Windows\Media\*</Image>
		<Image condition="contains">*\Windows\IME\*</Image>
		<Image condition="contains">*\Windows\Help\*</Image>
		<Image condition="contains">*\Windows\addins\*</Image>
		<Image condition="contains">*\Windows\repair\*</Image>
		<Image condition="contains">*\Windows\security\*</Image>
		<Image condition="contains">*\RSA\MachineKeys\*</Image>
		<Image condition="contains">*\wwwroot\*</Image>
		<Image condition="contains">*\wmpub\*</Image>
		<Image condition="contains">*\htdocs\*</Image>
		<Image condition="contains">*\Windows\system32\config\systemprofile\*</Image>
	</ProcessCreate>
	-->

	<rule id="100918" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">C:\\PerfLogs\\||C:\\Intel\\Logs\\||C:\\Users\\Default\\||C:\\Users\\Public\\||C:\\Users\\NetworkService\\||C:\\Windows\\Fonts\\C:\\Windows\\Debug\\||C:\\Windows\\Media\\||C:\\Windows\\Help\\||C:\\Windows\\addins\\||C:\\Windows\\repair\\||C:\\Windows\\security\\||\\RSA\\MachineKeys\\||C:\\Windows\\system32\\config\\systemprofile||Recycle.bin</field>
		<description>Mitre ATT&CK T1036, Defense Evasion, Masquerading, Detects process starts of binaries from a suspicious folder</description>
		<options>no_full_log</options>
	</rule>
	<rule id="100919" level="12">
		<if_sid>100109</if_sid>
		<field name="win.eventdata.commandline">/transfer</field>
		<description>Mitre ATT&CK T1197, Defense Evasion, BITS Jobs, Detects usage of bitsadmin downloading a file</description>
		<options>no_full_log</options>
	</rule>
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!--
	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"11","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"File Created."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-03-17 19:10:02.058","ProcessGuid":"{365abb72-9b85-5c8e-0000-0010c4cc1200}","ProcessId":"3576","Image":"C:\\Windows\\system32\\cmd.exe","TargetFilename":"C:\\Windows\\system32\\wermgr.exe","CreationUtcTime":"2019-03-17 19:10:02.058"}}}
	 
	-->
	<!-- PERSISTENCE 101000-->
	<!--
	<FileCreate onmatch="include">
	   <TargetFilename condition="contains">aitagent.exe</TargetFilename>
	   <TargetFilename condition="contains">DiagTrackRunner.exe</TargetFilename>
	   <TargetFilename condition="contains">CompatTelRunner.exe</TargetFilename>
	   <TargetFilename condition="contains">acproxy.dl</TargetFilename>
	   <TargetFilename condition="contains">wsqmcons.exe</TargetFilename>
	   <TargetFilename condition="contains">lpremove.exe</TargetFilename>
	   <TargetFilename condition="contains">srrstr.dll</TargetFilename>
	   <TargetFilename condition="contains">wermgr.exe</TargetFilename>
	   <TargetFilename condition="contains">sdclt.exe</TargetFilename>
	   <TargetFilename condition="contains">appidcertstorecheck.exe</TargetFilename>
	   <TargetFilename condition="contains">AppHostRegistrationVerifier.exe</TargetFilename>
	   <TargetFilename condition="contains">MicTray64.exe</TargetFilename>
	   <TargetFilename condition="contains">usoclient.exe</TargetFilename>
	   <TargetFilename condition="contains">dsregcmd.exe</TargetFilename>
	   <TargetFilename condition="contains">sihclient.exe</TargetFilename>
	   <TargetFilename condition="contains">dimsjob.dll</TargetFilename>
	   <TargetFilename condition="contains">Lracengn.dll</TargetFilename>
	   <TargetFilename condition="contains">HotstartUserAgent.dll</TargetFilename>
	   <TargetFilename condition="contains">MsCtfMonitor.dll</TargetFilename>
	   <TargetFilename condition="contains">PlaySndSrv.dll</TargetFilename>
	   <TargetFilename condition="contains">AdobeARM.exe</TargetFilename>
	   <TargetFilename condition="contains">GoogleUpdate.exe</TargetFilename>
	</FileCreate>
	-->
	<rule id="101001" level="12">
	   <if_group>sysmon_event_11</if_group>
	   <field name="win.eventdata.TargetFilename">(\.*)aitagent.exe|DiagTrackRunner.exe|CompatTelRunner.exe|acproxy.dl|wsqmcons.exe|lpremove.exe|srrstr.dll|wermgr.exe|sdclt.exe|appidcertstorecheck.exe|AppHostRegistrationVerifier.exe|MicTray64.exe|usoclient.exe|dsregcmd.exe|sihclient.exe|dimsjob.dll|Lracengn.dll|HotstartUserAgent.dll|MsCtfMonitor.dll|PlaySndSrv.dll|AdobeARM.exe|GoogleUpdate.exe(\.*)</field>
	   <description>Mitre ATT&CK T1053, Persistence, Scheduled Task, Modification of the program run by a Windows Default Scheduled Task</description>
	   <options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->	
	<!-- INITIAL ACCESS 101100-->
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!-- CREDENTIAL ACCESS 101200-->

	<!--
	<ProcessAccess onmatch="include">
	  <CallTrace condition="contains">dbghelp.dll</CallTrace>
	  <CallTrace condition="contains">dbgcore.dll</CallTrace>
	</ProcessAccess>
	-->
	<rule id="101201" level="12">
	   <if_group>sysmon_event_10</if_group>
	   <if_sid>100103</if_sid>
	   <field name="win.eventdata.CallTrace">\.*dbghelp.dll|dbgcore.dll\.*|</field>
	   <description>Mitre ATT&CK T1003, Credential Access, Credential Dumping , Procdump or Taskmgr - memory dump</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessAccess onmatch="include">
	  <CallTrace condition="contains">mimikatz</CallTrace>
	</ProcessAccess>
	-->
	<rule id="101202" level="12">
	   <if_group>sysmon_event_10</if_group>
	   <if_sid>100103</if_sid>
	   <field name="win.eventdata.CallTrace">\.*mimikatz\.*</field>
	   <description>Mitre ATT&CK T1003, Credential Access, Credential Dumping , Sekursla mimikatz module memory dump</description>
	   <options>no_full_log</options>
	</rule>

	<rule id="101203" level="12">
		<if_sid>100103</if_sid>
		<field name="win.eventdata.startModule">null</field>
		<description>Mitre ATT&CK T1003, Credential Access, Credential Dumping ,Password Dumper Remote Thread in LSASS</description>
		<options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->	
	<!--
	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"11","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"File Created."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-03-17 19:10:02.058","ProcessGuid":"{365abb72-9b85-5c8e-0000-0010c4cc1200}","ProcessId":"3576","Image":"C:\\Windows\\system32\\taskmgr.exe","TargetFilename":"C:\\UsageLogs\\cscript.exe.log","CreationUtcTime":"2019-03-17 19:10:02.058"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"1","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Process Create."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"", "UtcTime":"2019-05-12 13:30:46.213","ProcessGuid":"{365abb72-2006-5cd8-0000-0010a2862300}","ProcessId":"2960","Image":"C:\\Windows\\System32\\rundll32.exe","FileVersion":"6.1.7600.16385 (win7_rtm.090713-1255)","Description":"Windows host process (Rundll32)","Product":"Microsoft® Windows® Operating System","Company":"Microsoft Corporation","CommandLine":"C:\\Windows\\System32\\rundll32.exe ieframe.dll,OpenURL c:\\users\\ieuser\\local\\temp\\ieframe.url","CurrentDirectory":"c:\\Users\\IEUser\\Downloads\\WinPwnage-master\\WinPwnage-master\\","User":"IEWIN7\\IEUser","LogonGuid":"{365abb72-1596-5cd8-0000-0020103a0100}","LogonId":"0x13a10","TerminalSessionId":"1","IntegrityLevel":"High","Hashes":"SHA1=892503B20247B341CFD20DDA5FDACFA41527A087,MD5=C648901695E275C8F2AD04B687A68CE2,SHA256=3FA4912EB43FC304652D7B01F118589259861E2D628FA7C86193E54D5F987670,IMPHASH=239D911DFA7551A8B735680BC39B2238","ParentProcessGuid":"{365abb72-1ff8-5cd8-0000-00102a342000}","ParentProcessId":"1332","ParentImage":"C:\\Python27\\python.exe","ParentCommandLine":"python winpwnage.py -u execute -i 9 -p c:\\Windows\\system32\\cmd.exe"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"1","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Process Create."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-05-28 02:13:52.155","ProcessGuid":"{365abb72-9960-5cec-0000-0010b6981600}","ProcessId":"2432","Image":"C:\\ProgramData\\vshadow.exe","FileVersion":"?","Description":"?","Product":"?","Company":"?","CommandLine":"vshadow.exe -nw -exec=c:\\windows\\System32\\osk.exe c:\\","CurrentDirectory":"c:\\ProgramData\\","User":"IEWIN7\\IEUser","LogonGuid":"{365abb72-82ec-5cec-0000-0020734a0100}","LogonId":"0x14a73","TerminalSessionId":"1","IntegrityLevel":"High","Hashes":"SHA1=D2C61632741A3364487FF9B7522F1A78A9D42401,MD5=B8EF7058D546B78884D469D8B710F1DF,SHA256=1D6C38894DFC5BBF8EFF3FDB11DC91722994C5294A6F576B9449AB3444A8E952,IMPHASH=DFCA9A022C377F6802C040154483A3DC","ParentProcessGuid":"{365abb72-97e9-5cec-0000-0010095b1200}","ParentProcessId":"2364","ParentImage":"C:\\Windows\\System32\\cmd.exe","ParentCommandLine":"C:\\Windows\\system32\\cmd.exe"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"3","version":"2","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Network connection detected."},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-05-02 14:48:51.664","ProcessGuid":"{365abb72-0244-5ccb-0000-00109ae70b00}","ProcessId":"1508","Image":"C:\\Windows\\System32\\regsvr32.exe","User":"IEWIN7\\IEUser","Protocol":"tcp","Initiated":"true","SourceIsIpv6":"false","SourceIp":"10.0.2.15","SourceHostname":"IEWIN7.home","SourcePort":"100150","SourcePortName":"","DestinationIsIpv6":"false","DestinationIp":"192.168.103.121","DestinationHostname":"","DestinationPort":"443","DestinationPortName":"https"}}}

	{"win":{"system":{"providerName":"Microsoft-Windows-Sysmon","providerGuid":"{54849625-5478-4994-a5ba-3e3b0328c30d}","eventID":"1","version":"3","level":"4","task":"11","opcode":"0","keywords":"0x8000000000000000","systemTime":"2019-05-08T02:10:43.487217000","eventRecordID":"202793","processID":"444","threadID":"463","channel":"Microsoft-Windows-Sysmon/Operational","computer":"DC1.insecurebank.local","severityValue":"INFORMATION","message":"Process create"},"eventdata":{"subjectUserSid":"S-1-5-21-3461203602-4096304019-2269080069-1000","RuleName":"","UtcTime":"2019-05-22 04:02:11.287","ProcessGuid":"{2B86A809-DAD0-5990-0000-0010CE3A9E02}","ProcessId":"3780","Image":"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","CommandLine":"C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe\\","CurrentDirectory":"C:\\Users\\Administrator\\", "User":"WIN-VIHPK3T86T7\\Administrator","LogonGuid":"{9ADBFDD8-0C3C-5967-0300-20108FC61600}","LogonId":"0x1403ea","TerminalSessionId":"3","IntegrityLevel":"High","Hashes":"MD5=F6C714F1020F9BBF6A8534AC8AD7662F","ParentProcessGuid":"{9ADAFDC8-0B2A-5927-0000-00106F1E1400}","ParentProcessId":"788","ParentImage":"C:\\Windows\\explorer.exe","ParentCommandLine":"C:\\Windows\\Explorer.EXE"}}}
	-->
	<!-- EXECUTION 101300-->
	<!--
	<FileCreate onmatch="include">
	   <TargetFilename condition="contains">\UsageLogs\cscript.exe.log</TargetFilename>
	   <TargetFilename condition="contains">\UsageLogs\wscript.exe.log</TargetFilename>
	   <TargetFilename condition="contains">\UsageLogs\mshta.log</TargetFilename>
	   <TargetFilename condition="contains">\UsageLogs\wmic.log</TargetFilename>
	   <TargetFilename condition="contains">\UsageLogs\regsvr32.exe.log</TargetFilename>
	   <TargetFilename condition="contains">\UsageLogs\svchost.log</TargetFilename>
	</FileCreate>
	-->
	<rule id="101301" level="12">
	   <if_group>sysmon_event_11</if_group>
	   <field name="win.eventdata.TargetFilename">(\.*)\\UsageLogs\\cscript.exe.log|wscript.exe.log|mshta.log|wmic.log|regsvr32.exe.log|svchost.log(\.*)</field>
	   <description>Mitre ATT&CK T1129, Execution, Execution through Module Load, .NET CLR Usage</description>
	   <options>no_full_log</options>
	</rule>

	<rule id="101302" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*ieframe.dll|url.dll|shdocvw.dll,OpenURL\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101303" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*url.dll, OpenURLA\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101304" level="12">
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.Image">\\rundll32.exe</field>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*url.dll, FileProtocolHandler\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101305" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*zipfldr.dll, RouteTheCall\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101306" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*advpack.dll,RegisterOCX \.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101307" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*pcwutl.dll,LaunchApplication  \.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101308" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*Shell32.dll,Control_RunDLL\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<Image condition="end with">vshadow.exe</Image>
	 </ProcessCreate>
	-->
	<rule id="101309" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.Image">\\vshadow.exe</field>
	   <field name="win.eventdata.CommandLine">\.*vshadow.exe -nw -exec\.*</field>
	   <description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Living off the land Abusing the Volume Shadow for execution</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<NetworkConnect onmatch="include">
	   <Image condition="image">regsvr32.exe</Image>
	</NetworkConnect>
	-->
	<rule id="101310" level="12">
	   <if_group>sysmon_event3</if_group>
	   <field name="win.eventdata.Image">\\regsvr32.exe</field>
	   <description>Mitre ATT&CK T1117, Execution, Regsvr32, Executing Regsvr32 Living off the Land Binaries</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	 <ProcessCreate onmatch="include">
		<Image condition="end with">regsvr32.exe</Image>
	 </ProcessCreate>
	--> 
	<rule id="101311" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.Image">\\regsvr32.exe</field>
	   <field name="win.eventdata.CommandLine">\.*regsvr32\.*/i\.*scrobj.dll</field>
	   <description>Mitre ATT&CK T1117, Execution, Regsvr32, Squiblydoo technique</description>
	   <options>no_full_log</options>
	</rule>

	<rule id="101312" level="12">
	   <if_sid>100101</if_sid>
	   <field name="win.eventdata.Image">\\cmd.exe||\\powershell.exe||\\wscript.exe||\\cscript.exe||\\sh.exe||\\bash.exe||\\reg.exe||\\regsvr32.exe||\\BITSADMIN*</field>
	   <description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Living off the land Microsoft HTML Application command line execution </description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<NetworkConnect onmatch="include">
	   <Image condition="image">certutil.exe</Image>
	</NetworkConnect>
	-->
	<rule id="101313" level="12">
	   <if_group>sysmon_event3</if_group>
	   <field name="win.eventdata.Image">\\certutil.exe</field>
	   <description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Living off the land possible misuse of certutil downloading capabilities</description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101314" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*PowerShdll.dll,main\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Execution of Powershell Without Powershell.exe</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
	   <Image condition="end with">powershell.exe</Image>
	</ProcessCreate>
	-->
	<rule id="101315" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.image">\\powershell.exe||\\.ps1||\\.ps2</field>
	   <description>Mitre ATT&CK T1086, Execution, PowerShell, Powershell or Script Execution: $(win.eventdata.image)</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<NetworkConnect onmatch="include">
	   <Image condition="image">powershell.exe</Image>
	</NetworkConnect>
	-->
	<rule id="101316" level="12">
	   <if_group>sysmon_event3</if_group>
	   <field name="win.eventdata.Image">\\powershell.exe</field>
	   <description>Mitre ATT&CK T1086, Execution, PowerShell, Powershell Execution</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
	   <Image condition="end with">cmd.exe</Image>
	</ProcessCreate>
	-->
	<rule id="101317" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.image">\\cmd.exe</field>
	   <description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Command-Line Interface Execution: $(win.eventdata.image)</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
	<CommandLine condition="contains">*cmstp.exe*/s*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="101318" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.CommandLine">\.*cmstp.exe /s\.*</field>
	   <description>Mitre ATT&CK T1191, Execution, CMSTP, CMSTP code execution - bypass applicatioeven whitelisting</description>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
	<CommandLine condition="contains">*schtasks.exe*/create*c:\users\*</CommandLine>
	<CommandLine condition="contains">*schtasks.exe*/create*c:\programdata\*</CommandLine>
	<CommandLine condition="contains">*schtasks.exe*/create*c:\windows\temp\*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="101319" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.CommandLine">\.*schtasks.exe\.*/create\.*c:\\users\.*|\.*schtasks.exe\.*/create\.* c:\\programdata\.*|\.*schtasks.exe\.*/create\.* c:\\windows\\temp\.*</field>
	   <description>Mitre ATT&CK T1053, Execution, Scheduled Task, Scheduled Task running programs from suspicious locations or scripting utilities</description>
	</rule>
	<!-- Excel.Application (AppId = {00020812-0000-0000-C000-000000000046})
	Word.Application (AppId = {00020906-0000-0000-C000-000000000046})
	Poewrpoint.Application (AppId = {048EB43E-2059-422F-95E0-557DA96038AF})
	Outlook.Application (AppId = {0006F04A-0000-0000-C000-000000000046})
	Visio.Application (AppId = {00021A20-0000-0000-C000-000000000046})
	ShellWindows (AppId = {9BA05972-F6A8-11CF-A42-00A0C90A8F39})
	ShellbrowserWindows (AppId = {c08afd90-f2a1-11d1-8455-00a0c91f3880})
	MMC20.Application (AppId = {7e0423cd-11198-0928-900c-e6d4a52a0715})
	HTML Application (AppId = {40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91})
	WScript.Shell.1(Clsid = {72C24DD5-D70A-438B-8A42-98424B88AFB8})
	Shell.Application.1 (Clsid = {13709620-C279-11CE-A49E-444553540000})
	-->
	<!--
	 <ProcessCreate onmatch="include">
		<Image condition="end with">rundll32.exe</Image>
	 </ProcessCreate>
	--> 
	<rule id="101320" level="12">
	   <if_group>sysmon_event1</if_group>
	   <if_sid>100100</if_sid>
	   <field name="win.eventdata.CommandLine">\.*rundll32.exe\.*{00020812-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{00020906-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{048EB43E-2059-422F-95E0-557DA96038AF}\.*|\.*rundll32.exe\.*{0006F04A-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{00021A20-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{9BA05972-F6A8-11CF-A42-00A0C90A8F39}\.*|\.*rundll32.exe\.*{c08afd90-f2a1-11d1-8455-00a0c91f3880}\.*|\.*rundll32.exe\.*{7e0423cd-11198-0928-900c-e6d4a52a0715}\.*|\.*rundll32.exe\.*{40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91}\.*|\.*rundll32.exe\.*{72C24DD5-D70A-438B-8A42-98424B88AFB8}\.*|\.*rundll32.exe\.*{13709620-C279-11CE-A49E-444553540000}\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Component Object Model and Distributed COM, </description>
	   <options>no_full_log</options>
	</rule>
	<!--
	 <ProcessCreate onmatch="include">
		<Image condition="end with">dllhost.exe</Image>
	 </ProcessCreate>
	--> 
	<rule id="101321" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.Image">\\dllhost.exe</field>
	   <field name="win.eventdata.CommandLine">\.*dllhost.exe\.*{00020812-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{00020906-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{048EB43E-2059-422F-95E0-557DA96038AF}\.*|\.*dllhost.exe\.*{0006F04A-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{00021A20-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{9BA05972-F6A8-11CF-A42-00A0C90A8F39}\.*|\.*dllhost.exe\.*{c08afd90-f2a1-11d1-8455-00a0c91f3880}\.*|\.*dllhost.exe\.*{7e0423cd-11198-0928-900c-e6d4a52a0715}\.*|\.*dllhost.exe\.*{40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91}\.*|\.*dllhost.exe\.*{72C24DD5-D70A-438B-8A42-98424B88AFB8}\.*|\.*dllhost.exe\.*{13709620-C279-11CE-A49E-444553540000}\.*</field>
	   <description>Mitre ATT&CK T1085, Execution, Rundll32, Component Object Model and Distributed COM, </description>
	   <options>no_full_log</options>
	</rule>
	<!--
	 <WmiEvent onmatch="include">
		<Operation condition="is">Created</Operation>
	 </WmiEvent>
	-->
	<rule id="101322" level="12">
	   <if_group>sysmon_event_19</if_group>
	   <field name="win.eventdata.Operation">Created</field>
	   <description>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101323" level="12">
	   <if_group>sysmon_event_20</if_group>
	   <field name="win.eventdata.Operation">Created</field>
	   <description>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101324" level="12">
	   <if_group>sysmon_event_21</if_group>
	   <field name="win.eventdata.Operation">Created</field>
	   <description>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, </description>
	   <options>no_full_log</options>
	</rule>
	<rule id="101325" level="12">
	   <if_sid>100102</if_sid>
	   <field name="win.eventdata.Image">\\cmd.exe||\\powershell.exe||\\wscript.exe||\\cscript.exe||\\sh.exe||\\bash.exe||\\scrcons.exe||\\schtasks.exe||\\regsvr32.exe||\\hh.exe||\\csc.exe</field>
	   <description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Microsoft Office Product Spawning Windows Shell</description>
	   <options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains">*new-object system.net.webclient).downloadstring(*</CommandLine>
		<CommandLine condition="contains">*new-object system.net.webclient).downloadfile(*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="101326" level="12">
		<if_sid>101315</if_sid>
		<field name="win.eventdata.commandline">DownloadString||downloadfile</field>
		<description>Mitre ATT&CK T1086, Execution, PowerShell, PowerShell scripts that download content from the Internet</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains"> -enc </CommandLine>
		<CommandLine condition="contains"> -EncodedCommand </CommandLine>
		<CommandLine condition="contains"> -w hidden </CommandLine>
		<CommandLine condition="contains"> -window hidden </CommandLine>
		<CommandLine condition="contains"> -windowstyle hidden </CommandLine>
		<CommandLine condition="contains"> -noni </CommandLine>
		<CommandLine condition="contains"> -noninteractive </CommandLine>
	</ProcessCreate>
	-->
	<rule id="101327" level="12">
		<if_sid>101315</if_sid>
		<field name="win.eventdata.commandline">EncodedCommand||-w hidden||-window hidden||-windowstyle hidden||-enc||-noni||noninteractive</field>
		<description>Mitre ATT&CK T1086, Execution, PowerShell, Detects suspicious PowerShell invocation command parameters</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<ParentImage condition="end with">control.exe</ParentImage>
	<ProcessCreate
	-->
	<rule id="101328" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\System32\\control.exe</field>
		<field name="win.eventdata.commandline">\\rundll32.exe</field>
		<description>Mitre ATT&CK T1085, Execution, Rundll32, Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits</description>
		<options>no_full_log</options>
	</rule>
	<rule id="101329" level="12">
		<if_sid>100106</if_sid>
		<field name="win.eventdata.Image">\\powershell.exe||\\cmd.exe</field>
		<description>Mitre ATT&CK T1059, Execution , Command-Line Interface, Detects suspicious powershell invocations from interpreters or unusual programs</description>
		<options>no_full_log</options>
	</rule>
	<rule id="101330" level="12">
		<if_sid>100107</if_sid>
		<field name="win.eventdata.commandline">\\Temp</field>
		<description>Mitre ATT&CK T1117, Execution, Regsvr32, Execution of regsvr32.exe from a temporal folder</description>
		<options>no_full_log</options>
	</rule>
	<rule id="101331" level="12">
		<if_sid>100107</if_sid>
		<field name="win.eventdata.parentImage">powershell.exe</field>
		<description>Mitre ATT&CK T1117, Execution, Regsvr32, Execution of powershel through rundll32</description>
		<options>no_full_log</options>
	</rule>
	<!--
	<ProcessCreate onmatch="include">
		<CommandLine condition="contains">vssadmin.exe Delete Shadows</CommandLine>
		<CommandLine condition="contains">vssadmin create shadow /for=*:</CommandLine>
		<CommandLine condition="contains">vssadmin delete shadows /for=*:</CommandLine>
		<CommandLine condition="contains">copy \\?\GLOBALROOT\Device\*\windows\ntds\ntds.dit</CommandLine>
		<CommandLine condition="contains">copy \\?\GLOBALROOT\Device\*\config\SAM</CommandLine>
		<CommandLine condition="contains">reg SAVE HKLM\SYSTEM </CommandLine>
	</ProcessCreate>
	-->
	<rule id="101332" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.commandline">vssadmin create shadow||GLOBALROOT||vssadmin delete shadows||reg SAVE HKLM\\SYSTEM||\\windows\\ntds\\ntds.dit</field>
		<description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Detects suspicious commands that could be related to activity that uses volume shadow copy</description>
		<options>no_full_log</options>
	</rule>
	<rule id="101333" level="12">
		<if_sid>100108</if_sid>
		<field name="win.eventdata.commandline">process call create</field>
		<description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Windows management Instrumentation command execution</description>
		<options>no_full_log</options>
	</rule>	
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!-- COLLECTION 101400-->
	<!--
	<ProcessCreate onmatch="include">
	  <CommandLine condition="contains">*/stext*</CommandLine>
	  <CommandLine condition="contains">*/scomma*</CommandLine>
	</ProcessCreate>
	-->
	<rule id="101401" level="12">
	   <if_group>sysmon_event1</if_group>
	   <field name="win.eventdata.CommandLine">\.*/stext|/scomma\.*</field>
	   <description>Mitre ATT&CK T1056,  Collection, Input Capture, Keylogger abusing NirSoft Tools</description>
	   <options>no_full_log</options>
	</rule>
	
	<!------------------------------------------------------------------------------------------------------------------------------->
	<!-- IMPACT 101500-->
	 <rule id="101501" level="12">
        <if_sid>100108</if_sid>
        <field name="win.eventdata.commandline">shadowcopy delete</field>
        <description>Mitre ATT&CK T1490, Impact, Inhibit System Recovery, Windows Management Instrumentation deleting shadowcopies</description>
		<options>no_full_log</options>
    </rule>
	<rule id="101502" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.commandline">vssadmin.exe Delete Shadows</field>
		<description>Mitre ATT&CK T1490, Impact, Inhibit System Recovery, Windows Management Instrumentation deleting shadowcopies</description>
		<options>no_full_log</options>
	</rule>
</group>

