h1. Firmas

En esta sección se describen las firmas creadas para el IDS Wazuh desglosadas por tactica y técnica específica que se han ido generando.

{{TOC}}

----

h1. Software

----

h2. S0160 - certutil

----

h3. - S0160 - certutil, Detetcs a suspicious Microsoft certutil execution with sub commands

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| S0160 |\2. certutil is a command-line utility that can be used to obtain certificate authority information and configure Certificate Services.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. El uso de la aplicación certutil puede ser aprobechada para fines sospechosos.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4698]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100105" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">certutil.exe</field>
		<description>Mitre ATT&CK S0160, Detetcs a suspicious Microsoft certutil execution with sub commands</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Initial Access

----

h2. T1078 - Valid Accounts

{background:#dddddd}. |\3=.DESCRIPCCIÓN |
|Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.|

----

h3. - T1078.001, Persistence, Valid Accounts: Default Accounts, Guest RID Hijacking

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1078.001 |\2. Adversaries may obtain and abuse credentials of a default account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Default accounts are those that are built-into an OS, such as the Guest or Administrator accounts on Windows systems or default factory/provider set accounts on other types of systems, software, or devices.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio del "Relative Id." del usuario guest para hacerlo pasar por administrador REF. https://pentestlab.blog/2020/02/12/persistence-rid-hijacking/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational | Sysmon_event 13|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101040" level="10">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\SAM\\\\SAM\\\\Domains\\\\Account\\\\Users\\\\000001F5\\\\F</field>
		<description>Mitre ATT&CK T1078.001, Persistence, Valid Accounts: Default Accounts, Guest RID Hijacking</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3.  - T1078.002,  Credential Access, Valid Accounts: Domain Accounts, Kerberos pre-authentication failed

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1078.002 |\2. Adversaries may obtain and abuse credentials of a domain account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. |
{background:#dddddd}. |\3=.EXPLICACIÓN |
|\3. El evento 4771 indica un fallo cuando el centro de distribución de claves falla en la generación de un ticket, esta firma verifica que el status del fallo sea "0x18" que indica que se ha introducido una clave erronea |
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f4f491}. **5** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows|4771]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| [[60104]] | ||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100323" level="5">
		<if_sid>60104</if_sid>
		<field name="win.system.eventID">^4771$</field>
		<field name="win.eventdata.Status">0x18</field>
		<description>Mitre ATT&CK T1078.002, Initial Access, Valid Accounts: Domain Accounts, Kerberos pre-authentication failed</description>
		<options>no_full_log</options>
		<group>pci_dss_10.6.1,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,</group>
	</rule>
</code></pre>

----

h3. - T1078.002,  Initial Access, Valid Accounts: Domain Accounts, Account disabled, expired, locked out.

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1078.002 |\2. Adversaries may obtain and abuse credentials of a domain account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. [1] Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain. Domain accounts can cover users, administrators, and services.[|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento de windows que indica que el usuario ha sido deshabilitado bloqueado o expirado.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **7** |=.  Microsoft-Windows-Security-Auditing | Security event 4769|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100325" level="7">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4769$</field>
		<field name="win.eventdata.Status">^0x12$</field>
		<description>Mitre ATT&CK T1078.002,  Initial Access, Valid Accounts: Domain Accounts, Account $(TargetUserName) disabled, expired, locked out.</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1078.002,  Initial Access, Valid Accounts: Domain Accounts, The user’s password has expired.

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1078.002 |\2. Adversaries may obtain and abuse credentials of a domain account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. [1] Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain. Domain accounts can cover users, administrators, and services.[|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento de windows que indica que la password del usuario ha expirado|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=.  Microsoft-Windows-Security-Auditing | Security event 4769|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100326" level="3">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4769$</field>
		<field name="win.eventdata.Status">^0x17$</field>
		<description>Mitre ATT&CK T1078.002,  Initial Access, Valid Accounts: Domain Accounts, The user’s $(TargetUserName) password has expired.</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1078.002,  initial Access, Valid Accounts: Domain Accounts, The user’s $(TargetUserName) provided a wrong password.

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1078.002 |\2. Adversaries may obtain and abuse credentials of a domain account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. [1] Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain. Domain accounts can cover users, administrators, and services.[|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento de windows que indica que el usuario ha introducido una password erronea|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=.  Microsoft-Windows-Security-Auditing | Security event 4769|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100327" level="3">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4769$</field>
		<field name="win.eventdata.Status">^0x18$</field>
		<description>Mitre ATT&CK T1078.002,  initial Access, Valid Accounts: Domain Accounts, The user’s $(TargetUserName) provided a wrong password</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3.  - T1078.003,  Credential Access, Valid Accounts: Local Accounts, An account failed to log on

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1078.003 |\2. Adversaries may obtain and abuse credentials of a local account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. El evento 4625 indica un fallo de autenticación en windows, en la firma se buscan dos eventos **0xC0000064** - User logon with misspelled or bad user account - **0xC000006A** - User logon with misspelled or bad password - |
{background:#dddddd}. |=. Nivel |=. Origen |=.ID Evento |
|={background:#f4f491}. **5** |=. Microsoft-Windows-Security-Auditing|=.[[Modelo de datos#1.1.Eventos de windows|4625]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| [[60122]] | ||
{background:#dddddd}. |\3.=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100323" level="5">
		<if_sid>60104</if_sid>
		<field name="win.system.eventID">^4771$</field>
		<field name="win.eventdata.Status">0x18</field>
		<description>Mitre ATT&CK T1078.002, Initial Access, Valid Accounts: Domain Accounts, Kerberos pre-authentication failed</description>
		<options>no_full_log</options>
		<group>pci_dss_10.6.1,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,</group>
	</rule>
</code></pre>

----

h3. - T1078 - Valid Accounts, Special groups have been assigned to a new logon

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1078 |\2. Windows Remote Management (WinRM) is the name of both a Windows service and a protocol that allows a user to interact with a remote system (e.g., run an executable, modify the Registry, modify services). It may be called with the winrm command or by any number of programs such as PowerShell.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el inicio de sesión de cuentas asignadas a grupos con permisos especiales |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=.Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4964]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100320" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4964$</field>
		<description>Mitre ATT&CK T1078, Initial Access, Valid Accounts, Special groups have been assigned to a new logon</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Execution

----

h2. T1059 Command and Scripting Interpreter 

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell.|

----

h3. - T1059 - Microsoft Office Product Spawning Windows Shell

----

{background:#dddddd}. |=. ID |\3=. DESCRIPCIÓN |
| T1059 |\3.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3..Esta firma monitoriza la ejecución de código por parte de varias aplicaciones de la suite ofimática **Office**, usa el parámetro **ParentImage** para detectar ejecución de powershell o cmd por parte de binarios de la suite, estos comportamientos suelen estar relacionados con la ejecución de MACROS. REF. https://www.syspanda.com/index.php/2017/10/10/threat-hunting-sysmon-word-document-macro/ punt **4. Macro-enabled Word document** |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=.Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| |  [[#- T1059 - Microsoft Office Product Spawning Windows Shell -2|101325]] ||
{background:#dddddd}. |\3=. CÓDIGO |


 <pre><code class="xml">
	<rule id="100102" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentImage">\\WINWORD.EXE||\\EXCEL.EXE||\\POWERPNT.exe||\\MSPUB.exe||\\VISIO.exe</field>
		<description>Mitre ATT&CK T1059, Command and Scripting Interpreter, MS Word - Ms EXCEL run</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059, Execution, Command and Scripting Interpreter, Microsoft Office Product Spawning Windows Shell

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1059 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza ejecución de comandos derivados de productos de Microsoft Office|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100102]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101325" level="12">
		<if_sid>100102</if_sid>
		<field name="win.eventdata.Image">\\cmd.exe||\\powershell.exe||\\wscript.exe||\\cscript.exe||\\sh.exe||\\bash.exe||\\scrcons.exe||\\schtasks.exe||\\regsvr32.exe||\\hh.exe||\\csc.exe</field>
		<description>Mitre ATT&CK T1059, Execution, Command and Scripting Interpreter, Microsoft Office Product Spawning Windows Shell</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059 - Microsoft Office Product Spawning Windows Shell -2

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma hereda la monitorización de la suite ofimatica **Office** para detectar ejecución de binarios como powershell o cmd entre otros que deriven en comportamientos relacionados con la ejecución de MACROS. REF. https://www.syspanda.com/index.php/2017/10/10/threat-hunting-sysmon-word-document-macro/ punt **4. Macro-enabled Word document** |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| [[#- T1059 - Microsoft Office Product Spawning Windows Shell|100102]] | | |
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101325" level="12">
		<if_sid>100102</if_sid>
		<field name="win.eventdata.Image">\\cmd.exe||\\powershell.exe||\\wscript.exe||\\cscript.exe||\\sh.exe||\\bash.exe||\\scrcons.exe||\\schtasks.exe||\\regsvr32.exe||\\hh.exe||\\csc.exe</field>
		<description>Mitre ATT&CK T1059, Execution, Command and Scripting Interpreter, Microsoft Office Product Spawning Windows Shell</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059 - Command-Line Interface, Ejecución de scripts wscript/cscript.exe

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de comandos con las utilidades wscript/cscript que permiten la ejecución de scripts potencialmente peliggrosos |
{background:#dddddd}. |=. Nivel |=. Origen|=.ID Evento |
|={background:#b3b6f8}. **0** |=.Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| |[[#- T1059 - Command-Line Interface, Invocación de Línea de comandos via binarios inusuales|101329]] | |
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
        <rule id="100106" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\wscript.exe||\\cscript.exe</field>
		<description>Mitre ATT&CK T1059, Execution , Command and Scripting Interpreter, wscript/cscript.exe</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059 - Command-Line Interface, Ejecución mediante Console Windows Host

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. **Console Window Host** es un proceso del host que gestiona la consola de windows a partir de windows 7, existen diferentes técnicas para ejecución de código usando este binario |
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| | [[#- T1059 - Command-Line Interface, Ejecución de Mimikatz|101334]]| |
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100111" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">\\conhost.exe</field>
		<description>Mitre ATT&CK T1059, Execution, Command and Scripting Interpreter execution $(win.eventdata.parentimage)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059, Execution, Command and Scripting Interpreter, Living off the land Abusing the Volume Shadow for execution

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059.003 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza el uso del binario **vshadow** para la ejecución de comandos, esta técnica está encuadrada dentro de las denominadas **Living off the Land**, estas técnicas se basan en la ejecución de comandos aprobechando binarios"legítimos" del sistema, REF. https://bohops.com/2018/02/10/vshadow-abusing-the-volume-shadow-service-for-evasion-persistence-and-active-directory-database-extraction/  |
{background:#dddddd}. |=. Nivel |=.Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| | | |
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="101309" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">\\vshadow.exe</field>
		<field name="win.eventdata.CommandLine">\.*vshadow.exe -nw -exec\.*</field>
		<description>Mitre ATT&CK T1059.003, Execution, Command and Scripting Interpreter, Living off the land Abusing the Volume Shadow for execution</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059 - Command-Line Interface, LoL HTML Application command line execution

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2. Command-line interfaces provide a way of interacting with computer systems and is a common feature across many types of operating system platforms. One example command-line interface on Windows systems is cmd, which can be used to perform a number of tasks including execution of other software. Command-line interfaces can be interacted with locally or remotely via a remote desktop application, reverse shell session, etc. Commands that are executed run with the current permission level of the command-line interface process unless the command includes process invocation that changes permissions context for that execution (e.g. Scheduled Task). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Los ficheros **Microsoft HTML Applications (HTA)** son ficheros HTML que ejecutan JavaScript o VBScript fuera del navegador, la firma 100101 monitoriza el uso del binario **mshta.exe**, que permite la ejecución de este tipo de ficheros, esta firma hereda la monitorización de **mshta** y monitoriza el uso de comandos que pueden resultar en ejecuciones potencialmente peligrosas. |
{background:#dddddd}. |=. Nivel|=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. N/A  |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1170 - Microsoft HTML Application execution|100101]] | | |
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101312" level="12">
		<if_sid>100101</if_sid>
		<field name="win.eventdata.Image">\\cmd.exe||\\powershell.exe||\\wscript.exe||\\cscript.exe||\\sh.exe||\\bash.exe||\\reg.exe||\\regsvr32.exe||\\BITSADMIN*</field>
		<description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Living off the land Microsoft HTML Application command line execution </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059 - Command-Line Interface, LoL posible misuse of Download capabilities of CertUtil

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2. Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el posible uso malicioso del binario **CertUtil**, primeramente usado para la gestión de certificados, y sus capacidades de descargar certificados, esta capacidad podría ser utilizada para la descarga de otro tipo de archivos potencialmente maliciosos, REF. https://www.bleepingcomputer.com/news/security/certutilexe-could-allow-attackers-to-download-malware-while-bypassing-av/ |
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| | | |
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101313" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.Image">\\certutil.exe</field>
		<description>Mitre ATT&CK T1059, Execution, Command and Scripting Interpreter, Living off the land possible misuse of certutil downloading capabilities</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059 - Command-Line Interface, Invocación de Línea de comandos via binarios inusuales

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza el uso de los binarios **cmd.exe** y **powershel.exe** por parte de otras utilidades, este comportamiento puede ser catalogado como sospechoso. | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational |=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1059 - Command-Line Interface, Ejecución de scripts wscript/cscript.exe|100106]] | | |
{background:#dddddd}. |\3=. CÓDIGO |


<pre><code class="xml">
	<rule id="101329" level="10">
		<if_sid>100106</if_sid>
		<field name="win.eventdata.Image">\\powershell.exe||\\cmd.exe</field>
		<description>Mitre ATT&CK T1059, Execution , Command and Scripting Interpreter, Detects suspicious powershell invocations from interpreters or unusual programs</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059 - Command-Line Interface, Detección de comandos sospechosos relacionados con el uso fraudulento de **volume** **shadow** **copy**

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2. Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza el uso de **shadow** **copy**, que puede resultar acciones fraudulentas relacionadas con las snapshot integradas en windows, REF. https://www.carbonblack.com/2015/08/05/bit9-carbon-black-threat-research-team-unveils-nefarious-intents-of-volume-shadows-copies/ | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f6bb7f}. **10** |=. Origen |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| | | | 
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101332" level="10">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.commandline">vssadmin create shadow||GLOBALROOT||vssadmin delete shadows||reg SAVE HKLM\\SYSTEM||\\windows\\ntds\\ntds.dit</field>
		<description>Mitre ATT&CK T1059, Execution, Command and Scripting Interpreter, Detects suspicious commands that could be related to activity that uses volume shadow copy</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059, Execution, Command and Scripting Interpreter, Mimikatz Detection

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1059 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza ejecución de mimikatz|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#T1059 - Command-Line Interface, Ejecución mediante Console Windows Host|100111]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101334" level="12">
        <if_sid>100111</if_sid>
        <field name="win.eventdata.ParentImage">mimikatz.exe</field>
        <description>Mitre ATT&CK T1059, Execution, Command and Scripting Interpreter, Mimikatz Detection Image: $(win.eventdata.parentimage)</description>
		<options>no_full_log</options>
    </rule>
</code></pre>

----

h3. - T1059 -  Command-Line Interface, Create Remote Process via WMIC

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2. Command-line interfaces provide a way of interacting with computer systems and is a common feature across many types of operating system platforms. One example command-line interface on Windows systems is cmd, which can be used to perform a number of tasks including execution of other software. Command-line interfaces can be interacted with locally or remotely via a remote desktop application, reverse shell session, etc. Commands that are executed run with the current permission level of the command-line interface process unless the command includes process invocation that changes permissions context for that execution (e.g. Scheduled Task). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza la creación de procesos remotos mediante Windows Management Instrumentation (WMI) REF. https://car.mitre.org/analytics/CAR-2016-03-002/ | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
|  [[100108]] | | |
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101333" level="10">
		<if_sid>100108</if_sid>
		<field name="win.eventdata.commandline">process call create</field>
		<description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Windows management Instrumentation command execution</description>
		<options>no_full_log</options>
	</rule>	
</code></pre>

----

h3. - T1059, Execution, Command-Line Interface, Mimikatz execution

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1059 |\2.Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de mimikatz|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.  [[Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101347" level="12">
        <if_group>sysmon_event1</if_group>
        <field name="win.eventdata.commandline">mimikatz.exe</field>
        <description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Mimikatz execution</description>
		<options>no_full_log</options>
    </rule>
</code></pre>

----

h3. - T1059 -  Command-Line Interface, Ejecución de Mimikatz

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059 |\2. Adversaries may abuse command and script interpreters to execute commands, scripts, or binaries. These interfaces and languages provide ways of interacting with computer systems and are a common feature across many different platforms. Most systems come with some built-in command-line interface and scripting capabilities, for example, macOS and Linux distributions include some flavor of Unix Shell while Windows installations include the Windows Command Shell and PowerShell.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza la ejecución del binario mimikatz.exe mediante una línea de comandos | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|  [[#T1059 - Command-Line Interface, Ejecución mediante Console Windows Host|100111]] | | |
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="101334" level="12">
        <if_sid>100111</if_sid>
        <field name="win.eventdata.ParentImage">mimikatz.exe</field>
        <description>Mitre ATT&CK T1059, Execution, Command-Line Interface, Mimikatz Detection Image: $(win.eventdata.parentimage)</description>
		<options>no_full_log</options>
    </rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Powershell or Script Execution

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059.001 |\2.Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de comandos via powershell o scripts que utilicen este binario  | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
|| [[#- T1086 - Execution, PowerShell, PowerShell scripts that download content from the Internet|101326]],  [[#- T1086 - Execution, PowerShell, Detects suspicious PowerShell invocation command parameters|101327]] ||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100113" level="10">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\powershell.exe||\\.ps1||\\.ps2</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Powershell or Script Execution: $(win.eventdata.CommandLine)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Powershell Net Execution

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059.001 |\2. Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de powershell o scripts que utilizan este binario de forma remota o en red | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
||||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="101316" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.Image">\\powershell.exe</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Powershell Net Execution</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, PowerShell scripts that download content from the Internet

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059.001 |\2. Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la descarga de contenidos ejecutada via powershell | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| [[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]] |||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="101326" level="12">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">DownloadString||downloadfile</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, PowerShell scripts that download content from the Internet</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Detects suspicious PowerShell invocation command parameters

----

{background:#dddddd}. |=. ID |\2.=. DESCRIPCIÓN |
| T1059.001 |\2. Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de powershell con parámetros sospechosos | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| [[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]] |||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="101327" level="12">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">EncodedCommand||-w hidden||-window hidden||-windowstyle hidden||-enc||-noni||noninteractive</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Detects suspicious PowerShell invocation command parameters</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Remote powershell execution allowed

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059.001 |\2. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer.   |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 5156 que indica que el firewall de windows ha permitido una conexión realizada por powershell | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **10** |=. Microsoft-Windows-Security-Auditing |=. [[Modelo de datos#1.1.Eventos de windows |5156]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| [[60103]] |||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100372" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5156$</field>
		<field name="win.eventdata.Application">\.*PowerShell.exe\.*</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Remote powershell execution allowed</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, invoke execution call

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059.001 |\2. Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 4104 que indica que se ha ejecutado un comando de forma remota con Powershell | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-PowerShell/Operational|=. [[Modelo de datos#1.1.Eventos de windows |4104]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60010]] |||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100373" level="12">
		<if_sid>60010</if_sid>
		<field name="win.system.eventID">^4104$</field>
		<field name="win.eventdata.ScriptBlockText">(\.*)iex|IEX(\.*)</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, invoke execution call</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Mimikatz powershell execution

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1059.001 |\2. Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. [1] Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 4103 que indica que se ha ejecutado un comando con Powershell | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-PowerShell/Operational|=. [[Modelo de datos#1.1.Eventos de windows |4103]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60009]] |||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100374" level="12">
		<if_sid>60009</if_sid>
		<field name="win.system.eventID">^4103$</field>
		<field name="win.eventdata.Payload">(\.*)mimikatz(\.*)</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Mimikatz powershell execution</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Encripted powershell command

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1059.001 |\2. Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. [1] Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the Start-Process cmdlet which can be used to run an executable and the Invoke-Command cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 4103 que indica que se ha ejecutado un comando con Powershell, en este caso de forma encriptada, lo cual puede ser sospechoso| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-PowerShell/Operational|=. [[Modelo de datos#1.1.Eventos de windows |4103]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60009]] |||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100375" level="12">
		<if_sid>60009</if_sid>
		<field name="win.system.eventID">^4103$</field>
		<field name="win.eventdata.Payload">(\.*)-enc(\.*)</field>
		<description>Mitre ATT&CK T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Encripted powershell command</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, Command-Line Interface Execution

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1059.003 |\2. Adversaries may abuse the Windows command shell for execution. The Windows command shell (cmd.exe) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza el uso del binario **cmd.exe**, uno de los dos binarios junto con **powershel.exe**,  básicos para la ejecución potencialmente peligrosa de comandos. | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| |[[#- T1053, Execution, Scheduled Task, Creation of scheduled task|101342]],[[#- T1002, Exfiltration, Data Compressed, data compressed using command line|101801]],[[#- T1114, Collection, Email Collection, Creation of storage or cache files .pst or .ost|101402]], [[#- T1033, Discovery, System Owner/User Discovery, use of whoami via command line|100808]] | |
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100117" level="10">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\cmd.exe</field>
		<description>Mitre ATT&CK T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, Command-Line Interface Execution: $(win.eventdata.CommandLine)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, execution from temporary folder

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1059 |\2.Adversaries may abuse the Windows command shell for execution. The Windows command shell (cmd.exe) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de comandos desde directorios temporales|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, Command-Line Interface Execution|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101344" level="12">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.CommandLine">C:\\Windows\\TEMP|C:\\Windows\\temp</field>
		<description>Mitre ATT&CK T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, execution from temporary folder</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1129 - Execution through Module Load

----

h3. - T1129 - Execution, Execution through Module Load, .NET CLR Usage

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1129 |\2. The Windows module loader can be instructed to load DLLs from arbitrary local paths and arbitrary Universal Naming Convention (UNC) network paths. This functionality resides in NTDLL.dll and is part of the Windows Native API which is called from functions like CreateProcess(), LoadLibrary(), etc. of the Win32 API. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de .NET y common language runtime a través de la creación de logs por parte de las aplicaciones ejecutadas REF. https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html| 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
||||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="101301" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">(\.*)\\UsageLogs\\cscript.exe.log|wscript.exe.log|mshta.log|wmic.log|regsvr32.exe.log|svchost.log(\.*)</field>
		<description>Mitre ATT&CK T1129, Execution, Execution through Module Load, .NET CLR Usage</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1053 - Execution - Scheduled Task

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may abuse task scheduling functionality to facilitate initial or recurring execution of malicious code. Utilities exist within all major operating systems to schedule programs or scripts to be executed at a specified date and time. A task can also be scheduled on a remote system, provided the proper authentication is met (ex: RPC and file and printer sharing in Windows environments). Scheduling a task on a remote system typically requires being a member of an admin or otherwise privileged group on the remote system|

----

h3. - T1053.002, Execution, Scheduled Task/Job: At (Windows), Remote Task creation using ATSVC named pipe or the deprecated AT.exe cmdlet

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1053.002 |\2. Adversaries may abuse the at.exe utility to perform task scheduling for initial or recurring execution of malicious code. The at utility exists as an executable within Windows for scheduling tasks at a specified time and date. Using at requires that the Task Scheduler service be running, and the user to be logged on as a member of the local Administrators group.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la utilización del binario AT.exe para creación remota de Tareas programadas REF. https://car.mitre.org/analytics/CAR-2015-04-001/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5145]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100200]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100371" level="10">
		<if_sid>100200</if_sid>
		<field name="win.system.eventID">^5145$</field>
		<field name="win.eventdata.ShareName">(\.*)(IPC\$)</field>
		<field name="win.eventdata.RelativeTargetName">atsvc</field>
		<description>Mitre ATT&CK T1053.002, Execution, Scheduled Task/Job: At (Windows), Remote Task creation using ATSVC named pipe or the deprecated AT.exe cmdlet</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1053.002, Execution, Scheduled Task/Job: At (Windows), Creation of scheduled task

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1053.002 |\2. Adversaries may abuse the at.exe utility to perform task scheduling for initial or recurring execution of malicious code. The at utility exists as an executable within Windows for scheduling tasks at a specified time and date. Using at requires that the Task Scheduler service be running, and the user to be logged on as a member of the local Administrators group. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del comando **at** para la ejecución de tareas periódicas |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|  [[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101343" level="12">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.CommandLine">AT\s\d\d:\d\d|\sat\s\d\d:\d\d</field>
		<description>Mitre ATT&CK T1053.002, Execution, Scheduled Task/Job: At (Windows), Creation of scheduled task</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1053.005, Execution, Scheduled Task/Job: Scheduled Task, Scheduled Task running programs from suspicious locations or scripting utilities

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1053.005 |\2.Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code. There are multiple ways to access the Task Scheduler in Windows. The schtasks can be run directly on the command line, or the Task Scheduler can be opened through the GUI within the Administrator Tools section of the Control Panel. In some cases, adversaries have used a .NET wrapper for the Windows Task Scheduler, and alternatively, adversaries have used the Windows netapi32 library to create a scheduled task. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de tareas periódicas desde rutas sospechosas |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101319" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">\.*schtasks.exe\.*/create\.*c:\\users\.*|\.*schtasks.exe\.*/create\.* c:\\programdata\.*|\.*schtasks.exe\.*/create\.* c:\\windows\\temp\.*</field>
		<description>Mitre ATT&CK T1053.005, Execution, Scheduled Task/Job: Scheduled Task, Scheduled Task running programs from suspicious locations or scripting utilities</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1053 - Execution, Modification of the program run by a Windows Default Scheduled Task

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1053 |\2. Utilities such as at and schtasks, along with the Windows Task Scheduler, can be used to schedule programs or scripts to be executed at a date and time. A task can also be scheduled on a remote system, provided the proper authentication is met to use RPC and file and printer sharing is turned on. Scheduling a task on a remote system typically required being a member of the Administrators group on the remote system.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza ficheros interesantes de cara a modificar tareas períodicas existentes en windows 7 y 10 REF. https://blog.menasec.net/2019/03/threat-hunting-25-scheduled-tasks-for.html punto D
   %SystemRoot%\System32\aitagent.exe
   %windir%\system32\compattel\DiagTrackRunner.exe
   %windir%\system32\CompatTelRunner.exe
   acproxy.dll
   %SystemRoot%\System32\wsqmcons.exe
   %windir%\system32\lpremove.exe
   srrstr.dll,ExecuteScheduledSPPCreation
   %windir%\system32\wermgr.exe
   %systemroot%\System32\sdclt.exe
   %windir%\system32\appidcertstorecheck.exe
   %windir%\system32\AppHostRegistrationVerifier.exe
   "C:\Windows\System32\MicTray64.exe"
   %systemroot%\system32\usoclient.exe
   %SystemRoot%\System32\dsregcmd.exe
   %systemroot%\System32\sihclient.exe
|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101001" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">(\.*)aitagent.exe|DiagTrackRunner.exe|CompatTelRunner.exe|acproxy.dl|wsqmcons.exe|lpremove.exe|srrstr.dll|wermgr.exe|sdclt.exe|appidcertstorecheck.exe|AppHostRegistrationVerifier.exe|MicTray64.exe|usoclient.exe|dsregcmd.exe|sihclient.exe|dimsjob.dll|Lracengn.dll|HotstartUserAgent.dll|MsCtfMonitor.dll|PlaySndSrv.dll|AdobeARM.exe|GoogleUpdate.exe(\.*)</field>
		<description>Mitre ATT&CK T1053, Persistence, Scheduled Task, Modification of the program run by a Windows Default Scheduled Task</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1053.005, Persistence, Scheduled Task/Job: Scheduled Task , Folders related with scheduled tasks were modified

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1053.005 |\2. Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code. There are multiple ways to access the Task Scheduler in Windows. The schtasks can be run directly on the command line, or the Task Scheduler can be opened through the GUI within the Administrator Tools section of the Control Panel. In some cases, adversaries have used a .NET wrapper for the Windows Task Scheduler, and alternatively, adversaries have used the Windows netapi32 library to create a scheduled task.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la monitorización de la modificación de los ficehros y carpetas relativos a las tareas periódicas, que puede ser indicativo de actividad sospechosa.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101008" level="6">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">C:\\\\Windows\\\\Tasks\\\\|^C:\\\\Windows\\\\system32\\\\Tasks</field>
		<description>Mitre ATT&CK T1053.005, Persistence, Scheduled Task/Job: Scheduled Task , Folders related with scheduled tasks were modified</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1053.005, Persistence, Scheduled Task/Job: Scheduled Task , A scheduled task was created

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1053.005 |\2. Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code. There are multiple ways to access the Task Scheduler in Windows. The schtasks can be run directly on the command line, or the Task Scheduler can be opened through the GUI within the Administrator Tools section of the Control Panel. In some cases, adversaries have used a .NET wrapper for the Windows Task Scheduler, and alternatively, adversaries have used the Windows netapi32 library to create a scheduled task.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de nuevas tareas periódicas, Se usa el evento de windows 4698 que no viene activado por defecto y por lo tanto sólo aparecerá en servidores que tengan la GPO activada en 
1.Computer Configuration > Policies > Windows Settings > Security Settings > AdvancedAudit Policy Configuration > Object Access.
2.Select: Audit Other Object Access Events, and Select: Success + Failure, Select: OK|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **7** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4698]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100313" level="7">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4698$</field>
		<description>Mitre ATT&CK T1053.005, Persistence, Scheduled Task/Job: Scheduled Task , A scheduled task was created</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1053.005, Execution, Scheduled Task/Job: Scheduled Task , Creation of scheduled task

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1053.005 |\2. Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code. There are multiple ways to access the Task Scheduler in Windows. The schtasks can be run directly on the command line, or the Task Scheduler can be opened through the GUI within the Administrator Tools section of the Control Panel. In some cases, adversaries have used a .NET wrapper for the Windows Task Scheduler, and alternatively, adversaries have used the Windows netapi32 library to create a scheduled task.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de tareas programadas a traves de la línea de comandos|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
<rule id="101342" level="12">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.CommandLine">SCHTASKS|schtasks</field>
		<description>Mitre ATT&CK T1053.005, Execution, Scheduled Task/Job: Scheduled Task , Creation of scheduled task</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1047 - Execution, Windows Management Instrumentation

----

h3. - T1047 - Execution, Windows Management Instrumentation, Detects WMI execution

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1047 |\2. Windows Management Instrumentation (WMI) is a Windows administration feature that provides a uniform environment for local and remote access to Windows system components. It relies on the WMI service for local and remote access and the server message block (SMB) and Remote Procedure Call Service (RPCS) for remote access. RPCS operates over port 135.   |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de Windows Management Instrumentation |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100108" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\wmic.exe</field>
		<description>>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, Detects WMI execution</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1047 - Execution, Windows Management Instrumentation -1

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1047 |\2. Windows Management Instrumentation (WMI) is a Windows administration feature that provides a uniform environment for local and remote access to Windows system components. It relies on the WMI service for local and remote access and the server message block (SMB) and Remote Procedure Call Service (RPCS) for remote access. RPCS operates over port 135.   |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de Windows Management Instrumentation REF. https://www.eventtracker.com/blog/2018/april/catch-malware-hiding-in-wmi-with-sysmon/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 19]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101322" level="12">
		<if_group>sysmon_event_19</if_group>
		<field name="win.eventdata.Operation">Created</field>
		<description>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1047 - Execution, Windows Management Instrumentation -2

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1047 |\2. Windows Management Instrumentation (WMI) is a Windows administration feature that provides a uniform environment for local and remote access to Windows system components. It relies on the WMI service for local and remote access and the server message block (SMB) and Remote Procedure Call Service (RPCS) for remote access. RPCS operates over port 135.   |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de Windows Management Instrumentation REF. https://www.eventtracker.com/blog/2018/april/catch-malware-hiding-in-wmi-with-sysmon/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 20]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101323" level="12">
		<if_group>sysmon_event_20</if_group>
		<field name="win.eventdata.Operation">Created</field>
		<description>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1047 - Execution, Windows Management Instrumentation -3

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1047 |\2. Windows Management Instrumentation (WMI) is a Windows administration feature that provides a uniform environment for local and remote access to Windows system components. It relies on the WMI service for local and remote access and the server message block (SMB) and Remote Procedure Call Service (RPCS) for remote access. RPCS operates over port 135.   |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de Windows Management Instrumentation REF. https://www.eventtracker.com/blog/2018/april/catch-malware-hiding-in-wmi-with-sysmon/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 21]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101324" level="12">
		<if_group>sysmon_event_21</if_group>
		<field name="win.eventdata.Operation">Created</field>
		<description>Mitre ATT&CK T1047, Execution, Windows Management Instrumentation, </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1559 - Execution, Inter-Process Communication 

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may abuse inter-process communication (IPC) mechanisms for local code or command execution. IPC is typically used by processes to share data, communicate with each other, or synchronize execution. IPC is also commonly used to avoid situations such as deadlocks, which occurs when processes are stuck in a cyclic waiting pattern. |

----

h3. - T1559.001 - Execution, Inter-Process Communication: Component Object Model 


----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1559.001 |\2. Adversaries may use the Windows Component Object Model (COM) and Distributed Component Object Model (DCOM) for local code execution or to execute on remote systems as part of lateral movement.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza el uso de una aplicación DCOM (Distributed Component Object Model) que puede acceder a la red y ejecutar comandos en máquinas remotas REF. https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/ | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100110" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\mmc.exe</field>
		<description>Mitre ATT&CK T1559.001, Execution, Inter-Process Communication: Component Object Model </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1559.001 - Execution, Inter-Process Communication: Component Object Model, Processes started by MMC could by a sign of lateral movement using MMC application COM object

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1559.001 |\2. Adversaries may use the Windows Component Object Model (COM) and Distributed Component Object Model (DCOM) for local code execution or to execute on remote systems as part of lateral movement.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de línea de comandos via MMC (Microsoft Management Console) REF. https://www.cybereason.com/blog/dcom-lateral-movement-techniques Punto -MMC20.Application| 
{background:#dddddd}. |=. Nivel |=. Origen  |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1175 - Lateral Movement, Component Object Model and Distributed COM|100110]]|||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100505" level="12">
		<if_sid>100110</if_sid>
		<field name="win.eventdata.image">\\cmd.exe||\\powershell.exe</field>
		<description>Mitre ATT&CKT1559.001 - Execution, Inter-Process Communication: Component Object Model,  Processes started by MMC could by a sign of lateral movement using MMC application COM object</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1569, System Services

{background:#dddddd}. |\3=. DESCRIPCIÓN |
|Adversaries may abuse system services or daemons to execute commands or programs. Adversaries can execute malicious content by interacting with or creating services. Many services are set to run at boot, which can aid in achieving persistence (Create or Modify System Process), but adversaries can also abuse services for one-time or temporary execution.|

----

h3. - T1569.002, Execution, System Services: Service Execution, Creation or Start of a service manually with sc.exe binary

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1130 |\2. Adversaries may abuse the Windows service control manager to execute malicious commands or payloads. The Windows service control manager (services.exe) is an interface to manage and manipulate services.[1] The service control manager is accessible to users via GUI components as well as system utilities such as sc.exe and Net.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario sc.exe para la creación de servicios así como para su arranque|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101322" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">sc.exe</field>
		<field name="win.eventdata.CommandLine">create|start</field>
		<description>Mitre ATT&CK T1569.002, Execution, System Services: Service Execution, Creation or Start of a service manually with sc.exe binary</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Persistence

----

h2. T1098 - Persistence, Account Manipulation

----

h3. - T1098 - Persistence, Account Manipulation, A member was added to a security-enabled universal group

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Account manipulation may aid adversaries in maintaining access to credentials and certain permission levels within an environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la inclusión de un usuario a un grupo universal con seguridad habilitada |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4756]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100300" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4756$</field>
		<description>Mitre ATT&CK T1098, Persistence, Account Manipulation,  A member was added to a security-enabled universal group</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1098 - Persistence, Account Manipulation, A member was added to a security-enabled universal group - 2

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Account manipulation may aid adversaries in maintaining access to credentials and certain permission levels within an environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la inclusión de un usuario a un grupo universal con seguridad habilitada |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4732]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100301" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4732$</field>
		<field name="win.eventdata.TargetSid">(S-1-5-32-544)|(S-1-5-32-512)|(S-1-5-32-549)|(S-1-5-32-519)|(S-1-5-32-518)</field>
		<description>Mitre ATT&CK T1098, Account Manipulation , Persistence,  A member was added to a security-enabled local group</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1098 - Persistence, Account Manipulation, A member was added to a security-enabled universal group, Guest added to admins

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Account manipulation may aid adversaries in maintaining access to credentials and certain permission levels within an environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la inclusión del usuario "GUEST" al grupo de administradores |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4732]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[60103]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100302" level="10">
		<if_sid>100301</if_sid>
		<field name="win.system.eventID">^4732$</field>
		<field name="win.eventdata.MemberSid">S-1-5-21-(\S+)-501</field>
		<field name="win.eventdata.TargetSid">(S-1-5-32-544)</field>
		<description>Mitre ATT&CK T1098, Persistence, Account Manipulation , A member was added to a security-enabled local group, Guest added to admins</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1098 - Persistence, Account Manipulation, A member was added to a security-enabled universal group - 3 

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Account manipulation may aid adversaries in maintaining access to credentials and certain permission levels within an environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la inclusión de un usuario a un grupo con seguridad habilitada |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4728]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100303" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4728$</field>
		<description>Mitre ATT&CK T1098, Persistence, Account Manipulation,  A member was added to a security-enabled global group</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1098 - Persistence, Account Manipulation, Computer (Not domain controller) SPN Changes, DCShadow impersonating domain controller 

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Account manipulation may aid adversaries in maintaining access to credentials and certain permission levels within an environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la utilización de cuentas para hacerse pasar por el controlador del dominio REF. https://blog.stealthbits.com/detecting-dcshadow-with-event-logs/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=.Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4742]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60121]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100304" level="10">
		<if_sid>60121</if_sid>
		<field name="win.system.eventID">^4742$</field>
		<field name="win.eventdata.ServicePrincipalNames">(\.*)\sGC(\.*)\sE3514235–4B06–11D1-AB04–00C04FC2DCD2(\.*)</field>
		<description>Mitre ATT&CK T1098, Persistence, Account Manipulation, Computer (Not domain controller) SPN Changes, DCShadow impersonating domain controller</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1098 - Persistence, Account Manipulation, User account set with password to never expire 

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Account manipulation may aid adversaries in maintaining access to credentials and certain permission levels within an environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las cuentas que cuentan con una contraseña que no expira  |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4738]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100306" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4738$</field>
		<field name="win.eventdata.OldUacValue">0x10|0x11|0x15</field>
		<field name="win.eventdata.NewUacValue">0x210</field>
		<description>Mitre ATT&CK T1098 , Persistence, Account Manipulation, User account set with password to never expire </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1098, Persistence, Account Manipulation, User account changed

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Account manipulation may aid adversaries in maintaining access to credentials and certain permission levels within an environment.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de usuarios|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4738]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100316" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4738$</field>
		<description>Mitre ATT&CK T1098, Persistence, Account Manipulation, User account changed</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1136 - Persistence, Create Account

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may create a local account to maintain access to victim systems. Local accounts are those configured by an organization for use by users, remote support, services, or for administration on a single system or service. With a sufficient level of access, the net user /add command can be used to create a local account.|

----

h3. - T1136.001 , Persistence, Create Account: Local Account, User account created with a name that mimic a machine account

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1136.001 |\2. Adversaries may create a local account to maintain access to victim systems. Local accounts are those configured by an organization for use by users, remote support, services, or for administration on a single system or service. With a sufficient level of access, the net user /add command can be used to create a local account. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de una cuenta de usuario que pretende parecerse a una cuenta de administrador local de una máquina|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4720]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60109]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100307" level="10">
		<if_sid>60109</if_sid>
		<field name="win.system.eventID">^4720$</field>
		<field name="win.eventdata.SamAccountName">(\.*)\$</field>
		<description>Mitre ATT&CK T1136.001 , Persistence, Create Account: Local Account, User account created with a name that mimic a machine account</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1136.001, Persistence, Create Account: Local Account , Local account was created

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1136.001 |\2. Adversaries may create a local account to maintain access to victim systems. Local accounts are those configured by an organization for use by users, remote support, services, or for administration on a single system or service. With a sufficient level of access, the net user /add command can be used to create a local account. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de una cuenta de usuario local|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=.Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4720]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60109]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	 <rule id="100314" level="7">
		<if_sid>60109</if_sid>
		<field name="win.system.eventID">^4720$</field>
		<field name="win.eventdata.SubjectUserSid">^S-1-5-18-|^S-1-5-21-</field>
		<description>Mitre ATT&CK T1136.001, Persistence, Create Account: Local Account , Local account was created</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1543, Persistence, Create or Modify System Process 

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may create or modify system-level processes to repeatedly execute malicious payloads as part of persistence. When operating systems boot up, they can start processes that perform background system functions. On Windows and Linux, these system processes are referred to as services. On macOS, launchd processes known as Launch Daemon and Launch Agent are run to finish system initialization and load user specific parameters.|

----

h3. - T1543.003, Persistence, Create or Modify System Process: Windows Service, A service was installed in the system with powershell cmdlet New-Service

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1543.003 |\2. Adversaries may create or modify Windows services to repeatedly execute malicious payloads as part of persistence. When Windows boots up, it starts programs or applications called services that perform background system functions.Windows service configuration information, including the file path to the service's executable or recovery programs/commands, is stored in the Windows Registry. Service configurations can be modified using utilities such as sc.exe and Reg.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la instalación de un nuevo servicio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101010" level="12">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandLine">New-Service</field>
		<description>Mitre ATT&CK T1543.003, Persistence, Create or Modify System Process: Windows Service, A service was installed in the system with powershell cmdlet New-Service</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1543.003, Persistence, Create or Modify System Process: Windows Service , A service was installed in the system

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1543.003 |\2. Adversaries may create or modify Windows services to repeatedly execute malicious payloads as part of persistence. When Windows boots up, it starts programs or applications called services that perform background system functions.Windows service configuration information, including the file path to the service's executable or recovery programs/commands, is stored in the Windows Registry. Service configurations can be modified using utilities such as sc.exe and Reg. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la instalación de un nuevo servicio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4697]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100309" level="8">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4697$</field>
		<description>Mitre ATT&CK T1543.003, Persistence, Create or Modify System Process: Windows Service , A service was installed in the system</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1543.003, Persistence, Create or Modify System Process: Windows Service , A service was installed in the system II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1543.003 |\2. Adversaries may create or modify Windows services to repeatedly execute malicious payloads as part of persistence. When Windows boots up, it starts programs or applications called services that perform background system functions.Windows service configuration information, including the file path to the service's executable or recovery programs/commands, is stored in the Windows Registry. Service configurations can be modified using utilities such as sc.exe and Reg.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la instalación de un nuevo servicio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **8** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 7045]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[61100]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100310" level="8">
		<if_sid>61100</if_sid>
		<field name="win.system.eventID">^7045$</field>
		<description>Mitre ATT&CK T1543.003, Persistence, Create or Modify System Process: Windows Service , A service was installed in the system</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. -  T1543.003, Persistence, Create or Modify System Process: Windows Service , PSEXEC Service created

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1543.003 |\2. Adversaries may create or modify Windows services to repeatedly execute malicious payloads as part of persistence. When Windows boots up, it starts programs or applications called services that perform background system functions. Windows service configuration information, including the file path to the service's executable or recovery programs/commands, is stored in the Windows Registry. Service configurations can be modified using utilities such as sc.exe and Reg. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la instalación de un nuevo servicio mediante PSEXEC|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **8** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 7045]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[61100]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100311" level="8">
		<if_sid>61100</if_sid>
		<field name="win.system.eventID">^7045$</field>
		<field name="win.eventdata.ServiceName">PSEXECSVC</field>
		<description>Mitre ATT&CK T1543.003, Persistence, Create or Modify System Process: Windows Service , PSEXEC Service created</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1543.003, Persistence, Create or Modify System Process: Windows Service , PSEXEC Service created

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1543.003 |\2. Adversaries may create or modify Windows services to repeatedly execute malicious payloads as part of persistence. When Windows boots up, it starts programs or applications called services that perform background system functions.[1] Windows service configuration information, including the file path to the service's executable or recovery programs/commands, is stored in the Windows Registry. Service configurations can be modified using utilities such as sc.exe and Reg. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la instalación de un nuevo servicio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **8** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5145]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100312" level="8">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5145$</field>
		<field name="win.eventdata.RelativeTargetName">\.*-stdin$|-stdout$|-stderr$</field>
		<description>Mitre ATT&CK T1543.003, Persistence, Create or Modify System Process: Windows Service , PSEXEC Service created</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1547, Boot or Logon Autostart Execution

{background:#dddddd}. |=. DESCRIPCIÓN ||
|Adversaries may configure system settings to automatically execute a program during system boot or logon to maintain persistence or gain higher-level privileges on compromised systems. Operating systems may have mechanisms for automatically running a program on system boot or account logon.These mechanisms may include automatically executing programs that are placed in specially designated directories or are referenced by repositories that store configuration information, such as the Windows Registry. An adversary may achieve the same goal by modifying or extending features of the kernel.
Since some boot or logon autostart programs run with higher privileges, an adversary may leverage these to elevate privileges.|


----

h3. - T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.001 |\2. Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the "run keys" in the Registry or startup folder will cause the program referenced to be executed when a user logs in. [1] These programs will be executed under the context of the user and will have the account's associated permissions level.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de los registros \Windows\CurrentVersion\Run que contienen los programas que se arrancan al inicio del sistema, modificando estas entradas puede generarse persistencia en ls equipos.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **6** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 12 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101002" level="6">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows\\\\CurrentVersion\\\\Run</field>
		<description>Mitre ATT&CK T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.001 |\2. Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the "run keys" in the Registry or startup folder will cause the program referenced to be executed when a user logs in. [1] These programs will be executed under the context of the user and will have the account's associated permissions level.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de los registros \Windows\CurrentVersion\Run que contienen los programas que se arrancan al inicio del sistema, modificando estas entradas puede generarse persistencia en ls equipos.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **6** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101024" level="6">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows\\\\CurrentVersion\\\\Run</field>
		<description>Mitre ATT&CK T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.001, Persistence, Registry Run Keys / Startup Folder -2

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.001 |\2.Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the "run keys" in the Registry or startup folder will cause the program referenced to be executed when a user logs in. [1] These programs will be executed under the context of the user and will have the account's associated permissions level.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de entradas de registro referentes a las aplicaciones de inicio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101006" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\User Shell Folders\\\\startup||\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Shell Folders\\\\startup</field>
		<description>Mitre ATT&CK T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder, Process execution at startup Run/RunOnce

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.001 |\2.Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the "run keys" in the Registry or startup folder will cause the program referenced to be executed when a user logs in. [1] These programs will be executed under the context of the user and will have the account's associated permissions level.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de procesos al inicio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **5** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.1.Eventos de windows | 9708]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60009]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100315" level="5">
		<if_sid>60009</if_sid>
		<field name="win.system.eventID">^9708$</field>
		<description>Mitre ATT&CK T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder, Process execution at startup Run/RunOnce</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder III

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.001 |\2. Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the "run keys" in the Registry or startup folder will cause the program referenced to be executed when a user logs in. [1] These programs will be executed under the context of the user and will have the account's associated permissions level.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de procesos al inicio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Microsoft-Windows-Sysmon/Operational -13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[60009]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
<rule id="101009" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Shell</field>
		<description>Mitre ATT&CK T1547.001, Persistence, Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.002, Persistence, Boot or Logon Autostart Execution: Authentication Package

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1560.001 |\2.Adversaries may abuse authentication packages to execute DLLs when the system boots. Windows authentication package DLLs are loaded by the Local Security Authority (LSA) process at system start. They provide support for multiple logon processes and multiple security protocols to the operating system.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la clave de registro HKLM\SYSTEM\CurrentControlSet\Control\Lsa\ REF. https://attack.mitre.org/techniques/T1547/002/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101018" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\</field>
		<description>Mitre ATT&CK T1547.002, Persistence, Boot or Logon Autostart Execution: Authentication Package</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.003, Persistence,  Boot or Logon Autostart Execution: Time Providers, Time change outside the normal Windows Time Service.

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
|T1547.003 |\2. Adversaries may abuse time providers to execute DLLs when the system boots. The Windows Time service (W32Time) enables time synchronization across and within domains. W32Time time providers are responsible for retrieving time stamps from hardware/network resources and outputting these values to other network clients|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la fecha y la hora por un proceso diferente del normal del sistema |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.2.Eventos Sysmon|4616]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101012" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">CurrentControlSet\\\\Services\\\\W32Time\\\\TimeProviders</field>
		<description>Mitre ATT&CK T1547.003, Persistence, Boot or Logon Autostart Execution: Time Providers</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.003, Persistence, Boot or Logon Autostart Execution: Time Providers

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
|T1547.003 |\2. Adversaries may abuse time providers to execute DLLs when the system boots. The Windows Time service (W32Time) enables time synchronization across and within domains. W32Time time providers are responsible for retrieving time stamps from hardware/network resources and outputting these values to other network clients|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la fecha mediante el registro del sistema |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101012" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">CurrentControlSet\\\\Services\\\\W32Time\\\\TimeProviders\\\\</field>
		<description>Mitre ATT&CK T1547.003, Persistence, Boot or Logon Autostart Execution: Time Providers</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.004, Persistence, Boot or Logon Autostart Execution: Winlogon Helper DLL, hive \CurrentVersion\Winlogon\Notify changed

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.004 |\2. Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in. Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\Software[\Wow6432Node\]\Microsoft\Windows NT\CurrentVersion\Winlogon\ and HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\ are used to manage additional helper programs and functionalities that support Winlogon.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de los registros HKL que contiene la entrada \CurrentVersion\Winlogon\Notify que puede usarse para la ejecución de código malicioso|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100119]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101022" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\CurrentVersion\\\\Winlogon\\\\Notify</field>
		<description>Mitre ATT&CK T1547.004, Persistence, Boot or Logon Autostart Execution: Winlogon Helper DLL, hive \CurrentVersion\Winlogon\Notify changed</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.004, Persistence, Boot or Logon Autostart Execution: Winlogon Helper DLL, hive \CurrentVersion\Winlogon\Userinit changed

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.004 |\2. Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in. Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\Software[\Wow6432Node\]\Microsoft\Windows NT\CurrentVersion\Winlogon\ and HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\ are used to manage additional helper programs and functionalities that support Winlogon.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de los registros HKL que contiene la entrada \CurrentVersion\Winlogon\UserInit que puede usarse para la ejecución de código malicioso|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100119]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101023" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\CurrentVersion\\\\Winlogon\\\\Userinit</field>
		<description>Mitre ATT&CK T1547.004, Persistence, Boot or Logon Autostart Execution: Winlogon Helper DLL, hive \CurrentVersion\Winlogon\Userinit changed</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider I

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.005 |\2.Adversaries may abuse security support providers (SSPs) to execute DLLs when the system boots. Windows SSP DLLs are loaded into the Local Security Authority (LSA) process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user's Domain password or smart card PINs.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la clave de registro HKLM\SYSTEM\CurrentControlSet\Control\Lsa\OSConfig\Security REF. https://attack.mitre.org/techniques/T1547/005/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.  [[Modelo de datos#1.2.Eventos Sysmon|13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101018" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\OSConfig\\\\Security Packages</field>
		<description>Mitre ATT&CK T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider I</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.005 |\2.Adversaries may abuse security support providers (SSPs) to execute DLLs when the system boots. Windows SSP DLLs are loaded into the Local Security Authority (LSA) process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user's Domain password or smart card PINs.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la clave de registro HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Security Package REF. https://attack.mitre.org/techniques/T1547/005/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.  [[Modelo de datos#1.2.Eventos Sysmon|13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101019" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\Security Package</field>
		<description>Mitre ATT&CK T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider II</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider III

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.005 |\2. Adversaries may abuse security support providers (SSPs) to execute DLLs when the system boots. Windows SSP DLLs are loaded into the Local Security Authority (LSA) process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user's Domain password or smart card PINs.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de los registros **\CurrentControlSet\Control\Lsa\OSConfig\Security** donde se cargan DLL's que usa el proceso LSASS de windows modificando el proceso de autenticación. REF. https://pentestlab.blog/2019/10/21/persistence-security-support-provider/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 12 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101025" level="12">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\OSConfig\\\\Security Packages</field>
		<description>Mitre ATT&CK T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider III</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider IV

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.005 |\2. Adversaries may abuse security support providers (SSPs) to execute DLLs when the system boots. Windows SSP DLLs are loaded into the Local Security Authority (LSA) process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user's Domain password or smart card PINs.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de los registros **\CurrentControlSet\Control\Lsa\OSConfig\Security** donde se cargan DLL's que usa el proceso LSASS de windows modificando el proceso de autenticación. REF. https://pentestlab.blog/2019/10/21/persistence-security-support-provider/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101026" level="12">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\Security Package</field>
		<description>Mitre ATT&CK T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider IV</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider, Creation of mimilsa.log

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1547.005 |\2. Adversaries may abuse security support providers (SSPs) to execute DLLs when the system boots. Windows SSP DLLs are loaded into the Local Security Authority (LSA) process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user's Domain password or smart card PINs.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación del log **mimilsa.log**, con passwords de las cuentas que realizan login en al sistema, en la carpeta system32 es un indicativo de la inyección en memoria por parte de **mimikatz** de la librería **mimilib.dll** en el proceso LSASS. REF. https://pentestlab.blog/2019/10/21/persistence-security-support-provider/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 11 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101027" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">mimilsa.log</field>
		<description>Mitre ATT&CK T1547.005, Persistence, Boot or Logon Autostart Execution: Security Support Provider, Creation of mimilsa.log that indicates usage of mimikatz to gather credentials</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1023, Persistence, Shortcut Modification

----

h3. - T1023, Persistence, Shortcut Modification, Modification of system startup shorcuts folder

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1023 |\2. Shortcuts or symbolic links are ways of referencing other files or programs that will be opened or executed when the shortcut is clicked or executed by a system startup process. Adversaries could use shortcuts to execute their tools for persistence. They may create a new shortcut as a means of indirection that may use Masquerading to look like a legitimate program. Adversaries could also edit the target path or entirely replace an existing shortcut so their tools will be executed instead of the intended legitimate program.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación del fichero que contiene los atajos a programas de inicio del sistema |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101007" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">\\Start Menu</field>
		<description>Mitre ATT&CK T1023, Persistence, Shortcut Modification, Modification of system startup shorcuts folder</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1209 - Persistence, 

----


h2.  T1013, Persistence, Port Monitors

----

h3. - T1013, Persistence, Port Monitors, Creation of a Local Port Monitor has detected

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1002 |\2. A port monitor can be set through the [1] API call to set a DLL to be loaded at startup. [1] This DLL can be located in **C:\Windows\System32** and will be loaded by the print spooler service, spoolsv.exe, on boot. The spoolsv.exe process also runs under SYSTEM level permissions. [2] Alternatively, an arbitrary DLL can be loaded if permissions allow writing a fully-qualified pathname for that DLL to **HKLM\SYSTEM\CurrentControlSet\Control\Print\Monitors**  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la utilización de herramientas de compresión de archivos |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101011" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">*ControlSet\\\\Control\\\\Print\\\\Monitors</field>
		<description>Mitre ATT&CK T1013, Persistence, Port Monitors, Creation of a Local Port Monitor has detected</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1037 Boot or Logon Initialization Scripts 

----

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may use scripts automatically executed at boot or logon initialization to establish persistence. Initialization scripts can be used to perform administrative functions, which may often execute other programs or send information to an internal logging server. These scripts can vary based on operating system and whether applied locally or remotely. |

----

h3. - T1037.001, Persistence, Boot or Logon Initialization Scripts: Logon Script

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1037.001 |\2.Adversaries may use Windows logon scripts automatically executed at logon initialization to establish persistence. Windows allows logon scripts to be run whenever a specific user or group of users log into a system.This is done via adding a path to a script to the HKCU\Environment\UserInitMprLogonScript Registry key.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la clave de registro HKCU\Environment\UserInitMprLogonScript REF. https://attack.mitre.org/techniques/T1037/001/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=.  [[Modelo de datos#1.2.Eventos Sysmon|13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101020" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Environment\\\\UserInitMprLogonScript</field>
		<description>Mitre ATT&CK T1037.001, Persistence, Boot or Logon Initialization Scripts: Logon Script</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

----

h2. T1137,  Persistence, Office Application Startup


{background:#dddddd}. | DESCRIPCIÓN |
| Adversaries may abuse Microsoft Office templates to obtain persistence on a compromised system. Microsoft Office contains templates that are part of common Office applications and are used to customize styles. The base templates within the application are used each time an application starts.|

----

h3. - T1137.001,  Persistence, Office Application Startup: Office Template Macros, Access to Office Template folder requested

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1137.001 |\2. Adversaries may abuse Microsoft Office templates to obtain persistence on a compromised system. Microsoft Office contains templates that are part of common Office applications and are used to customize styles. The base templates within the application are used each time an application starts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el acceso a la carpeta de plantillas de office, la modificación de estas añadiendo Macros que ejecuten instrucciones peligrosas pueden generar persistencia. REF. https://pentestlab.blog/2019/12/11/persistence-office-application-startup/ |
|\3. Para activar esta regla debe configurarse la auditoría de acceso (evento 4663) sobre la carpeta C:\Users\<usuario>\AppData\Roaming\Microsoft\Templates|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=. Windows_event 4663 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100317" level="3">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4663$</field>
		<field name="win.eventdata.ObjectName">\\AppData\\Roaming\\Microsoft\\Templates</field>
		<description>Mitre ATT&CK T1137.001,  Persistence, Office Application Startup: Office Template Macros, Access to Office Template folder requested</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1137.002, Persistence, Office Application Startup: Office Test, creation of test dll used for performance evaluations in Office

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1137.002 |\2. Adversaries may abuse the Microsoft Office "Office Test" Registry key to obtain persistence on a compromised system. An Office Test Registry location exists that allows a user to specify an arbitrary DLL that will be executed every time an Office application is started. This Registry key is thought to be used by Microsoft to load DLLs for testing and debugging purposes while developing Office applications. This Registry key is not created by default during an Office installation.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de una entrada de registro usada para la evaluación de rendimineto de productos Office en desarrollo que puede ser usada para generar persistencia en un sistema REF. https://pentestlab.blog/2019/12/11/persistence-office-application-startup/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 12 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101033" level="12">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">\\\\Microsoft\\\\Office test\\\\Special\\\\Perf</field>
		<description>Mitre ATT&CK T1137.002, Persistence, Office Application Startup: Office Test, creation of test dll used for performance evaluations in Office</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1137.006, Persistence, Office Application Startup: Add-ins, new .wll or .xll created in word startup folder

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1137.006 |\2. Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system. Office add-ins can be used to add functionality to Office programs. There are different types of add-ins that can be used by the various Office products; including Word/Excel add-in Libraries (WLL/XLL), VBA add-ins, Office Component Object Model (COM) add-ins, automation add-ins, VBA Editor (VBE), Visual Studio Tools for Office (VSTO) add-ins, and Outlook add-ins.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de add-ins de Ofiice que se cargan al inicio de la aplicación pudiendo generar persistencia para adversarios REF. https://pentestlab.blog/2019/12/11/persistence-office-application-startup/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **2** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 11 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
    <rule id="101031" level="2">
        <if_group>sysmon_event_11</if_group>
        <field name="win.eventdata.TargetFilename">\\Roaming\\Microsoft\\Word\\STARTUP</field>
        <description>Mitre ATT&CK T1137.006, Persistence, Office Application Startup: Add-ins, new .wll or .xll created in word startup folder</description>
        <options>no_full_log</options>
    </rule>
</code></pre>

----

h3. - T1137.006, Persistence, Office Application Startup: Add-ins, new .wll or .xll created in word startup folder

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1137.006 |\2. Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system. Office add-ins can be used to add functionality to Office programs. There are different types of add-ins that can be used by the various Office products; including Word/Excel add-in Libraries (WLL/XLL), VBA add-ins, Office Component Object Model (COM) add-ins, automation add-ins, VBA Editor (VBE), Visual Studio Tools for Office (VSTO) add-ins, and Outlook add-ins.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de add-ins de Ofiice que se cargan al inicio de la aplicación pudiendo generar persistencia para adversarios REF. https://pentestlab.blog/2019/12/11/persistence-office-application-startup/  |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **5** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 11 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
    <rule id="101032" level="5">
        <if_sid>101031</if_sid>
        <field name="win.eventdata.TargetFilename">.wll|.xll</field>
        <description>Mitre ATT&CK T1137.006, Persistence, Office Application Startup: Add-ins, new .wll or .xll created in word startup folder</description>
        <options>no_full_log</options>
    </rule>
</code></pre>

----

h1. Defense Evasion

----

h2. T1064 - Defense Evasion, Scripting

----

h3. - T1064 - Defense Evasion, Scripting, Possible Mimikatz Running In-Memory Detection

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1064 |\2. Adversaries may use scripts to aid in operations and perform multiple actions that would otherwise be manual. Scripting is useful for speeding up operational tasks and reducing the time required to gain access to critical resources. Some scripting languages may be used to bypass process monitoring mechanisms by directly interacting with the operating system at an API level instead of calling other programs. Common scripting languages for Windows include VBScript and PowerShell but could also be in the form of command-line batch scripts.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Que la biblioteca VAULTCLI.dll esté cargada en memoria puede ser un indicativo de que Mimikatz está corriendo en memoria REF. https://securityriskadvisors.com/blog/detecting-in-memory-mimikatz/.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1085 - Execution, Rundll32|100100]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100913" level="12">
		<if_sid>100100</if_sid>
		<field name="win.eventdata.ImageLoaded">\\vaultcli.dll</field>
		<description>Mitre ATT&CK T1064, Defense Evasion, Scripting, Possible Mimikatz Running In-Memory Detection</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1064 - Defense Evasion, Scripting, Possible Mimikatz In-Memory Detection

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1064 |\2. Adversaries may use scripts to aid in operations and perform multiple actions that would otherwise be manual. Scripting is useful for speeding up operational tasks and reducing the time required to gain access to critical resources. Some scripting languages may be used to bypass process monitoring mechanisms by directly interacting with the operating system at an API level instead of calling other programs. Common scripting languages for Windows include VBScript and PowerShell but could also be in the form of command-line batch scripts.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Que la biblioteca wlanapi.dll esté cargada en memoria puede ser un indicativo de que Mimikatz está corriendo en memoria REF. https://securityriskadvisors.com/blog/detecting-in-memory-mimikatz/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1085 - Execution, Rundll32|100100]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100914" level="12">
		<if_sid>100100</if_sid>
		<field name="win.eventdata.ImageLoaded">\\wlanapi.dll</field>
		<description>Mitre ATT&CK T1064, Defense Evasion, Scripting, Possible Mimikatz In-Memory Detection</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1197 -  Defense Evasion, BITS Jobs

----

h3. - T1197,  Defense Evasion, BITS Jobs

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1197 |\2. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model (COM). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del servicio "Background Intelligent Transfer Service" |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100109" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">bitsadmin.exe</field>
		<description>Mitre ATT&CK T1197,  Defense Evasion, BITS Jobs</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----


h3. - T1197,  Defense Evasion, BITS Jobs, Detects usage of bitsadmin downloading a file

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1197 |\2. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model (COM). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del servicio "Background Intelligent Transfer Service" para descargar ficheros|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1197, Defense Evasion, BITS Jobs|100109]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100919" level="12">
		<if_sid>100109</if_sid>
		<field name="win.eventdata.commandline">/transfer</field>
		<description>Mitre ATT&CK T1197, Defense Evasion, BITS Jobs, Detects usage of bitsadmin downloading a file</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1197,  Defense Evasion, BITS Jobs, Detects usage of bitsadmin downloading a file - 2

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1197 |\2. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model (COM). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del servicio "Background Intelligent Transfer Service" para descargar ficheros|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1197, Defense Evasion, BITS Jobs|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101925" level="12">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">Start-BitsTransfer</field>
		<description>Mitre ATT&CK T1197, Defense Evasion, BITS Jobs, Detects usage of bitsadmin downloading a file</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1197, Persistence, BITS Jobs ,Usual bitsadmin commands to achieve persistence

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1197 |\2. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model (COM). BITS is commonly used by updaters, messengers, and other applications preferred to operate in the background (using available idle bandwidth) without interrupting other networked applications. File transfer tasks are implemented as BITS jobs, which contain a queue of one or more file operations.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de flags comunes del comando bits jobs de cara a generar persistencia REF. https://pentestlab.blog/2019/10/30/persistence-bits-jobs/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101038" level="7">
		<if_sid>100109</if_sid>
		<field name="win.eventdata.commandLine">/create|/addfile|/SetNotifyCmdLine|/SetMinRetryDelay|/resume</field>
		<description>Mitre ATT&CK T1197, Persistence, BITS Jobs ,Usual bitsadmin commands to achieve persistence</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1158 - Defense Evasion, Hidden Files and Directories

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may attempt to hide artifacts associated with their behaviors to evade detection. Operating systems may have features to hide various artifacts, such as important system files and administrative task execution, to avoid disrupting user work environments and prevent users from changing files or features on the system. Adversaries may abuse these features to hide artifacts such as files, directories, user accounts, or other system activity to evade detection.|

----

h3. - T1564.001, Defense Evasion, Hide Artifacts: Hidden Files and Directories, hiding files via attrib cmdlet

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1564.001 |\2. Adversaries may set files and directories to be hidden to evade detection mechanisms. To prevent normal users from accidentally changing special files on a system, most operating systems have the concept of a ‘hidden’ file. These files don’t show up when a user browses the file system with a GUI or when using normal commands on the command line. Users must explicitly ask to show the hidden files either via a series of Graphical User Interface (GUI) prompts or with command line switches (dir /a for Windows and ls –a for Linux and macOS). |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de una cuenta de usuario local|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100905" level="10">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">attrib +h|attrib +s|attrib.exe +s|attrib.exe +h</field>
		<description>Mitre ATT&CK T1564.001, Defense Evasion, Hide Artifacts: Hidden Files and Directories, hiding files via attrib cmdlet</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1564.004,  Defense Evasion, Hide Artifacts: NTFS File Attributes , Creation of ADS

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1564.004 |\2.Adversaries may modify file or directory permissions/attributes to evade access control lists (ACLs) and access protected files. File and directory permissions are commonly managed by ACLs configured by the file or directory owner, or users with the appropriate permissions. File and directory ACL implementations vary by platform, but generally explicitly designate which users or groups can perform which actions (read, write, execute, etc.).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de advanced file streams|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Security-Auditing|=.  Sysmon15 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, Command-Line Interface Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100924" level="12">
		<if_group>sysmon_event_15</if_group>
		<field name="win.system.eventID">^15$</field>
		<field name="win.system.TargetFilename">\w:\\\.*:\.*$</field>
		<description>Mitre ATT&CK T1564.004,  Defense Evasion, Hide Artifacts: NTFS File Attributes , Creation of ADS (alternate data stream) $(win.eventdata.targetFilename)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1090, Defense Evasion, Connection Proxy

{background:#dddddd}. |\3=.DESCRIPCIÓN |
|Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, reduce the number of simultaneous outbound network connections, provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion. Adversaries may chain together multiple proxies to further disguise the source of malicious traffic.|

----

h3. - T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Port fordwarding via netsh

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090.001 |\2. Adversaries may use an internal proxy to direct command and control traffic between two or more systems in a compromised environment. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use internal proxies to manage command and control communications inside a compromised environment, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between infected systems to avoid suspicion. Internal proxy connections may use common peer-to-peer (p2p) networking protocols, such as SMB, to better blend in with the environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de port fordwarding sobre RDP usando la herramienta **netsh** de cara a saltarse las restriciones de red REF. https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100906" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">\.*netsh\.*connectp=3389\.*</field>
		<description>Mitre ATT&CK T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Port fordwarding via netsh</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Tunneling via SSH I

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090.001 |\2. Adversaries may use an internal proxy to direct command and control traffic between two or more systems in a compromised environment. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use internal proxies to manage command and control communications inside a compromised environment, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between infected systems to avoid suspicion. Internal proxy connections may use common peer-to-peer (p2p) networking protocols, such as SMB, to better blend in with the environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de túneles RDP mediante SSH de cara a saltarse las restriciones de red REF. https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon 3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
|\2. Versión|\2. 2|
|\4. Se ha añadido el puerto de destino para eliminar falsos positivos |
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100701" level="10">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.SourceIp">127.\.*|::1</field>
		<field name="win.eventdata.DestinationIp">127.\.*|::1</field>  
        <field name="win.eventdata.DestinationPort">^3389$|^445$</field>
		<description>Mitre ATT&CK T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Tunneling via SSH</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP & SMB Tunneling using SECFORCE/Tunna

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090.001 |\2. Adversaries may use an internal proxy to direct command and control traffic between two or more systems in a compromised environment. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use internal proxies to manage command and control communications inside a compromised environment, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between infected systems to avoid suspicion. Internal proxy connections may use common peer-to-peer (p2p) networking protocols, such as SMB, to better blend in with the environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la herramienta Tunna que envuelve cualquier conexión TCP sobre HTTP para saltarse posibles protecciones de la red REF. https://github.com/SECFORCE/Tunna |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon 3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100702" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.Image">(\.*)\\w3wp.exe</field>
		<field name="win.eventdata.DestinationPort">^3389$|^445$</field>
		<field name="win.eventdata.DestinationIp">127.\.*|::1</field>   
		<description>Mitre ATT&CK T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP & SMB Tunneling using SECFORCE/Tunna</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----



h3. - T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Tunneling via SSH II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090.001 |\2. Adversaries may use an internal proxy to direct command and control traffic between two or more systems in a compromised environment. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use internal proxies to manage command and control communications inside a compromised environment, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between infected systems to avoid suspicion. Internal proxy connections may use common peer-to-peer (p2p) networking protocols, such as SMB, to better blend in with the environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza conexiones contra localhost |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60106]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100240" level="10">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4624$</field>
		<field name="win.eventdata.LogonType">10</field>
		<field name="win.eventdata.IpAddress">127.0.0.1</field>
		<description>Mitre ATT&CK T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Tunneling via SSH</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Tunneling via SSH III

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090.001 |\2. Adversaries may use an internal proxy to direct command and control traffic between two or more systems in a compromised environment. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use internal proxies to manage command and control communications inside a compromised environment, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between infected systems to avoid suspicion. Internal proxy connections may use common peer-to-peer (p2p) networking protocols, such as SMB, to better blend in with the environment. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza conexiones contra localhost |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100241" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5156$</field>
		<field name="win.eventdata.DestPort">^3389$</field>
		<field name="win.eventdata.SourceAddress">127.0.0.1</field>
		<description>Mitre ATT&CK T1090.001, Defense Evasion, Proxy: Internal Proxy, RDP Tunneling via SSH</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090.002, Command and Control, Proxy: External Proxy , traffic with destination to kwown TOR ports

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090.002 |\2. Adversaries may use an external proxy to act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths to avoid suspicion. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza tráfico de red con destino de puertos de red conocidos por ser usados por la red TOR |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100703" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">^1723$|^9001$|^9030$</field>   
		<description>Mitre ATT&CK T1090.002, Command and Control,Proxy: External Proxy  traffic with destination to kwown TOR ports</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1140, Defense Evasion, Deobfuscate/Decode Files or Information

----

h3. - T1140, Defense Evasion, Deobfuscate/Decode Files or Information, Detetcs a suspicious Microsoft certutil execution with sub commands

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1140 |\2. Adversaries may use Obfuscated Files or Information to hide artifacts of an intrusion from analysis. They may require separate mechanisms to decode or deobfuscate that information depending on how they intend to use it. Methods for doing that include built-in functionality of malware, Scripting, PowerShell, or by using utilities present on the system. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la herramienta certutil para decodificar posibles herramientas no deseadas escondidas como ficheros de certificado |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Security-Auditing|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||[[100105]]||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100916" level="12">
		<if_sid>100105</if_sid>
		<field name="win.eventdata.commandline">decode||decodehex</field>
		<description>Mitre ATT&CK T1140, Defense Evasion, Deobfuscate/Decode Files or Information, Detetcs a suspicious Microsoft certutil execution with sub commands</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1562, Impair Defenses 

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may maliciously modify components of a victim environment in order to hinder or disable defensive mechanisms. This not only involves impairing preventative defenses, such as firewalls and anti-virus, but also detection capabilities that defenders can use to audit activity and identify malicious behavior. This may also span both native defenses as well as supplemental capabilities installed by users and administrators.|

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Powershell Constrained Language Mode disabled

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza que se deshabilite las restricciones del lenguaje inherentes en powershell |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 12]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100901" level="12">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\SESSION MANAGER\\\\Environment\\\\__PSLockdownPolicy</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Powershell Constrained Language Mode disabled</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, disabled PowerShell Audit Settings if Details field has value 0x00000000

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza que se deshabilite el logueo de scripts ejecutados con powershell |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100904" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">HKLM\\\\SOFTWARE\\\\Wow6432Node\\\\Policies\\\\Microsoft\\\\Windows\\\\PowerShell\\\\ScriptBlockLogging\\\\EnableScriptBlockLogging</field>
	<!--  YOU CANNOT FILTER ON THE "Details" ATTRIBUTE, DUE TO PERFORMANCE ISSUES 
		<field name="win.eventdata.Details">DWORD (0x00000000)</field>
	-->   
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, disabled PowerShell Audit Settings if Details field has value 0x00000000</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Change in Powershell execution policy

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las modificaciones de las políticas sobre la ejecución de powershell |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100907" level="10">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">HKLM\\\\SOFTWARE\\\\Microsoft\\\\PowerShell\\\\1\\\\ShellIds\\\\Microsoft.PowerShell\\\\ExecutionPolicy</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Change in Powershell execution policy</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Disable Trust access for VBA into Office

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el que se deshabilite la notificación de consentimiento para la ejecución de visualbasic scripts embebidos en productos office |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
|\2.Versión|\2. 2|
|\3. V.2 - Se modifica el tratamiento de los conectores OR en el campo nombre|
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100908" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Software\\\\Microsoft\\\\Office\\\\\.*\\\\Excel\\\\Security\\\\AccessVBOM|\\\\Software\\\\Microsoft\\\\Office\\\\\.*\\\\PowerPoint\\\\Security\\\\AccessVBOM|\\\\Software\\\\Microsoft\\\\Office\\\\\.*\\\\Word\\\\Security\\\\AccessVBOM|\\\\Software\\\\Microsoft\\\\Office\\\\\.*\\\\Access\\\\Security\\\\AccessVBOM|\\\\Software\\\\Microsoft\\\\Office\\\\\.*\\\\Outlook\\\\Security\\\\AccessVBOM</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Disable Trust access for VBA into Office</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Sysmon driver unloaded via Filter Manager Control Program

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza que se retire el driver de sysmon, lo que hace que este proceso deje de funcionar |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100910" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">\\fltmc.exe</field>
		<field name="win.eventdata.CommandLine">\.*unload\.*sysmon\.*</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Sysmon driver unloaded via Filter Manager Control Program</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Posible sysmon driver unloading

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento de errror del sysmon que indica el fallo del driver y por tanto del programa |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100911" level="12">
		<field name="win.system.eventID">^255$</field>
		<field name="win.eventdata.ID">DriverCommunication</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Posible sysmon driver unloading</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Change in Sysmon configuration

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio en la configuración del sysmon |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100922" level="10">
		<if_group>sysmon_event_16</if_group>
		<field name="win.system.eventID">^16$</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Change in Sysmon configuration</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Sysmon Status Changed

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio de estado del sysmon |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[61606]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100923" level="10">
		<if_sid>61606</if_sid>
		<field name="win.eventdata.State">Stopped</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, Sysmon Status Changed To $(win.eventdata.State)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, jscript9.dll AMSI bypass

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la librería jscript9.dll para hacer bypass de  Antimalware Scan Interface (AMSI) |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100921" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">\.*winpm.exe|cscript.exe|wscript.exe\.*//e:{16d51579-a30b-4c8b-a276-0ff4dc41e755}</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools, jscript9.dll AMSI bypass</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools,powershell command to bypass execution policy

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.001 |\2. Adversaries may disable security tools to avoid possible detection of their tools and activities. This can take the form of killing security software or event logging processes, deleting Registry keys so that tools do not start at run time, or other methods to interfere with security tools scanning or reporting information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el bypass de powershell por comando específico |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100930" level="10">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">-ExecutionPolicy Bypass</field>
		<description>Mitre ATT&CK T1562.001, Defense Evasion, Impair Defenses: Disable or Modify Tools,powershell command to bypass execution policy</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.002 , Defense Evasion, Impair Defenses: Disable Windows Event Logging, Audit security registry deleted

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.002 |\2.Adversaries may disable Windows event logging to limit data that can be leveraged for detections and audits. Windows event logs record user and system activity such as login attempts, process creation, and much more. This data is used by security tools and analysts to generate detections.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 1102 de windows que indica que los logs de seguridad han sido borrados. |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Security-Auditing|=.  1102 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100281" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^1102$</field>
		<description>Mitre ATT&CK T1562.002 , Defense Evasion, Impair Defenses: Disable Windows Event Logging, Audit security registry deleted</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1562.004 , Defense Evasion, Impair Defenses: Disable or Modify System Firewall

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1562.004 |\2.Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage. Changes could be disabling the entire mechanism as well as adding, deleting, or modifying particular rules. This can be done numerous ways depending on the operating system, including via command-line, editing Windows Registry keys, and Windows Control Panel.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 5025 de windows que indica la parada del firewall de windows |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.  5025 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100287" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5025$</field>
		<description>Mitre ATT&CK T1562.004 , Defense Evasion, Impair Defenses: Disable or Modify System Firewall</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1070

{background:#dddddd}.|=. DESCRIPCIÓN|
|Adversaries may delete or alter generated artifacts on a host system, including logs or captured files such as quarantined malware. Locations and format of logs are platform or product-specific, however standard operating system logs are captured as Windows events or Linux/macOS files such as Bash History and /var/log/*.|

----

h3. - T1070.001, Defense Evasion, Impair Defenses: Disable Windows Event Logging, Audit security registry deleted II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1070.001 |\2.Adversaries may disable Windows event logging to limit data that can be leveraged for detections and audits. Windows event logs record user and system activity such as login attempts, process creation, and much more. This data is used by security tools and analysts to generate detections.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 1102 de windows que indica que los logs de seguridad han sido borrados. |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **10** |=. Microsoft-Windows-Security-Auditing|=.  1102 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100281" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^1102$</field>
		<description>Mitre ATT&CK T1070.001, Defense Evasion, Indicator Removal on Host: Clear Windows Event Logs, Audit security registry deleted</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1070.001, Defense Evasion, Indicator Removal on Host: Clear Windows Event Logs, Audit system registry deleted

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1070.001 |\2.Adversaries may clear Windows Event Logs to hide the activity of an intrusion. Windows Event Logs are a record of a computer's alerts and notifications. There are three system-defined sources of events: System, Application, and Security, with five event types: Error, Warning, Information, Success Audit, and Failure Audit.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Eta firma monitoriza el borrado de eventos de windows mediante el evento 104. |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.  104 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100282" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^104$</field>
		<description>Mitre ATT&CK T1070.001, Defense Evasion, Indicator Removal on Host: Clear Windows Event Logs, Audit system registry deleted</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----



h2.  T1186, Defense Evasion, Proccess Doppelganging

----

h3. - T1186, Defense Evasion, Proccess Doppelganging

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1089 |\2. Windows Transactional NTFS (TxF) was introduced in Vista as a method to perform safe file operations. To ensure data integrity, TxF enables only one transacted handle to write to a file at a given time. Until the write handle transaction is terminated, all other handles are isolated from the writer and may only read the committed version of the file that existed at the time the handle was opened. To avoid corruption, TxF performs an automatic rollback if the system or application fails during a write transaction.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza técnicas referenciadas como "Proccess Doppelganging" que básicamente se basan en procesos maliciosos intentando hacerse pasar por procesos legítimos REF. https://blog.menasec.net/2019/02/threat-hunting-24-detecting-process.html |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4985]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100287" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">4985</field>
		<match>!"data.win.eventdata.SubjectLogonId":"0x3e7"</match>
		<description>Mitre ATT&CK T1186, Defense Evasion, Proccess Doppelganging</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1070, Defense Evasion, Indicator Removal on Host

----

h3. - T1070, Defense Evasion, Indicator Removal on Host, Clearing Windows Event Logs with wevtutil

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1070 |\2.Adversaries may delete or alter generated artifacts on a host system, including logs and potentially captured files such as quarantined malware. Locations and format of logs will vary, but typical organic system logs are captured as Windows events or Linux/macOS files such as Bash History and /var/log/* .Actions that interfere with eventing and other notifications that can be used to detect intrusion activity may compromise the integrity of security solutions, causing events to go unreported. They may also make forensic analysis and incident response more difficult due to lack of sufficient data to determine what occurred.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la herramienta wevtutil para el borrado de eventos de sistemas windows.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
<rule id="100931" level="10">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandline">wevtutil cl\s|wevtutil.exe cl\s</field>
		<description>Mitre ATT&CK T1070, Defense Evasion, Indicator Removal on Host, Clearing Windows Event Logs with wevtutil</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1070, Defense Evasion, Indicator Removal on Host, Clearing Windows Event Logs with fsutil

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1070 |\2.Adversaries may delete or alter generated artifacts on a host system, including logs and potentially captured files such as quarantined malware. Locations and format of logs will vary, but typical organic system logs are captured as Windows events or Linux/macOS files such as Bash History and /var/log/* .Actions that interfere with eventing and other notifications that can be used to detect intrusion activity may compromise the integrity of security solutions, causing events to go unreported. They may also make forensic analysis and incident response more difficult due to lack of sufficient data to determine what occurred.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la herramienta wevtutil para el borrado de eventos de sistemas windows.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
<rule id="100931" level="10">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandline">fsutil usn deletejournal</field>
		<description>Mitre ATT&CK T1070, Defense Evasion, Indicator Removal on Host, Clearing Windows Event Logs with FSutil</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1222 File and Directory Permissions Modification 

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may modify file or directory permissions/attributes to evade access control lists (ACLs) and access protected files. File and directory permissions are commonly managed by ACLs configured by the file or directory owner, or users with the appropriate permissions. File and directory ACL implementations vary by platform, but generally explicitly designate which users or groups can perform which actions (read, write, execute, etc.).|

----

h3. - T1222.001, Defense Evasion, File and Directory Permissions Modification: Windows File and Directory Permissions Modification  with Set-Acl powershell cmdlet

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1222.001 |\2.Adversaries may modify file or directory permissions/attributes to evade access control lists (ACLs) and access protected files.File and directory permissions are commonly managed by ACLs configured by the file or directory owner, or users with the appropriate permissions. File and directory ACL implementations vary by platform, but generally explicitly designate which users or groups can perform which actions (read, write, execute, etc.).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del cmdlet Set-Acl e powershell para la modificación de permisos de ficheros y directorios|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100929" level="10">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">Set-Acl</field>
		<description>Mitre ATT&CK T1222.001, Defense Evasion, File and Directory Permissions Modification: Windows File and Directory Permissions Modification  with Set-Acl powershell cmdlet</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1222.001, Defense Evasion, File and Directory Permissions Modification: Windows File and Directory Permissions Modification , DACL based attacks (manipulating ACEs and AD specific Objects's Rights)

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1222.001 |\2.Adversaries may modify file or directory permissions/attributes to evade access control lists (ACLs) and access protected files. File and directory permissions are commonly managed by ACLs configured by the file or directory owner, or users with the appropriate permissions. File and directory ACL implementations vary by platform, but generally explicitly designate which users or groups can perform which actions (read, write, execute, etc.).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza los eventos 4732 y 4738 del registro de windows, cuando se producen con el resto de campos nulos, lo que es un posible indicativo de comportamiento no deseado.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, Command-Line Interface Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100283" level="10">
		<if_sid>60121</if_sid>
		<field name="win.eventdata.eventID">^4742$|^4738$</field>
		<field name="win.eventdata.SamAccountName">-</field> 
		<field name="win.eventdata.DisplayName">-</field> 
		<field name="win.eventdata.UserPrincipalName">-</field> 
		<field name="win.eventdata.HomeDirectory">-</field> 
		<field name="win.eventdata.HomePath">-</field> 
		<field name="win.eventdata.ScriptPath">-</field> 
		<field name="win.eventdata.ProfilePath">-</field> 
		<field name="win.eventdata.UserWorkstations">-</field> 
		<field name="win.eventdata.PasswordLastSet">-</field> 
		<field name="win.eventdata.AccountExpires">-</field> 
		<field name="win.eventdata.PrimaryGroupId">-</field> 
		<field name="win.eventdata.AllowedToDelegateTo">-</field> 
		<field name="win.eventdata.OldUacValue">-</field> 
		<field name="win.eventdata.NewUacValue">-</field> 
		<field name="win.eventdata.UserAccountControl">-</field> 
		<field name="win.eventdata.UserParameters">-</field>
		<field name="win.eventdata.SidHistory">-</field> 
		<field name="win.eventdata.LogonHours">-</field>
		<field name="win.eventdata.DnsHostName">-</field> 
		<field name="win.eventdata.ServicePrincipalNames">-</field>
		<description>Mitre ATT&CK T1222.001, Defense Evasion, File and Directory Permissions Modification: Windows File and Directory Permissions Modification , DACL based attacks (manipulating ACEs and AD specific Objects's Rights)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1574 Hijack Execution Flow

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may execute their own malicious payloads by hijacking the way operating systems run programs. Hijacking execution flow can be for the purposes of persistence, since this hijacked execution may reoccur over time. Adversaries may also use these mechanisms to elevate privileges or evade defenses, such as application control or other restrictions on execution.|

----

h3. - T1574.002, Defense Evasion, Hijack Execution Flow: DLL Side-Loading, DLL not signed loaded

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1574.002 |\2.Adversaries may execute their own malicious payloads by hijacking the library manifest used to load DLLs. Adversaries may take advantage of vague references in the library manifest of a program by replacing a legitimate library with a malicious one, causing the operating system to load their malicious library when it is called for by the victim program.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la carga de biblilotecas dinámicas sin firmar, esto puede suponer bibliotecas de origenes desconocidos y maliciosas|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=.  Sysmon13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100903" level="10">
		<if_group>sysmon_event7</if_group>
		<field name="win.eventdata.Signed">false</field>
		<field name="win.eventdata.ImageLoaded">\.*\.dll$</field>
		<description>Mitre ATT&CK T1574.002, Defense Evasion, Hijack Execution Flow: DLL Side-Loading, DLL not signed loaded</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1574.007, Defense Evasion, Hijack Execution Flow: Path Interception by PATH Environment Variable

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1574.007 |\2.Adversaries may execute their own malicious payloads by hijacking environment variables used to load libraries. Adversaries may place a program in an earlier entry in the list of directories stored in the PATH environment variable, which Windows will then execute when it searches sequentially through that PATH listing in search of the binary that was called from a script or the command line.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la variable de entorno path|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=.  Sysmon13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100937" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Environment\\\\Path</field>
		<description>Mitre ATT&CK T1574.007, Defense Evasion, Hijack Execution Flow: Path Interception by PATH Environment Variable</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1574.012, Defense Evasion, Hijack Execution Flow: COR_PROFILER

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1574.012 |\2.Adversaries may leverage the COR_PROFILER environment variable to hijack the execution flow of programs that load the .NET CLR. The COR_PROFILER is a .NET Framework feature which allows developers to specify an unmanaged (or external of .NET) profiling DLL to be loaded into each .NET process that loads the Common Language Runtime (CLR). These profiliers are designed to monitor, troubleshoot, and debug managed code executed by the .NET CLR|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la variable de entorno COR_PROFILER|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=.  Sysmon13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100938" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Environment\\\\COR_PROFILER</field>
		<description>Mitre ATT&CK T1574.012, Defense Evasion, Hijack Execution Flow: COR_PROFILER </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1112, Defense Evasion, Modify Registry

----

h3. - T1112, Defense Evasion, Modify Registry

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1112 |\2. Adversaries may interact with the Windows Registry to hide configuration information within Registry keys, remove information as part of cleaning up, or as part of other techniques to aid in persistence and execution. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario **reg.exe** que permite editar o modificar el registro |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operationa|=.  Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100114" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\reg.exe</field>
		<description>Mitre ATT&CK T1112, Defense Evasion, Modify Registry</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1112, Defense Evasion, Modify Registry over the network

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1112 |\2. Adversaries may interact with the Windows Registry to hide configuration information within Registry keys, remove information as part of cleaning up, or as part of other techniques to aid in persistence and execution. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de red del binario **reg.exe** que permite editar o modificar el registro |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operationa|=. Sysmon_event 3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100115" level="10">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.image">\\reg.exe</field>
		<description>Mitre ATT&CK T1112, Defense Evasion, Modify Registry over the network</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1112, Defense Evasion, Modify Registry, manually added or deleted registry keys

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1112 |\2. Adversaries may interact with the Windows Registry to hide configuration information within Registry keys, remove information as part of cleaning up, or as part of other techniques to aid in persistence and execution. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario **reg.exe** para añadir o borrar entradas de registro |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operationa|=. Sysmon_event 3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1112, Defense Evasion, Modify Registry|100114]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101926" level="7">
		<if_sid>100114</if_sid>
		<field name="win.eventdata.commandline">\sadd\s|\sdelete\s|\sADD\s|\sDELETE\s</field>
		<description>Mitre ATT&CK T1112, Defense Evasion, Modify Registry, manually added or deleted registry keys</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1207, Defense Evasion, Rogue Domain Controller

----

h3. - T1207, Defense Evasion, Rogue Domain Controller

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1207 |\2. Adversaries may register a rogue Domain Controller to enable manipulation of Active Directory data. DCShadow may be used to create a rogue Domain Controller (DC). DCShadow is a method of manipulating Active Directory (AD) data, including objects and schemas, by registering (or reusing an inactive registration) and simulating the behavior of a DC. Once registered, a rogue DC may be able to inject and replicate changes into AD infrastructure for any domain object, including credentials and keys.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza los intentos de replicación del Active Directory, debería de revisarse que el origen que intenta la replicación sea legítimo. |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.   Windows event 4928,4929 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100280" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4928$|^4929$</field>
		<description>Mitre ATT&CK T1207, Defense Evasion, Rogue Domain Controller, Check if the source of events is not a legitimate domain controller</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1014, Defense Evasion, Rootkit

----

h3. - T1014, Defense Evasion, Rootkit, Detects a driver load from a temporary directory

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1014 |\2. Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las cargas de drivers desde carpetas temporales, este comportamiento es conocido entre rootkits |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=.   Sysmon_event 6 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100917" level="12">
		<if_group>sysmon_event6</if_group>
		<field name="win.eventdata.imageLoaded">\\Temp</field>
		<description>Mitre ATT&CK T1014, Defense Evasion, Rootkit, Detects a driver load from a temporary directory</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1014 , Defense Evasion, Rootkit, Boot Configuration Data loaded allowing unsigned drivers to load

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1014 |\2. Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las cargas de drivers sin firmar |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.   Windows_event 4826 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100284" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4826$</field>
		<field name="win.eventdata.DisableIntegrityCheck">%%1842</field>
		<description>Mitre ATT&CK T1014 , Defense Evasion, Rootkit, Boot Configuration Data loaded allowing unsigned drivers to load</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1014 , Defense Evasion, Rootkit, Boot Configuration Data loaded allowing hypervisor debbuging

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1014 |\2. Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio de modificación de arranque para permitir el "debbuging" del hypervisor |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.   Windows_event 4826 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100285" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4826$</field>
		<field name="win.eventdata.HypervisorDebug">%%1842</field>
		<description>Mitre ATT&CK T1014 , Defense Evasion, Rootkit, Boot Configuration Data loaded allowing hypervisor debbuging</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1014 , Defense Evasion, Rootkit, Boot Configuration Data loaded allowing kernel debbuging

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1014 |\2. Adversaries may use rootkits to hide the presence of programs, files, network connections, services, drivers, and other system components. Rootkits are programs that hide the existence of malware by intercepting/hooking and modifying operating system API calls that supply system information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio de modificación de arranque para permitir el "debbuging" del kernel |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=.   Windows_event 4826 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100286" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4826$</field>
		<field name="win.eventdata.KernelDebug">%%1842</field>
		<description>Mitre ATT&CK T1014 , Defense Evasion, Rootkit, Boot Configuration Data loaded allowing kernel debbuging</description>
		<options>no_full_log</options>
	</rule> 
</code></pre>

----

h2.  T1218, Defense Evasion, Signed Binary Proxy Execution

{background:#dddddd}. |\3=. DESCRIPCIÓN |
|Adversaries may bypass process and/or signature-based defenses by proxying execution of malicious content with signed binaries. Binaries signed with trusted digital certificates can execute on Windows systems protected by digital signature validation. Several Microsoft signed binaries that are default on Windows installations can be used to proxy execution of other files.|

----

h3. - T1218.002, Defense Evasion, Control Panel, control panel items

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T11218.002 |\2. Adversaries may abuse control.exe to proxy execution of malicious payloads. The Windows Control Panel process binary (control.exe) handles execution of Control Panel items, which are utilities that allow users to view and adjust computer settings. Control Panel items are registered executable (.exe) or Control Panel (.cpl) files, the latter are actually renamed dynamic-link library (.dll) files that export a CPlApplet function.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario control.exe para posible ejecución de comandos |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[61603]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100947" level="10">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandline">control.exe\.*.cpl</field>
		<description>Mitre ATT&CK T1218.002, Defense Evasion, Control Panel, control panel items</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.003, Defense Evasion, Signed Binary Proxy Execution: CMSTP , CMSTP code execution - bypass application whitelisting

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1218.003 |\2. Adversaries may abuse CMSTP to proxy execution of malicious code. The Microsoft Connection Manager Profile Installer (CMSTP.exe) is a command-line program used to install Connection Manager service profiles.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza la ejecución de código con la herramienta cmstp.exe REF . https://ired.team/offensive-security/code-execution/t1191-cmstp-code-execution |
{background:#dddddd}. |=. Nivel |=. Origen|=.ID Evento |
|={background:#f49191}. **12** |=.Microsoft-Windows-Sysmon/Operational |=.[[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]]  |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
| | | |
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100948" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">cmstp.exe /s</field>
		<description>Mitre ATT&CK T1218.003, Defense Evasion, Signed Binary Proxy Execution: CMSTP , CMSTP code execution - bypass application whitelisting</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.005, Defense Evasion, Signed Binary Proxy Execution: Mshta, Mshta

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1218.005 |\2. Adversaries may abuse mshta.exe to proxy execution of malicious .hta files and Javascript or VBScript through a trusted Windows utility. There are several examples of different types of threats leveraging mshta.exe during initial compromise and for execution of code|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de Mshta (Microsoft HTML Applications), este binario puede ejecutar HTA apps REF. https://www.varonis.com/blog/living-off-the-land-lol-with-microsoft-part-ii-mshta-hta-and-ransomware/| 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
||||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100101" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\mshta.exe</field>
		<description>Mitre ATT&CK T1218.005, Defense Evasion, Signed Binary Proxy Execution: Mshta, Microsoft HTML Application execution</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.005, Defense Evasion, Signed Binary Proxy Execution: Mshta, Microsoft HTML Application execution

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1218.005 |\2. Adversaries may abuse mshta.exe to proxy execution of malicious .hta files and Javascript or VBScript through a trusted Windows utility. There are several examples of different types of threats leveraging mshta.exe during initial compromise and for execution of code. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.Esta firma monitoriza el uso de Mshta (Microsoft HTML Applications) via powershell, este binario puede ejecutar HTA apps REF. https://www.varonis.com/blog/living-off-the-land-lol-with-microsoft-part-ii-mshta-hta-and-ransomware/ | 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1170 - Microsoft HTML Application execution|100101]] |||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100952" level="12">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.CommandLine">mshta.exe</field>
		<description>Mitre ATT&CK T1218.005, Defense Evasion, Signed Binary Proxy Execution: Mshta, Microsoft HTML Application execution via $(win.eventdata.Image)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.005, Defense Evasion, Signed Binary Proxy Execution: Mshta, Mshta

----

{background:#dddddd}. |=. ID |\2=. DESCRIPCIÓN |
| T1218.005 |\2. Adversaries may abuse mshta.exe to proxy execution of malicious .hta files and Javascript or VBScript through a trusted Windows utility. There are several examples of different types of threats leveraging mshta.exe during initial compromise and for execution of code|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de Mshta (Microsoft HTML Applications) en red, este binario puede ejecutar HTA apps REF. https://www.varonis.com/blog/living-off-the-land-lol-with-microsoft-part-ii-mshta-hta-and-ransomware/| 
{background:#dddddd}. |=. Nivel |=. Origen |=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational |=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas ||
||||
{background:#dddddd}. |\3=. CÓDIGO |

 <pre><code class="xml">
	<rule id="100951" level="10">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.Image">\\mshta.exe</field>
		<description>Mitre ATT&CK T1218.005, Defense Evasion, Signed Binary Proxy Execution: Mshta, Mshta</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.007, Defense Evasion, Signed Binary Proxy Execution: Msiexec

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.007 |\2. Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario msiexec.exe  "The Windows Installer" para la ejecución de comandos saltandose las restricciones por aplicación |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100927" level="6">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentImage">msiexec.exe</field>
		<description>Mitre ATT&CK T1218.007, Defense Evasion, Signed Binary Proxy Execution: Msiexec, Msiexec.exe has executed $(win.eventdata.CommandLine)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.008, Defense Evasion, Signed Binary Proxy Execution: Odbcconf, Load DLL specified in target .RSP file

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.008 |\2. Adversaries may abuse odbcconf.exe to proxy execution of malicious payloads. Odbcconf.exe is a Windows utility that allows you to configure Open Database Connectivity (ODBC) drivers and data source names.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario odbcconf.exe (Open Database Connectivity configurator) para la ejecución de comandos saltandose las restricciones por aplicación |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100939" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">odbcconf.exe</field>
		<field name="win.eventdata.CommandLine">-f</field>
		<description>Mitre ATT&CK T1218.008, Defense Evasion, Signed Binary Proxy Execution: Odbcconf, Load DLL specified in target .RSP file</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.008, Defense Evasion, Signed Binary Proxy Execution: Odbcconf, Execute DllREgisterServer from DLL

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.008 |\2. Adversaries may abuse odbcconf.exe to proxy execution of malicious payloads. Odbcconf.exe is a Windows utility that allows you to configure Open Database Connectivity (ODBC) drivers and data source names.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario odbcconf.exe (Open Database Connectivity configurator) para la ejecución de comandos saltandose las restricciones por aplicación |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100940" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">odbcconf.exe</field>
		<field name="win.eventdata.CommandLine">/A -encodedCommand</field>
		<description>Mitre ATT&CK T1218.008, Defense Evasion, Signed Binary Proxy Execution: Odbcconf, Execute DllREgisterServer from DLL</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.009, Defense Evasion, Signed Binary Proxy Execution: Regsvcs/Regasm, Loads the target .DLL

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.009 |\2. Adversaries may abuse Regsvcs and Regasm to proxy execution of code through a trusted Windows utility. Regsvcs and Regasm are Windows command-line utilities that are used to register .NET Component Object Model (COM) assemblies. Both are digitally signed by Microsoft.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario regasm.exe (Assembly Registration Tool) para la ejecución de comandos saltandose las restricciones por aplicación |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100941" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">regasm.exe</field>
		<field name="win.eventdata.CommandLine">/U</field>
		<description>Mitre ATT&CK T1218.009, Defense Evasion, Signed Binary Proxy Execution: Regsvcs/Regasm, Loads the target .DLL</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.009, Defense Evasion, Signed Binary Proxy Execution: Regsvcs/Regasm, Loads the target .DLL

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.009 |\2. Adversaries may abuse Regsvcs and Regasm to proxy execution of code through a trusted Windows utility. Regsvcs and Regasm are Windows command-line utilities that are used to register .NET Component Object Model (COM) assemblies. Both are digitally signed by Microsoft.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario regsvcs.exe (.NET Services Installation Tool) para la ejecución de comandos saltandose las restricciones por aplicación |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100942" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">regsvcs.exe</field>
		<field name="win.eventdata.CommandLine">/U</field>
		<description>Mitre ATT&CK T1218.009, Defense Evasion, Signed Binary Proxy Execution: Regsvcs/Regasm, Loads the target .DLL</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.010,  Defense Evasion, Signed Binary Proxy Execution: Regsvr32

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.010 |\2. Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. Regsvr32.exe can be used to execute arbitrary binaries. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del bianrio regsrv32.exe | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100107" level="0">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\regsvr32.exe</field>
		<description>Mitre ATT&CK T1218.010,  Defense Evasion, Signed Binary Proxy Execution: Regsvr32</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.010, Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Execution of regsvr32.exe from a temporal folder

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.010 |\2. Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. Regsvr32.exe can be used to execute arbitrary binaries. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del bianrio regsrv32.exe desde una ruta temporal, este comportamiento es totalmente anómalo| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100949" level="12">
		<if_sid>100107</if_sid>
		<field name="win.eventdata.commandline">\\Temp</field>
		<description>Mitre ATT&CK T1218.010, Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Execution of regsvr32.exe from a temporal folder</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.010, Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Execution of powershel through rundll32

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.010 |\2. Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. Regsvr32.exe can be used to execute arbitrary binaries. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución powershell mediante el bianrio regsrv32.exe | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100950" level="12">
		<if_sid>100107</if_sid>
		<field name="win.eventdata.parentImage">powershell.exe</field>
		<description>Mitre ATT&CK T1218.010, Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Execution of powershel through rundll32</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.010, Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Executing Regsvr32 Living off the Land Binaries

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.010 |\2. Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. Regsvr32.exe can be used to execute arbitrary binaries. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del bianrio regsrv32.exe a través de la red| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100944" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.Image">\\regsvr32.exe</field>
		<description>Mitre ATT&CK T1218.010, Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Executing Regsvr32 Living off the Land Binaries</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.010,  Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Squiblydoo technique

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.010 |\2. Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. Regsvr32.exe can be used to execute arbitrary binaries. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de Scripts remotos Via regsvr32.exe REF. https://twitter.com/hashtag/squiblydoo| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100943" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">\\regsvr32.exe</field>
		<field name="win.eventdata.CommandLine">\.*regsvr32\.*/i\.*scrobj.dll</field>
		<description>Mitre ATT&CK T1218.010,  Defense Evasion, Signed Binary Proxy Execution: Regsvr32, Squiblydoo technique</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100100" level="0">
		<if_group>sysmon_event1</if_group>	   
		<field name="win.eventdata.Image">\\rundll32.exe</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Internet Connection from Rundll32

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe via red | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100104" level="0">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.image">rundll32.exe</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Internet Connection from Rundll32</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Detects a rundll32 that communicates with public IP addresses

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1085 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario Rundll32.exe para la comunicación con ip's públicas| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<var name="local_net_1">192.168.1</var>

	<rule id="100915" level="10">
		<if_sid>100104</if_sid>
		<match>!"DestinationIp":"$local_net_1</match>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Detects a rundll32 that communicates with public IP addresses</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe utilizando dll's (ieframe.dll/url.dll) que pueden utilizar el API OpenUrl para lanzar url's que pueden contener binarios con un path local  REF. http://www.hexacorn.com/blog/2018/03/15/running-programs-via-proxy-jumping-on-a-edr-bypass-trampoline-part-5/ | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100955" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*ieframe.dll|url.dll|shdocvw.dll,OpenURL\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion -2

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe utilizando dll's (ieframe.dll/url.dll) que puede utilizar el API OpenUrlA para lanzar url's que pueden contener binarios con un path local  REF. http://www.hexacorn.com/blog/2018/03/15/running-programs-via-proxy-jumping-on-a-edr-bypass-trampoline-part-5/ | 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100956" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*url.dll, OpenURLA\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion - 3

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe para lanzar binarios saltandose el bloqueo de aplicaciones de windows  REF. http://www.hexacorn.com/blog/2017/05/01/running-programs-via-proxy-jumping-on-a-edr-bypass-trampoline/| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100957" level="12">
		<if_sid>100100</if_sid>
		<field name="win.eventdata.Image">\\rundll32.exe</field>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*url.dll, FileProtocolHandler\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion - 4

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe para lanzar binarios saltandose el bloqueo de aplicaciones de windows  REF. http://www.hexacorn.com/blog/2017/05/01/running-programs-via-proxy-jumping-on-a-edr-bypass-trampoline/| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100958" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*zipfldr.dll, RouteTheCall\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion - 5

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe para lanzar binarios saltandose el bloqueo de aplicaciones de windows  REF. http://www.hexacorn.com/blog/2020/02/05/stay-positive-lolbins-not/| 
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100959" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*advpack.dll,RegisterOCX \.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion - 6

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe para lanzar binarios REF. https://lolbas-project.github.io/lolbas/Libraries/Pcwutl/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100960" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*pcwutl.dll,LaunchApplication  \.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion - 7

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe para lanzar binarios REF. https://lolbas-project.github.io/lolbas/Libraries/Shell32/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100961" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*Shell32.dll,Control_RunDLL\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Rundll32 Living off the Land Endpoint Detection and Response (EDR) evasion </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Component Object Model and Distributed COM

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe para lanzar binarios mediante el tag AppId  |
|\3. - Excel.Application (AppId = {00020812-0000-0000-C000-000000000046}  |
|\3. - Word.Application (AppId = {00020906-0000-0000-C000-000000000046}  |
|\3. - Poewrpoint.Application (AppId = {048EB43E-2059-422F-95E0-557DA96038AF} | 
|\3. - Outlook.Application (AppId = {0006F04A-0000-0000-C000-000000000046} |
|\3. - Visio.Application (AppId = {00021A20-0000-0000-C000-000000000046}  |
|\3. - ShellWindows (AppId = {9BA05972-F6A8-11CF-A42-00A0C90A8F39}  |
|\3. - ShellbrowserWindows (AppId = {c08afd90-f2a1-11d1-8455-00a0c91f3880}  |
|\3. - MMC20.Application (AppId = {7e0423cd-11198-0928-900c-e6d4a52a0715}  |
|\3. - HTML Application (AppId = {40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91} |  
|\3. - WScript.Shell.1(Clsid = {72C24DD5-D70A-438B-8A42-98424B88AFB8}  |
|\3.- Shell.Application.1 (Clsid = {13709620-C279-11CE-A49E-444553540000} |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
| [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100963" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*{00020812-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{00020906-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{048EB43E-2059-422F-95E0-557DA96038AF}\.*|\.*rundll32.exe\.*{0006F04A-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{00021A20-0000-0000-C000-000000000046}\.*|\.*rundll32.exe\.*{9BA05972-F6A8-11CF-A42-00A0C90A8F39}\.*|\.*rundll32.exe\.*{c08afd90-f2a1-11d1-8455-00a0c91f3880}\.*|\.*rundll32.exe\.*{7e0423cd-11198-0928-900c-e6d4a52a0715}\.*|\.*rundll32.exe\.*{40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91}\.*|\.*rundll32.exe\.*{72C24DD5-D70A-438B-8A42-98424B88AFB8}\.*|\.*rundll32.exe\.*{13709620-C279-11CE-A49E-444553540000}\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Component Object Model and Distributed COM </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Component Object Model and Distributed COM -2

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe para lanzar binarios usando dllhost.dll y mediante el tag AppId 
 - Excel.Application (AppId = {00020812-0000-0000-C000-000000000046}  
 - Word.Application (AppId = {00020906-0000-0000-C000-000000000046}  
 - Poewrpoint.Application (AppId = {048EB43E-2059-422F-95E0-557DA96038AF}  
 - Outlook.Application (AppId = {0006F04A-0000-0000-C000-000000000046}  
 - Visio.Application (AppId = {00021A20-0000-0000-C000-000000000046}  
 - ShellWindows (AppId = {9BA05972-F6A8-11CF-A42-00A0C90A8F39}  
 - ShellbrowserWindows (AppId = {c08afd90-f2a1-11d1-8455-00a0c91f3880}  
 - MMC20.Application (AppId = {7e0423cd-11198-0928-900c-e6d4a52a0715}  
 - HTML Application (AppId = {40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91}   
 - WScript.Shell.1(Clsid = {72C24DD5-D70A-438B-8A42-98424B88AFB8}  
 - Shell.Application.1 (Clsid = {13709620-C279-11CE-A49E-444553540000} |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100964" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">\\dllhost.exe</field>
		<field name="win.eventdata.CommandLine">\.*dllhost.exe\.*{00020812-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{00020906-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{048EB43E-2059-422F-95E0-557DA96038AF}\.*|\.*dllhost.exe\.*{0006F04A-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{00021A20-0000-0000-C000-000000000046}\.*|\.*dllhost.exe\.*{9BA05972-F6A8-11CF-A42-00A0C90A8F39}\.*|\.*dllhost.exe\.*{c08afd90-f2a1-11d1-8455-00a0c91f3880}\.*|\.*dllhost.exe\.*{7e0423cd-11198-0928-900c-e6d4a52a0715}\.*|\.*dllhost.exe\.*{40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91}\.*|\.*dllhost.exe\.*{72C24DD5-D70A-438B-8A42-98424B88AFB8}\.*|\.*dllhost.exe\.*{13709620-C279-11CE-A49E-444553540000}\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Component Object Model and Distributed COM, </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución del binario Rundll32.exe por por parte del control.exe, esta técnica es usada por gruposcomo **Equation Group** y varios kits de explotación automatizados|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100965" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\System32\\control.exe</field>
		<field name="win.eventdata.commandline">\\rundll32.exe</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Powershell Without Powershell.exe

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1218.011 |\2. Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de powershell mediante binario Rundll32.exe sin usar el binario powershell.exe REF. https://www.hackplayers.com/2017/06/powershdll-ejecuta-powershell-con-rundll32.html|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|  [[#- T1085 - Execution, Rundll32|100100]] |||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100962" level="12">
		<if_group>sysmon_event1</if_group>
		<if_sid>100100</if_sid>
		<field name="win.eventdata.CommandLine">\.*rundll32.exe\.*PowerShdll.dll,main\.*</field>
		<description>Mitre ATT&CK T1218.011, Defense Evasion, Signed Binary Proxy Execution: Rundll32, Execution of Powershell Without Powershell.exe</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1202, Defense Evasion, Indirect Command Execution

----

h3. - T1202, Defense Evasion, Indirect Command Execution, ftp.exe has executed a command

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1202 |\2. Adversaries may abuse utilities that allow for command execution to bypass security restrictions that limit the use of command-line interpreters. Various Windows utilities may be used to execute commands, possibly without invoking cmd. For example, Forfiles, the Program Compatibility Assistant (pcalua.exe), components of the Windows Subsystem for Linux (WSL), as well as other utilities may invoke the execution of programs and commands from a Command and Scripting Interpreter, Run window, or via scripts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario ftp.exe con la opción -s para la ejecución de comandos saltandose las restricciones por aplicación. |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100945" level="10">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentCommandLine">\.*ftp -s:\.*|\.*ftp.exe -s:\.*</field>
		<field name="win.eventdata.commandline">\.*cmd.exe /C\.*</field>
		<description>Mitre ATT&CK T1202, Defense Evasion, Indirect Command Execution, ftp.exe has executed $(win.eventdata.CommandLine)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1202, Defense Evasion, Indirect Command Execution, Program Compatibility Assistant (pcalua.exe) has executed a command

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1202 |\2. Adversaries may abuse utilities that allow for command execution to bypass security restrictions that limit the use of command-line interpreters. Various Windows utilities may be used to execute commands, possibly without invoking cmd. For example, Forfiles, the Program Compatibility Assistant (pcalua.exe), components of the Windows Subsystem for Linux (WSL), as well as other utilities may invoke the execution of programs and commands from a Command and Scripting Interpreter, Run window, or via scripts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario pcalua.exe (Program compatibility assistant) dado que puede usarse para la ejecución de comandos y podría saltarse la restricción de uso de aplicaciones|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_Event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100946" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentCommandLine">\.*pcalua.exe -a\.*</field>
		<description>Mitre ATT&CK T1202, Defense Evasion, Indirect Command Execution, Program Compatibility Assistant (pcalua.exe) has executed $(win.eventdata.CommandLine)</description>
		<options>no_full_log</options>
	</rule
</code></pre>

----

h3. - T1202,  Defense Evasion, Indirect Command Execution, Forfiles Indirect Command Execution

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1202 |\2. Adversaries may abuse utilities that allow for command execution to bypass security restrictions that limit the use of command-line interpreters. Various Windows utilities may be used to execute commands, possibly without invoking cmd. For example, Forfiles, the Program Compatibility Assistant (pcalua.exe), components of the Windows Subsystem for Linux (WSL), as well as other utilities may invoke the execution of programs and commands from a Command and Scripting Interpreter, Run window, or via scripts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario forfiles.exe (Selects and runs a command on a file or set of files. This command is most commonly used in batch files.) REF. https://lolbas-project.github.io/lolbas/Binaries/Forfiles/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_Event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100909" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">\\forfiles.exe</field>
		<description>Mitre ATT&CK T1202,  Defense Evasion, Indirect Command Execution, Forfiles Indirect Command Execution</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1553, Subvert Trust Controls

{background:#dddddd}. |\3=. DESCRIPCIÓN |
|Adversaries may undermine security controls that will either warn users of untrusted activity or prevent execution of untrusted programs. Operating systems and security products may contain mechanisms to identify programs or websites as possessing some level of trust.|

----

h3. - T1553.004, Defense Evasion, Subvert Trust Controls: Install Root Certificate

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1130 |\2. Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers. Root certificates are used in public key cryptography to identify a root certificate authority (CA).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la instalación de certificados Raiz|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **5** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 12]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100912" level="5">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">HKLM\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\SystemCertificates\\\\Root\\\\Certificates</field>
		<description>Mitre ATT&CK T1553.004, Defense Evasion, Subvert Trust Controls: Install Root Certificate</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Lateral Movement

----

h2. T1028 - Lateral Movement, Windows Remote Management

----

h3. - T1028 - Lateral Movement, Windows Remote Management, Powershell remoting wsmprovhost

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1028 |\2. Windows Remote Management (WinRM) is the name of both a Windows service and a protocol that allows a user to interact with a remote system (e.g., run an executable, modify the Registry, modify services). It may be called with the winrm command or by any number of programs such as PowerShell.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de sesiones remotas de powershell REF. https://car.mitre.org/analytics/CAR-2014-11-004/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100502" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentImage">\\wsmprovhost.exe</field>
		<description>Mitre ATT&CK T1028, Lateral Movement, Windows Remote Management, Powershell remoting wsmprovhost</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

----

h3. - T1028 - Lateral Movement, Windows Remote Management, Host Process for WinRM's Remote Shell plugin

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1028 |\2. Windows Remote Management (WinRM) is the name of both a Windows service and a protocol that allows a user to interact with a remote system (e.g., run an executable, modify the Registry, modify services). It may be called with the winrm command or by any number of programs such as PowerShell.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la ejecución de sesiones remotas de powershell REF. https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100503" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentImage">\.*WinrsHost.exe\.*</field>
		<description>Mitre ATT&CK T1028, Lateral Movement, Windows Remote Management, Host Process for WinRM's Remote Shell plugin</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1077, Lateral movement, Windows admin shares

----

h3. - T1077, Lateral movement, Windows admin shares I

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1077 |\2. Windows systems have hidden network shares that are accessible only to administrators and provide the ability for remote file copy and other administrative functions. Example network shares include C$, ADMIN$, and IPC$. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento de windows 5145 que indica que se ha comprobado un recurso compartido en red centrandose en los recursos del administrador |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. 5145 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[60103]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100200" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5145$</field>
		<field name="win.eventdata.ShareName">\.*(d\$)|(admin\$)|(c\$)|(C\$)|(ipc\$)|(IPC\$)\.*</field>
		<description>Mitre ATT&CK T1077, Lateral movement, Windows admin shares</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1077, Lateral movement, Windows admin shares using command line

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1077 |\2. Windows systems have hidden network shares that are accessible only to administrators and provide the ability for remote file copy and other administrative functions. Example network shares include C$, ADMIN$, and IPC$. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la línea de comandos para la comprobación de recursos compartidos en red con la herramienta **net use**|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100507" level="10">
        <if_sid>100117</if_sid>
        <field name="win.eventdata.commandLine">net use\.*\\d\$|net use\.*\\admin\$|net use\.*\\c\$|net use\.*\\C\$|net use\.*\\ipc\$|net use\.*\\IPC\$</field>
        <description>Mitre ATT&CK T1077, Lateral movement, Windows admin shares using command line</description>
        <options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1077, Lateral movement, Windows admin shares using powershell

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1077 |\2. Windows systems have hidden network shares that are accessible only to administrators and provide the ability for remote file copy and other administrative functions. Example network shares include C$, ADMIN$, and IPC$. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de powershell para la comprobación de recursos compartidos en red con el cmdlet **New-PSDrive**|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100508" level="10">
        <if_sid>100113</if_sid>
        <field name="win.eventdata.commandLine">New-PSDrive\.*\\d\$|New-PSDrive\.*\\admin\$|New-PSDrive\.*\\c\$|New-PSDrive\.*\\C\$|New-PSDrive\.*\\ipc\$|New-PSDrive\.*\\IPC\$</field>
        <description>Mitre ATT&CK T1077, Lateral movement, Windows admin shares using powershell</description>
        <options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1077, Lateral movement, Windows admin shares, Remote Procedure Calls (RPCs)

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Windows systems have hidden network shares that are accessible only to administrators and provide the ability for remote file copy and other administrative functions. Example network shares include C$, ADMIN$, and IPC$. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la el intento de acceder con credenciales elevadas mediante "Remote Procedure Call" REF. https://twitter.com/menasec1/status/1107613181520855041|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4648]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100203" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4648$</field>
		<field name="win.eventdata.TargetInfo">(\.*)RPCSS(\.*)</field>
		<description>Mitre ATT&CK T1077, Lateral movement, Windows admin shares, Remote Procedure Calls (RPCs)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1077, Lateral movement, Windows admin shares

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1098 |\2. Windows systems have hidden network shares that are accessible only to administrators and provide the ability for remote file copy and other administrative functions. Example network shares include C$, ADMIN$, and IPC$. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza los accesos a los recursos compartidos, en especial a los "escondidos" con permisos administrativos como son **C$**, **ADMIN$** y **IPC$**|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5145]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100200" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5145$</field>
		<field name="win.eventdata.ShareName">\.*(d\$)|(admin\$)|(c\$)|(C\$)|(ipc\$)|(IPC\$)\.*</field>
		<description>Mitre ATT&CK T1077, Lateral movement, Windows admin shares</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1210, Lateral Movement , Exploitation of Remote Services

----

h3. - T1210, Lateral Movement , Exploitation of Remote Services, Detects a JAVA process running with remote debugging allowing more than just localhost to connect

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1210 |\2. Exploitation of a software vulnerability occurs when an adversary takes advantage of a programming error in a program, service, or within the operating system software or kernel itself to execute adversary-controlled code. A common goal for post-compromise exploitation of remote services is for lateral movement to enable access to a remote system. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza procesos JAVA que permite conexiones a localizaciones fuera del localhost lo que puede permitir las conexiones a otras máquinas en la red a atacantes |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100506" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.commandline">transport=dt_socket,address=</field>
		<description>Mitre ATT&CK T1210, Lateral Movement , Exploitation of Remote Services, Detects a JAVA process running with remote debugging allowing more than just localhost to connect</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1021, Lateral Movement, Remote Services

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may use Valid Accounts to log into a service specifically designed to accept remote connections, such as telnet, SSH, and VNC. The adversary may then perform actions as the logged-on user.|

----

h3. - T1021.001, Lateral movement, Remote Services: Remote Desktop Protocol, Blocked Inbound packets to known Lateral Movement Ports

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1021.001 |\2.Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza bloqueos del firewall de windows hacia puertos de samba o RDP que pueden ser usados para el acceso a la máquina|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5152]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60104]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100207" level="3">
		<if_sid>60104</if_sid>
		<field name="win.system.eventID">^5152$</field>
		<field name="win.eventdata.DestPort">^3389$</field>
		<description>Mitre ATT&CK T1021.001, Lateral movement, Remote Services: Remote Desktop Protocol, Blocked Inbound packets to known Lateral Movement Ports</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1021.002, Lateral movement, Remote Services: SMB/Windows Admin Shares , Blocked Inbound packets to known Lateral Movement Ports

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1021.002 |\2. Adversaries may use Valid Accounts to interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza bloqueos del firewall de windows hacia puertos de samba o RDP que pueden ser usados para el acceso a la máquina|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5152]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60104]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100204" level="3">
		<if_sid>60104</if_sid>
		<field name="win.system.eventID">^5152$</field>
		<field name="win.eventdata.DestPort">^445$</field>
		<description>Mitre ATT&CK T1021.002, Lateral movement, Remote Services: SMB/Windows Admin Shares , Blocked Inbound packets to known Lateral Movement Ports</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1021.004, Lateral Movement, Remote Services: SSH

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1021.004 |\2. Adversaries may use Valid Accounts to log into remote machines using Secure Shell (SSH). The adversary may then perform actions as the logged-on user.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las conexiones aceptadas a puertos VNC|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **7** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5156]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100511" level="7">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">^22$</field>   
		<description>Mitre ATT&CK T1021.004, Lateral Movement, Remote Services: SSH </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1021.005,  Lateral Movement, Remote Services: VNC, VNC Traffic

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1021.005 |\2. Adversaries may use Valid Accounts to remotely control machines using Virtual Network Computing (VNC). The adversary may then perform actions as the logged-on user.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las conexiones aceptadas a puertos VNC|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **7** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5156]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100510" level="7">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">^5800|5900$</field>   
		<description>Mitre ATT&CK T1021.005,  Lateral Movement, Remote Services: VNC, VNC Traffic</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1021.006, Lateral movement, Remote Services: Windows Remote Management, WMI Remote Access

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1021.006 |\2. Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de WMI "Windows Management Instrumentation" para el acceso remoto|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. N/A|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100504]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100202" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4648$</field>
		<field name="win.eventdata.ProcessName">C:\\Windows\\System32\\wbem\\WMIC.exe</field>
		<description>Mitre ATT&CK T1021.006, Lateral movement, Remote Services: Windows Remote Management, WMI Remote Access</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1570,  Lateral Movement, Lateral Tool Transfer, Net Share drive

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1570 |\2.Adversaries may transfer tools or other files between systems in a compromised environment. Files may be copied from one system to another to stage adversary tools or other files over the course of an operation. Adversaries may copy files laterally between internal victim systems to support lateral movement using inherent file sharing protocols such as file sharing over SMB to connected network shares or with authenticated connections with SMB/Windows Admin Shares or Remote Desktop Protocol. Files can also be copied over on Mac and Linux with native tools like scp, rsync, and sftp. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza nuevos objetos compartidos en red|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5142]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100201" level="7">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5142$</field>
		<description>Mitre ATT&CK T1570,  Lateral Movement, Lateral Tool Transfer, Net Share drive</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1550.002, Lateral movement, Use Alternate Authentication Material

{background:#dddddd}. |\3=. DESCRIPCCIÓN|
|Adversaries may use alternate authentication material, such as password hashes, Kerberos tickets, and application access tokens, in order to move laterally within an environment and bypass normal system access controls. |

----

h3. - T1550.002, Lateral movement, Use Alternate Authentication Material: Pass the Hash, Pass the Hash by user

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1552.002 |\2. Adversaries may "pass the hash" using stolen password hashes to move laterally within an environment, bypassing normal system access controls. Pass the hash (PtH) is a method of authenticating as a user without having access to the user's cleartext password|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza técnicas conocidas de pass-the-hash REF. https://cert.europa.eu/static/WhitePapers/CERT-EU_SWP_17-002_Lateral_Movements.pdf Source/Infected Host event|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60106]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100206" level="10">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4624$</field>
		<field name="win.eventdata.LogonType">9</field>
		<field name="win.eventdata.authenticationPackageName">Negotiate</field>
		<field name="win.eventdata.logonProcessName">seclogo</field>
		<description>Mitre ATT&CK T1550.002, Lateral movement, Use Alternate Authentication Material: Pass the Hash, Pass the Hash by user $(win.eventdata.targetUserName)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Privilege escalation

----

h2.  T1134 - Privilege Escalation, Access Token Manipulation

{background:#dddddd}. |=. DESCRIPCIÓN|
| Adversaries may modify access tokens to operate under a different user or system security context to perform actions and bypass access controls. Windows uses access tokens to determine the ownership of a running process. A user can manipulate access tokens to make a running process appear as though it is the child of a different process or belongs to someone other than the user that started the process. When this occurs, the process also takes on the security context associated with the new token. |

----

h3. - T1134.001, Privilege Escalation, Access Token Manipulation, **Token Impersonation/Theft**

----

h4. - T1134.001, Privilege Escalation, Access Token Manipulation, **Token Impersonation/Theft**, UAC Token Duplication

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1134.001 |\2. Adversaries may duplicate then impersonate another user's token to escalate privileges and bypass access controls. An adversary can create a new access token that duplicates an existing token using DuplicateToken(Ex). The token can then be used with ImpersonateLoggedOnUser to allow the calling thread to impersonate a logged on user's security context, or with SetThreadToken to assign the impersonated token to a thread.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el intento de login con "NewCredentials" (logon.type 9) que describiría algun tipo de "RunAS" o intento de realizar un login con una cuenta pero alternando las credenciales pudiendo adquirir el Token y por tanto los permisos de la misma|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.2.Eventos Sysmon|4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60106]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100220" level="3">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4624$</field>
		<field name="win.eventdata.LogonType">9</field>
		<description>Mitre ATT&CK T1134, Privilege Escalation, Access Token Manipulation, Token Impersonation/Theft, UAC Token Duplication</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1134.001, Privilege Escalation, Access Token Manipulation: Token Impersonation/Theft , NamedPipeImpersonation

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1134.001 |\2. Adversaries may duplicate then impersonate another user's token to escalate privileges and bypass access controls. An adversary can create a new access token that duplicates an existing token using DuplicateToken(Ex). The token can then be used with ImpersonateLoggedOnUser to allow the calling thread to impersonate a logged on user's security context, or with SetThreadToken to assign the impersonated token to a thread.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de técnicas de "Impersonation Named Pipes" REF. https://securityintelligence.com/identifying-named-pipe-impersonation-and-other-malicious-privilege-escalation-techniques/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60106]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100609" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">\.*\\\\.\\pipe\.*</field>
		<description>Mitre ATT&CK T1134.001, Privilege Escalation, Access Token Manipulation: Token Impersonation/Theft , NamedPipeImpersonation</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1134.003, Privilege Escalation, Access Token Manipulation, **Make and Impersonate Token**

----

h4. - T1134.003, Privilege Escalation, Access Token Manipulation, **Make and Impersonate Token**, Juicy Potato

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1134.003 |\2. Adversaries may make and impersonate tokens to escalate privileges and bypass access controls. If an adversary has a username and password but the user is not logged onto the system, the adversary can then create a logon session for the user using the LogonUser function. The function will return a copy of the new session's access token and the adversary can use SetThreadToken to assign the token to a thread.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el comportamiento de la herramienta Juicy Potato REF. http://ohpe.it/juicy-potato/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60106]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100221" level="10">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4624$</field>
		<field name="win.eventdata.LogonType">3</field>
		<field name="win.eventdata.TargetUserName">ANONYMOUS LOGON</field>
		<field name="win.eventdata.TargetUserSid">S-1-5-7</field>
		<field name="win.eventdata.IpAddress">127.0.0.1</field>
		<description>Mitre ATT&CK T1134, Privilege Escalation, Access Token Manipulation, Make and Impersonate Token, Juicy Potato</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1548 - Privilege Escalation, Abuse Elevation Control Mechanism

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may circumvent mechanisms designed to control elevate privileges to gain higher-level permissions. Most modern systems contain native elevation control mechanisms that are intended to limit privileges that a user can perform on a machine. Authorization has to be granted to specific users in order to perform tasks that can be considered of higher risk. An adversary can perform several methods to take advantage of built-in control mechanisms in order to escalate privileges on a system.|

----

h3. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism,**Bypass User Access Control**

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism,**Bypass User Access Control**,  Fileless UAC Bypass using sdclt.exe

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2.Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario sdctl para realizar bypass del control de usuarios REF. http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100601" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\exefile\\\\shell\\\\runas\\\\command\\\\IsolatedCommand</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control,  Fileless UAC Bypass using sdclt.exe</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, **Bypass User Access Control**,  UAC Bypass – Fodhelper - UACME 33

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2. Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el **UACME 33** (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) REF. https://github.com/hfiref0x/UACME
<pre>
    * Type: Shell API
    * Method: Registry key manipulation
    * Target(s): \system32\fodhelper.exe, \system32\computerdefaults.exe
    * Component(s): Attacker defined
    * Implementation: ucmMsSettingsDelegateExecuteMethod
    * Works from: Windows 10 TH1 (10240)
</pre>
|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100602" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\ms-settings\\\\shell\\\\open\\\\command\\\\DelegateExecute|\\\\ms-settings\\\\shell\\\\open\\\\command\\\\(Default)|\\\\ms-settings\\\\shell\\\\open\\\\command</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control,  UAC Bypass – Fodhelper - UACME 33</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, **Bypass User Access Control**, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 22

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2. Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.  Esta firma monitoriza el **UACME 22** (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) REF. https://github.com/hfiref0x/UACME
<pre>
* Type: Dll Hijack
* Method: IFileOperation, SxS DotLocal
* Target(s): \system32\consent.exe
* Component(s): comctl32.dll
* Implementation: ucmSXSMethod
* Works from: Windows 7 (7600)
</pre>
|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100604" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">\\\\AppData\\\\Local\\\\Temp\\\\comctl32.dll</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 22</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, **Bypass User Access Control**, Fileless UAC Bypass Using eventvwr.exe

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2.Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la aplicación eventviewer para relizar bypass del control del "User Account Control" REF. https://pentestlab.blog/2017/05/02/uac-bypass-event-viewer/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100603" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentCommandLine">C:\\Windows\\System32\\eventvwr.exe</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, Fileless UAC Bypass Using eventvwr.exe</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, **Bypass User Access Control**, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 23

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2. Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.  Esta firma monitoriza el **UACME 23** (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) REF. https://github.com/hfiref0x/UACME
<pre>
 * Type: Dll Hijack
 * Method: IFileOperation
 * Target(s): \system32\pkgmgr.exe
 * Component(s): DismCore.dll
 * Implementation: ucmDismMethod
 * Works from: Windows 7 (7600)
</pre>
|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100605" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">\\\\AppData\\\\Local\\\\Temp\\\\dismcore.dll</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 23</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, **Bypass User Access Control**, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 32

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2. Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.  Esta firma monitoriza el **UACME 32** (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) REF. https://github.com/hfiref0x/UACME
<pre>
* Type: Dll Hijack
* Method: UIPI bypass with uiAccess application
* Target(s): \Program Files\Windows Media Player\osk.exe, \system32\EventVwr.exe, \system32\mmc.exe
* Component(s): duser.dll, osksupport.dll
* Implementation: ucmUiAccessMethod
* Works from: Windows 7 (7600)
</pre>
|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100606" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">\\\\AppData\\\\Local\\\\Temp\\\\wow64log.dll</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 32</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, **Bypass User Access Control**, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 36

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
|  T1548.002 |\2. Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.  Esta firma monitoriza el **UACME 36** (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) REF. https://github.com/hfiref0x/UACME
<pre>
* Type: Race condition
* Method: NTFS reparse point & Dll Hijack
* Target(s): wusa.exe
* Component(s): Attacker defined
* Implementation: ucmJunctionMethod
* Works from: Windows 7 (7600)
</pre>
|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100607" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">\\\\AppData\\\\Local\\\\Temp\\\\mscoree.dll</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 36</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, **Bypass User Access Control**, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 37

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2. Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3.  Esta firma monitoriza el **UACME 37** (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) REF. https://github.com/hfiref0x/UACME
<pre>
* Type: Dll Hijack
* Method: SxS DotLocal, NTFS reparse point
* Target(s): \system32\dccw.exe
* Component(s): GdiPlus.dll
* Implementation: ucmSXSDccwMethod
*Works from: Windows 7 (7600)
</pre>
|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100608" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">\\\\AppData\\\\Local\\\\Temp\\\\GdiPlus.dll</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, UACME (Defeating Windows User Account Control by abusing built-in Windows AutoElevate backdoor) technique 37</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, CMSTP bypass user account control

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2.Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de CMSTP (Connection Manager service profile) para realizar UAC según el enlace REF. https://0x00-0x00.github.io/research/2018/10/31/How-to-bypass-UAC-in-newer-Windows-versions.html|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
    <rule id="100610" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">cmstp.exe /au</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, CMSTP bypass user account control</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, Manually turned off UAC

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1548.002 |\2.Adversaries may bypass UAC mechanisms to elevate process privileges on system. Windows User Account Control (UAC) allows a program to elevate its privileges (tracked as integrity levels ranging from low to high) to perform a task under administrator-level permissions, possibly by prompting the user for confirmation. The impact to the user ranges from denying the operation under high enforcement to allowing the user to perform the action if they are in the local administrators group and click through the prompt or allowing them to enter an administrator password to complete the action.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la desactivación manual del user access control|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100611" level="12">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.CommandLine">NOUACCHECK</field>
		<description>Mitre ATT&CK T1548.002, Privilege Escalation, Abuse Elevation Control Mechanism, Bypass User Access Control, Manually turned off UAC</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1546 Event Triggered Execution

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may establish persistence and/or elevate privileges using system mechanisms that trigger execution based on specific events. Various operating systems have means to monitor and subscribe to events such as logons or other user activity such as running specific applications/binaries. |

----

h3. - T1546.001, Persistence, Event Triggered Execution: Change Default File Association via powershell

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.001 |\2.Adversaries may establish persistence by executing malicious content triggered by a file type association. When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio de las asociaciones de aplicaciones con formatos de ficheros via powershell|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Security-Auditing|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059.001, Execution, Command and Scripting Interpreter: PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101014" level="7">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandLine">assoc\s</field>
		<description>Mitre ATT&CK T1546.001, Persistence, Event Triggered Execution: Change Default File Association via $(win.eventdata.Image)</description>
		<options>no_full_log</options>		
	</rule>
</code></pre>

----

h3. - T1546.001, Persistence, Event Triggered Execution: Change Default File Association via command line

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.001 |\2.Adversaries may establish persistence by executing malicious content triggered by a file type association. When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio de las asociaciones de aplicaciones con formatos de ficheros via powershell|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Security-Auditing|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059.003, Execution, Command and Scripting Interpreter: Windows Command Shell, Command-Line Interface Execution|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101015" level="7">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandLine">assoc\s</field>
		<description>Mitre ATT&CK T1546.001, Persistence, Event Triggered Execution: Change Default File Association via $(win.eventdata.Image)</description>
		<options>no_full_log</options>		
	</rule>
</code></pre>

----

h3. - T546.002, Persistence, Event Triggered Execution: Screensaver

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T546.002 |\2.Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension.[1] The Windows screensaver application scrnsave.scr is located in C:\Windows\System32\, and C:\Windows\sysWOW64\ on 64-bit Windows systems, along with screensavers included with base Windows installations.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza modificaciones en el registro que puedan ser indicativos del uso del "screensaver" de windows de cara a su manipulación para obtener persisencia en el sistema REF.https://attack.mitre.org/techniques/T1546/002/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101016" level="10">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Control Panel\\\\Desktop\\\\SCRNSAVE.EXE|\\\\Control Panel\\\\Desktop\\\\ScreenSaveActive|\\\\Control Panel\\\\Desktop\\\\ScreenSaverIsSecure|\\\\Control Panel\\\\Desktop\\\\ScreenSaveTimeout</field>
		<description>Mitre ATT&CK T546.002, Persistence, Event Triggered Execution: Screensaver </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.002, Persistence, Event Triggered Execution: Screensaver, Modification of screensaver executable

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.002 |\2. Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension.[1] The Windows screensaver application scrnsave.scr is located in C:\Windows\System32\, and C:\Windows\sysWOW64\ on 64-bit Windows systems, along with screensavers included with base Windows installations.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la modificación de la entrada de registro que permite a los usuarios ejecutar código después del período de inactividad pudiendo ser usado para generar persistencia REF. https://pentestlab.blog/2019/10/09/persistence-screensaver/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101035" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Control Panel\\\\Desktop\\\\SCRNSAVE.EXE</field>
		<description>Mitre ATT&CK T1546.002, Persistence, Event Triggered Execution: Screensaver, Modification of screensaver executable</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.008, Persistence, Event Triggered Execution: Accessibility Features

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.008 |\2.Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features. Windows contains accessibility features that may be launched with a key combination before a user has logged in (ex: when the user is on the Windows logon screen). An adversary can modify the way these programs are launched to get a command prompt or backdoor without logging in to the system. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso herramientas de accesibilidad de windows que pueden ser explotadas por atacantes desde la pantalla de loguin REF. https://attack.mitre.org/techniques/T1546/008/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101013" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.ParentImage">sethc.exe|utilman.exe|osk.exe|Magnify.exe|DisplaySwitch.exe|Narrator.exe|AtBroker.exe</field>
		<description>Mitre ATT&CK T1546.008, Persistence, Event Triggered Execution: Accessibility Features</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.009, Persistence, Event Triggered Execution: AppCert DLLs

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.009|\2.Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs Registry key under HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager are loaded into every process that calls the ubiquitously used application programming interface (API) functions CreateProcess, CreateProcessAsUser, CreateProcessWithLoginW, CreateProcessWithTokenW, or WinExec|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza librerias dinámicas (DLLs) que están contenidas en el valor de registro AppCertDLLs, estas pueden ser malintencionadamente usadas para generar persistencia|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
        <rule id="101017" level="3">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Control\\\\Session Manager\\\\AppCertDLLs\\\\</field>
		<description>Mitre ATT&CK T1546.009, Persistence, Event Triggered Execution: AppCert DLLs </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.010, Persistence, Event Triggered Execution: AppInit DLLs

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.010|\2.Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes. Dynamic-link libraries (DLLs) that are specified in the AppInit_DLLs value in the Registry keys HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows or HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows are loaded by user32.dll into every process that loads user32.dll. In practice this is nearly every program, since user32.dll is a very common library.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza librerias dinámicas (DLLs) que están contenidas en el valor de registro AppInit_DLLs, estas pueden ser malintencionadamente usadas para generar persistencia REF. https://attack.mitre.org/techniques/T1546/010/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101021" level="3">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows NT\\\\CurrentVersion\\\\Windows\\\\AppInit_DLLs</field>
		<description>Mitre ATT&CK T1546.010, Persistence, Event Triggered Execution: AppInit DLLs </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.010, Persistence, Event Triggered Execution: AppInit DLLs, modification of WindowsAppInit_DLLs I

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.010 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes. Dynamic-link libraries (DLLs) that are specified in the AppInit_DLLs value in the Registry keys HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows or HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows are loaded by user32.dll into every process that loads user32.dll. In practice this is nearly every program, since user32.dll is a very common library.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza librerias dinámicas (DLLs) que están contenidas en el valor de registro **WindowsAppInit_DLLs**, estas pueden ser malintencionadamente usadas para generar persistencia. REF. https://pentestlab.blog/2020/01/07/persistence-appinit-dlls/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 12 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101028" level="7">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows NT\\\\CurrentVersion\\\\WindowsAppInit_DLLs</field>
		<description>Mitre ATT&CK T1546.010, Persistence, Event Triggered Execution: AppInit DLLs, modification of WindowsAppInit_DLLs I</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.010, Persistence, Event Triggered Execution: AppInit DLLs, modification of WindowsAppInit_DLLs II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.010 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes. Dynamic-link libraries (DLLs) that are specified in the AppInit_DLLs value in the Registry keys HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows or HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows are loaded by user32.dll into every process that loads user32.dll. In practice this is nearly every program, since user32.dll is a very common library.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza librerias dinámicas (DLLs) que están contenidas en el valor de registro **WindowsAppInit_DLLs**, estas pueden ser malintencionadamente usadas para generar persistencia. REF. https://pentestlab.blog/2020/01/07/persistence-appinit-dlls/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 12 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101029" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows NT\\\\CurrentVersion\\\\WindowsAppInit_DLLs</field>
		<description>Mitre ATT&CK T1546.010, Persistence, Event Triggered Execution: AppInit DLLs, modification of WindowsAppInit_DLLs II</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.010, Persistence, Event Triggered Execution: AppInit DLLs, modification of LoadAppInit_DLLs

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.010 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes. Dynamic-link libraries (DLLs) that are specified in the AppInit_DLLs value in the Registry keys HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows or HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows are loaded by user32.dll into every process that loads user32.dll. In practice this is nearly every program, since user32.dll is a very common library.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza librerias dinámicas (DLLs) que están contenidas en el valor de registro **LoadAppInit_DLLs**, estas pueden ser malintencionadamente usadas para generar persistencia. REF. https://pentestlab.blog/2020/01/07/persistence-appinit-dlls/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 13 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101030" level="7">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows NT\\\\CurrentVersion\\\\Windows\\\\LoadAppInit_DLLs</field>
		<description>Mitre ATT&CK T1546.010, Persistence, Event Triggered Execution: AppInit DLLs </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.011, Persistence, Event Triggered Execution: Application Shimming, Installed Shim

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.011 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time. For example, the application shimming feature allows developers to apply fixes to applications (without rewriting code) that were created for Windows XP so that it will work with Windows 10.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de nuevas shims con el fin de generar persistencia REF. https://pentestlab.blog/2019/12/16/persistence-application-shimming/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 11]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
        <rule id="101003" level="12">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">C:\\\\Windows\\\\AppPatch\\\\Custom</field>
		<description>Mitre ATT&CK T1546.011, Persistence, Event Triggered Execution: Application Shimming, Installed Shim</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. -  T1546.011, Persistence, Event Triggered Execution: Application Shimming, Installed Shim II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.011 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time. For example, the application shimming feature allows developers to apply fixes to applications (without rewriting code) that were created for Windows XP so that it will work with Windows 10. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de nuevas shims con el fin de generar persistencia REF. https://pentestlab.blog/2019/12/16/persistence-application-shimming/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
        <rule id="101004" level="12">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\Custom||\\\\Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\InstalledSDB</field>
		<description>Mitre ATT&CK T1546.011, Persistence, Event Triggered Execution: Application Shimming, Installed Shim</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.011, Persistence, Event Triggered Execution: Application Shimming, use of sdbinst to install a shim

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.011 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time. For example, the application shimming feature allows developers to apply fixes to applications (without rewriting code) that were created for Windows XP so that it will work with Windows 10.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la instalación de shims, las shims permiten la compatibilidad con aplicaciones antiguas y pueden ser modificadas para obtener persistencia, REF. https://pentestlab.blog/2019/12/16/persistence-application-shimming/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **5** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101034" level="5">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">sdbinst.exe</field>
		<description>Mitre ATT&CK T1546.011, Persistence, Event Triggered Execution: Application Shimming, use of sdbinst to install a shim</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.012, Persistence, Event Triggered Execution: Image File Execution Options Injection, modification of registry Image File Execution Options

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.012 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by Image File Execution Options (IFEO) debuggers. IFEOs enable a developer to attach a debugger to an application. When a process is created, a debugger present in an application’s IFEO will be prepended to the application’s name, effectively launching the new process under the debugger (e.g., C:\dbg\ntsd.exe -g notepad.exe).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la posibilidad que windows brinda a los desarrolladores para enlazar un debuger con una aplicación pudiendo ser este "malicioso" de cara a generar persistencia REF. https://pentestlab.blog/2020/01/13/persistence-image-file-execution-options-injection/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 12 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101036" level="7">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options</field>
		<description>Mitre ATT&CK T1546.012, Persistence, Event Triggered Execution: Image File Execution Options Injection, modification of registry Image File Execution Options</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.012, Persistence, Event Triggered Execution: Image File Execution Options Injection, modification of registry Image File Execution Options

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.012 |\2. Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by Image File Execution Options (IFEO) debuggers. IFEOs enable a developer to attach a debugger to an application. When a process is created, a debugger present in an application’s IFEO will be prepended to the application’s name, effectively launching the new process under the debugger (e.g., C:\dbg\ntsd.exe -g notepad.exe).|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la posibilidad que windows brinda a los desarrolladores para enlazar un debuger con una aplicación pudiendo ser este "malicioso" de cara a generar persistencia REF. https://pentestlab.blog/2020/01/13/persistence-image-file-execution-options-injection/|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 12 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101037" level="7">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">\\\\Windows NT\\\\CurrentVersion\\\\SilentProcessExit</field>
		<description>Mitre ATT&CK T1546.012, Persistence, Event Triggered Execution: Image File Execution Options Injection, modification of registry SilentProcessExit</description>
		<options>no_full_log</options>
	</rule>	
</code></pre>

----

h3. - T1546.013, Persistence, Event Triggered Execution: PowerShell Profile, Creation of Powershell profile

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.013 |\2. Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles. A PowerShell profile (profile.ps1) is a script that runs when PowerShell starts and can be used as a logon script to customize user environments.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el cambio del perfil de powershell que puede ser usado para generar persistencia, REF. https://pentestlab.blog/2019/11/05/persistence-powershell-profile/ |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational | Sysmon_event 11|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101039" level="7">
		<if_group>sysmon_event_11</if_group>
		<field name="win.eventdata.TargetFilename">\\\\Documents\\\\WindowsPowerShell</field>
		<description>Mitre ATT&CK T1546.013, Persistence, Event Triggered Execution: PowerShell Profile, Creation of Powershell profile</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1546.015, Defense Evasion, Event Triggered Execution: Component Object Model Hijacking

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1546.015 |\2.Adversaries may establish persistence by executing malicious content triggered by hijacked references to Component Object Model (COM) objects. COM is a system within Windows to enable interaction between software components through the operating system.[1] References to various COM objects are stored in the Registry. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la técnica COM hijacking usando el objeto scrobj.dll, que permite la ejecución silenciosa de scripts mediante un proceso legítimo REF. https://docs.microsoft.com/en-us/windows/win32/com/inprocserver32 |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100933" level="10">
		<if_group>sysmon_event_13</if_group>
		<field name="win.eventdata.TargetObject">\\\\InprocServer32\\\\scrobj</field>
		<description>Mitre ATT&CK T1546.015, Defense Evasion, Event Triggered Execution: Component Object Model Hijacking </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Credential Access

----

h2.  T1110 - Credential Access, Brute Force

{background:#dddddd}. |=. DESCRIPCIÓN |
| Adversaries may use brute force techniques to gain access to accounts when passwords are unknown or when password hashes are obtained. Without knowledge of the password for an account or set of accounts, an adversary may systematically guess the password using a repetitive or iterative mechanism. Brute forcing passwords can take place via interaction with a service that will check the validity of those credentials or offline against previously acquired credential data, such as password hashes.|


----

h3. - T1110.001,  Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed.

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1110.001 |\2. Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism. An adversary may guess login credentials without prior knowledge of system or environment passwords during an operation by using a list of common passwords. Password guessing may or may not take into account the target's policies on password complexity or use policies that may lock accounts out after a number of failed attempts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el repedito fallo de autenticaciones poor parte de un usuario.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=.  N/A | N/A|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100359" timeframe="60" frequency="6" level="10">
        <if_matched_sid>100327</if_matched_sid>
        <same_field>win.eventdata.TargetUserName</same_field>
        <description>Mitre ATT&CK T1110.001,  Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed from $(win.eventdata.ipAddress) posible Kerberos spaying</description>
        <options>no_full_log</options>
    </rule>
</code></pre>

----

h3. - T1110.001,  Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed.

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1110.001 |\2. Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism. An adversary may guess login credentials without prior knowledge of system or environment passwords during an operation by using a list of common passwords. Password guessing may or may not take into account the target's policies on password complexity or use policies that may lock accounts out after a number of failed attempts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el repedito fallo de autenticaciones poor parte de un usuario.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=.  N/A | N/A|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100360" timeframe="60" frequency="6" level="10">
        <if_matched_sid>100327</if_matched_sid>
        <same_field>win.eventdata.IpAddress</same_field>
        <description>Mitre ATT&CK T1110.001, Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed from user $(win.eventdata.subjectUserSid)</description>
        <options>no_full_log</options>
    </rule>
</code></pre>

----

h3. - T1110.001,  Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed, posible Kerberos spaying

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1110.001 |\2. Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism. An adversary may guess login credentials without prior knowledge of system or environment passwords during an operation by using a list of common passwords. Password guessing may or may not take into account the target's policies on password complexity or use policies that may lock accounts out after a number of failed attempts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el repedito fallo de autenticaciones poor parte de un usuario.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=.  N/A | N/A|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100342" timeframe="60" frequency="6" level="10">
		<if_matched_sid>100323</if_matched_sid>
		<field name="win.system.eventID">^4771$</field>
		<same_field>win.eventdata.ipAddress</same_field>
		<description>Mitre ATT&CK T1110.001,  Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed from $(win.eventdata.ipAddress) posible Kerberos spaying</description>
		<options>no_full_log</options>
		<group>pci_dss_10.6.1,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,</group>
	</rule>
</code></pre>

----

h3. - T1110.001,  Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed.

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1110.001 |\2. Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism. An adversary may guess login credentials without prior knowledge of system or environment passwords during an operation by using a list of common passwords. Password guessing may or may not take into account the target's policies on password complexity or use policies that may lock accounts out after a number of failed attempts.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el repedito fallo de autenticaciones poor parte de un usuario.|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=.  N/A | N/A|
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100343" timeframe="60" frequency="6" level="10">
		<if_matched_sid>100323</if_matched_sid>
		<field name="win.system.eventID">^4771$</field>
		<same_field>win.eventdata.subjectUserSid</same_field>
		<description>Mitre ATT&CK T1110.001,  Credential Access, Brute Force: Password Guessing, Multiple Kerberos pre-authentication failed from user $(win.eventdata.subjectUserSid)</description>
		<options>no_full_log</options>
		<group>pci_dss_10.6.1,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_AU.6,</group>
	</rule>
</code></pre>

----

h2. T1003 - Credential Access

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may attempt to dump credentials to obtain account login and credential material, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform Lateral Movement and access restricted information.|

----

h3. - T1003.001, Credential Access, Credential Dumping , Procdump or Taskmgr - memory dump

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1003.001 |\2. Credential dumping is the process of obtaining account login and password information, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform Lateral Movement and access restricted information. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza los volcados de credenciales mediante dos bibliotecas dinámicas dbghelp y dbgcore REF. https://ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsass-passwords-without-mimikatz-minidumpwritedump-av-signature-bypass|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 10]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101201" level="12">
		<if_group>sysmon_event_10</if_group>
		<if_sid>100103</if_sid>
		<field name="win.eventdata.CallTrace">\.*dbghelp.dll|dbgcore.dll\.*|</field>
		<description>Mitre ATT&CK T1003, Credential Access, Credential Dumping , Procdump or Taskmgr - memory dump</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1003.001, Credential Access, OS Credential Dumping: LSASS Memory, Sekursla mimikatz module memory dump

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1003.001 |\2. Credential dumping is the process of obtaining account login and password information, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform Lateral Movement and access restricted information. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del módulo sekursla de mimikatz para realizar un volcado de credenciales|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 10]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101202" level="12">
		<if_group>sysmon_event_10</if_group>
		<if_sid>100103</if_sid>
		<field name="win.eventdata.CallTrace">\.*mimikatz\.*</field>
		<description>Mitre ATT&CK T1003.001, Credential Access, OS Credential Dumping: LSASS Memory, Sekursla mimikatz module memory dump</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1003.001, Credential Access, OS Credential Dumping: LSASS Memory, Sekursla mimikatz module memory dump

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1003.001 |\2. Credential dumping is the process of obtaining account login and password information, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform Lateral Movement and access restricted information. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la actividad de "password dumper" revisando la creación de threads remotos (EventID 8) en el proceso lsass.exe |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101202" level="12">
		<if_group>sysmon_event_10</if_group>
		<if_sid>100103</if_sid>
		<field name="win.eventdata.CallTrace">\.*mimikatz\.*</field>
		<description>Mitre ATT&CK T1003.001, Credential Access, OS Credential Dumping: LSASS Memory, Sekursla mimikatz module memory dump</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1003.001, Credential Access, OS Credential Dumping: LSASS Memory, Posible password dump using mimikatz (sekurlsa::logonpasswords)

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1003.001 |\2. Credential dumping is the process of obtaining account login and password information, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform Lateral Movement and access restricted information. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de mimikatz para la volcado de credenciales REF. https://github.com/mitre-attack/car/issues/10 |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **8** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 10]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
|\2. Versión |\2. 2|
|\4. Se ha modificado el parámetro Grant Access y se ha incluido filtro por CallTrace según se refleja en el link de la explicación |
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101204" level="8">
		<if_group>sysmon_event_10</if_group>
		<field name="win.eventdata.GrantedAccess">^0x1010$|^0x1410$|^0x1438$|^0x143a$|^0x1418$</field>
		<field name="win.eventdata.TargetImage">lsass.exe</field>
		<field name="win.eventdata.CallTrace">C:\\\\windows\\\\SYSTEM32\\\\ntdll.dll</field>
		<description>Mitre ATT&CK T1003.001, Credential Access, OS Credential Dumping: LSASS Memory, Posible password dump using mimikatz (sekurlsa::logonpasswords)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1003.006,  Credential Access, OS Credential Dumping: DCSync

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1003.006 |\2. Credential dumping is the process of obtaining account login and password information, normally in the form of a hash or a clear text password, from the operating system and software. Credentials can then be used to perform Lateral Movement and access restricted information. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la replicación de objetos del active directory relacionados con credenciales de usuarios |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4662]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100347" level="10">
		<if_matched_sid>60103</if_matched_sid>
		<field name="win.system.eventID">^4662$</field>
		<field name="win.eventdata.Properties">1131f6ad-9c07-11d1-f79f-00c04fc2dcd2|9923a32a-3607-11d2-b9be-0000f87a36b2|1131f6ac-9c07-11d1-f79f-00c04fc2dcd2</field>
		<description>Mitre ATT&CK T1003.006,  Credential Access, OS Credential Dumping: DCSync</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1555 Credentials from Password Stores 

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. There are also specific applications that store passwords to make it easier for users manage and maintain. Once credentials are obtained, they can be used to perform lateral movement and access restricted information.|

----


h3. - T1555, Credential Access, Credentials from Password Stores, Credential Vault command line interface to enumerate a user’s saved credentials

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1555 |\2.Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. There are also specific applications that store passwords to make it easier for users manage and maintain. Once credentials are obtained, they can be used to perform lateral movement and access restricted information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la línea de comandos "Credential Vault" para enumerar las credenciales guardadas por los usuarios REF. https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101205" level="10">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">\\vaultcmd.exe</field>
		<field name="win.eventdata.CommandLine">/list</field>
		<description>Mitre ATT&CK T1555, Credential Access, Credentials from Password Stores, Credential Vault command line interface to enumerate a user’s saved credentials</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. -  T1555, Credential Access, Credentials from Password Stores, Credential Vault command line interface to enumerate a user’s saved credentials via powershell

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1555 |\2.Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. There are also specific applications that store passwords to make it easier for users manage and maintain. Once credentials are obtained, they can be used to perform lateral movement and access restricted information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de powershell y comandos "Credential Vault" para enumerar las credenciales guardadas por los usuarios REF. https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101206" level="10">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.CommandLine">vaultcmd.exe*/list</field>
		<description>Mitre ATT&CK T1555, Credential Access, Credentials from Password Stores, Credential Vault command line interface to enumerate a user’s saved credentials via powershell</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1555, Credential Access, Credentials from Password Stores, Credential Vault command line interface to enumerate a user’s saved credentials via cmd

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1555 |\2.Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. There are also specific applications that store passwords to make it easier for users manage and maintain. Once credentials are obtained, they can be used to perform lateral movement and access restricted information.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la línea de comandos y la herramienta "Credential Vault" para enumerar las credenciales guardadas por los usuarios REF. https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon13]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101207" level="10">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.CommandLine">vaultcmd.exe*/list</field>
		<description>Mitre ATT&CK T1555, Credential Access, Credentials from Password Stores, Credential Vault command line interface to enumerate a user’s saved credentials via cmd</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers (Chrome)

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1555.003 |\2.Adversaries may acquire credentials from web browsers by reading files specific to the target browser. Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store; however, methods exist to extract plaintext credentials from web browsers.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Si está habilitado el evento 4663 esta firma monitoriza el uso o modificación de las carpetas que contienen las claves guardadas del explorador Chrome|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=.  Security event 4663 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100102]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100349" level="3">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4663$</field>
		<field name="win.eventdata.ObjectName">(\.*)\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Login Data(\.*)</field>
		<description>Mitre ATT&CK T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers,(Chrome) Verify that field ProcessName it's a process not related with chrome</description>
		<options>no_full_log</options>
	 </rule>
</code></pre>

----

h3. - T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers (Firefox)

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1555.003 |\2.Adversaries may acquire credentials from web browsers by reading files specific to the target browser. Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store; however, methods exist to extract plaintext credentials from web browsers.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Si está habilitado el evento 4663 esta firma monitoriza el uso o modificación de las carpetas que contienen las claves guardadas del explorador Firefox|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=.  Security event 4663 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100102]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100350" level="3">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4663$</field>
		<field name="win.eventdata.ObjectName">(\.*)\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\(\.*)\\logins.json(\.*)</field>
		<description>Mitre ATT&CK T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers, (Firefox) Verify that field ProcessName it's a process not related with firefox</description>
		<options>no_full_log</options>
	 </rule>
</code></pre>

----

h3. - T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers (Firefox)

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1555.003 |\2.Adversaries may acquire credentials from web browsers by reading files specific to the target browser. Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store; however, methods exist to extract plaintext credentials from web browsers.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Si está habilitado el evento 4663 esta firma monitoriza el uso o modificación de las carpetas que contienen las claves guardadas del explorador Firefox|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=.  Security event 4663 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100102]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100351" level="3">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4663$</field>
		<field name="win.eventdata.ObjectName">(\.*)\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\(\.*)\\key4.db(\.*)</field>
		<description>Mitre ATT&CK T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers, (Firefox) Verify that field ProcessName it's a process not related with firefox</description>
		<options>no_full_log</options>
	 </rule>
</code></pre>

----

h3. - T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers (Opera)

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1555.003 |\2.Adversaries may acquire credentials from web browsers by reading files specific to the target browser. Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store; however, methods exist to extract plaintext credentials from web browsers.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Si está habilitado el evento 4663 esta firma monitoriza el uso o modificación de las carpetas que contienen las claves guardadas del explorador Opera|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=.  Security event 4663 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100102]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100352" level="3">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4663$</field>
		<field name="win.eventdata.ObjectName">(\.*)\\AppData\\Roaming\\Opera Software\\Opera Stable\\Login Data(\.*)</field>
		<description>Mitre ATT&CK T1555.003, Credential Access, Credentials from Password Stores: Credentials from Web Browsers, (Opera) Verify that field ProcessName it's a process not related with opera browser</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1557 Man-in-the-Middle 

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may attempt to position themselves between two or more networked devices using a man-in-the-middle (MiTM) technique to support follow-on behaviors such as Network Sniffing or Transmitted Data Manipulation. By abusing features of common networking protocols that can determine the flow of network traffic (e.g. ARP, DNS, LLMNR, etc.), adversaries may force a device to communicate through an adversary controlled system so they can collect information or perform additional actions.|

----

h3. - T1557.001, Credential Access, Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay, LLMNR Multicast traffic

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1557.001 |\2. By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el tráfico Link-Local Multicast Name Resolution REF. https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **2** |=. Microsoft-Windows-Sysmon/Operationa|=.  3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101208" level="2">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">5355</field>
		<field name="win.eventdata.DestinationIp">224.0.0.252|ff01:0:0:0:0|ff02:0:0:0:0</field>
		<description>Mitre ATT&CK T1557.001, Credential Access, Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay, LLMNR Multicast traffic</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1557.001, Credential Access, Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay, NBNS Broadcast

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1557.001 |\2. By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el tráfico Netbios Name Service REF. https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **2** |=. Microsoft-Windows-Sysmon/Operationa|=.  3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101209" level="2">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">137</field>
		<field name="win.eventdata.DestinationIp">.255$</field>
		<description>Mitre ATT&CK T1557.001, Credential Access, Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay, NBNS Broadcast</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1557.001, Credential Access, Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay, mDNS traffic

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1557.001 |\2. By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el tráfico mDNS (multicacst DNS) REF. https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **2** |=. Microsoft-Windows-Sysmon/Operationa|=.  3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101210" level="2">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">5353</field>
		<field name="win.eventdata.DestinationIp">224.0.0.251</field>
		<description>Mitre ATT&CK T1557.001, Credential Access, Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay, mDNS traffic</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1558, Steal or Forge Kerberos Tickets

{background:#dddddd}. |\3=. DESCRIPCIÓN |
|Adversaries may attempt to subvert Kerberos authentication by stealing or forging Kerberos tickets to enable Pass the Ticket.|

----

h3. - T1558.003, Credential Access, Steal or Forge Kerberos Tickets: Kerberoasting

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1558.003 |\2. Adversaries may abuse a valid Kerberos ticket-granting ticket (TGT) or sniff network traffic to obtain a ticket-granting service (TGS) ticket that may be vulnerable to Brute Force.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de protocolos inseguros a la hora de generación de tickets de kerberos, lo que puede derivar en la técnica conocida como **kerberoasting** (manipular el ticket para descifrar la contraseña) |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100348" level="7">
		<if_matched_sid>60106</if_matched_sid>
		<field name="win.system.eventID">^4769$</field>
		<field name="win.eventdata.TicketOptions">0x40810000</field>
		<field name="win.eventdata.TicketEncryptionType">0x1|0x2|0x17</field>
		<description>Mitre ATT&CK T1558.003, Credential Access, Steal or Forge Kerberos Tickets: Kerberoasting, Kerberos DES or RC4 ticket requested (Low security protocols, must enable 128 or 256 AES)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1552, Unsecured Credentials

{background:#dddddd}. |\3=. DESCRIPCIÓN |
|Adversaries may search compromised systems to find and obtain insecurely stored credentials. These credentials can be stored and/or misplaced in many locations on a system, including plaintext files (e.g. Bash History), operating system or application-specific repositories (e.g. Credentials in Registry), or other specialized files/artifacts (e.g. Private Keys).|

----

h3. - T1552.002, Credential Access, Unsecured Credentials: Credentials in Registry, reg.exe query for passwords in registry

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1552.002 |\2. Adversaries may search the Registry on compromised systems for insecurely stored credentials. The Windows Registry stores configuration information that can be used by the system or other programs. Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services. Sometimes these credentials are used for automatic logons.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la utilización del binario reg.exe de cara a la busqueda de contraseñas en el registro|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Security-Auditing|=. Windows_Event 6006 or 6008 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100114]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101211" level="10">
		<if_sid>100114</sid>
		<field name="win.eventdata.CommandLine">password</field>
		<description>Mitre ATT&CK T1552.002, Credential Access, Unsecured Credentials: Credentials in Registry, reg.exe query for passwords in registry</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Collection

----

h2.  T1056,  Collection, Input Capture


{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may use methods of capturing user input to obtain credentials or collect information. During normal system usage, users often provide credentials to various different locations, such as login pages/portals or system dialog boxes. Input capture mechanisms may be transparent to the user (e.g. Credential API Hooking) or rely on deceiving the user into providing input into what they believe to be a genuine service (e.g. Web Portal Capture).|
----

h3. - T1056.001,  Collection, Input Capture: Keylogging , Keylogger abusing NirSoft Tools

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1056 |\2. Adversaries may log user keystrokes to intercept credentials as the user types them. Keylogging is likely to be used to acquire credentials for new access opportunities when OS Credential Dumping efforts are not effective, and may require an adversary to intercept keystrokes on a system for a substantial period of time before credentials can be successfully captured. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la utilización de herramientas de Nirsoft para la captura de input de teclado REF. https://www.first.org/resources/papers/conf2017/Advanced-Incident-Detection-and-Threat-Hunting-using-Sysmon-and-Splunk.pdf |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101401" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">\.*/stext|/scomma\.*</field>
		<description>Mitre ATT&CK T1056,  Collection, Input Capture: Keylogging , Keylogger abusing NirSoft Tools</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1114, Collection, Email Collection

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may target user email to collect sensitive information. Emails may contain sensitive data, including trade secrets or personal information, that can prove valuable to adversaries. Adversaries can collect or forward email from mail servers or clients. |

----

h3. - T1114.001, Collection, Email Collection: Local Email Collection , Creation of storage or cache files .pst or .ost

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1114.001 |\2. Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a user’s local system, such as Outlook storage or cache files. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de ficheros de tipo correo electrónico, esto puede ser indicativo de algún tipo de algún tipo de actividad maliciosa intentando recabar información de la corporativa |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101402" level="12">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandline">\.*.ost\.*|\.*.pst\.*</field>
		<description>Mitre ATT&CK T1114.001, Collection, Email Collection: Local Email Collection , Creation of storage or cache files .pst or .ost from $(win.eventdata.Image)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1114.001, Collection, Email Collection: Local Email Collection , Creation of storage or cache files .pst or .ost II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1114.001 |\2. Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a user’s local system, such as Outlook storage or cache files. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la creación de ficheros de tipo correo electrónico, esto puede ser indicativo de algún tipo de algún tipo de actividad maliciosa intentando recabar información de la corporativa |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101403" level="12">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">\.*.ost\.*|\.*.pst\.*</field>
		<description>Mitre ATT&CK T1114.001, Collection, Email Collection: Local Email Collection , Creation of storage or cache files .pst or .ost from $(win.eventdata.Image)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1123, Collection, Audio Capture

----

h3. - T1123, Collection, Audio Capture, Powershell Audio Capture cmdlet execution

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1114 |\2. An adversary can leverage a computer's peripheral devices (e.g., microphones and webcams) or applications (e.g., voice and video call services) to capture audio recordings for the purpose of listening into sensitive conversations to gather information. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la utilización del "cmdlet" de powershell para la captura de audio. |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101404" level="12">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">\.*WindowsAudioDevice-Powershell-Cmdlet\.*</field>
		<description>Mitre ATT&CK T1123, Collection, Audio Capture, Powershell Audio Capture cmdlet execution</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

--

h2.  T1560, Archive Collected Data 

{background:#dddddd}. |=. DESCRIPCIÓN |
|An adversary may compress and/or encrypt data that is collected prior to exfiltration. Compressing the data can help to obfuscate the collected data and minimize the amount of data sent over the network. Encryption can be used to hide information that is being exfiltrated from detection or make exfiltration less conspicuous upon inspection by a defender.
Both compression and encryption are done prior to exfiltration, and can be performed using a utility, 3rd party library, or custom method.|

----

h3. - T1560.001, Collection, Archive Collected Data: Archive via Utility, data compressed using powershell

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1560.001 |\2.An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities. Many utilities exist that can archive data, including 7-Zip[1], WinRAR[2], and WinZip[3]. Most utilities include functionality to encrypt and/or compress data.
Some 3rd party utilities may be preinstalled, such as tar on Linux and macOS or zip on Windows systems.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el use del powershel para comprimir archivos via rar o cmdlet|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[Firmas#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101407" level="10">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">Rar.exe|rar.exe|Compress-Archive</field>
		<description>Mitre ATT&CK T1560.001, Collection, Archive Collected Data: Archive via Utility, data compressed using powershell</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1560.001, Collection, Archive Collected Data: Archive via Utility, data compressed using command line

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1560.001 |\2.An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities. Many utilities exist that can archive data, including 7-Zip[1], WinRAR[2], and WinZip[3]. Most utilities include functionality to encrypt and/or compress data.
Some 3rd party utilities may be preinstalled, such as tar on Linux and macOS or zip on Windows systems.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el use del powershel para comprimir archivos via rar o cmdlet|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[Firmas#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101407" level="10">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">Rar.exe|rar.exe</field>
		<description>Mitre ATT&CK T1560.001, Collection, Archive Collected Data: Archive via Utility, data compressed using powershell</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. - T1005, Collection, Data from Local System

----

h3. - T1005, Collection, Data from Local System, manual copy of important registry hives

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1005 |\2. Adversaries may search local system sources, such as file systems or local databases, to find files of interest and sensitive data prior to Exfiltration.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la copia manual mediante **reg.exe** de registros importantes de los que puede extraerse información confidencial |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **2** |=. Microsoft-Windows-Sysmon/Operationa|=.  3 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100114]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101407" level="12">
		<if_sid>100114</if_sid>
		<field name="win.eventdata.commandline">save HKLM\\SAM|SAVE HKLM\\SAM|save HKLM\\SYSTEM|SAVE HKLM\\SYSTEM</field>
		<description>Mitre ATT&CK T1005, Collection, Data from Local System, manual copy of important registry hives</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Exfiltration

----

h2.  T1048, Exfiltration, Exfiltration Over Alternative Protocol

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may steal data by exfiltrating it over a different protocol than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server. |

----

h3. - T1048.003, Exfiltration, Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol outbound insecure ftp detected

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1048.003 |\2. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el tráfico generado por FTP inseguro en el puerto 21 |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101800" level="7">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">^21$</field>   
		<description>Mitre ATT&CK T1048.003, Exfiltration, Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol , outbound insecure ftp detected to $(win.eventdata.DestinationIp)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1048.003, Exfiltration, Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol , inbound insecure ftp detected
----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1048.003 |\2. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el tráfico de red generado por el puerto 21 en dirección entrante, que se corresponde con protocolo FTP inseguro|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101801" level="7">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.SourcePort">^21$</field>   
		<description>Mitre ATT&CK T1048.003, Exfiltration, Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol , inbound insecure ftp detected from $(win.eventdata.SourceIp) </description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Discovery

----

h2.  T1033, Discovery, System Owner/User Discovery

----

h3. - T1033, Discovery, System Owner/User Discovery, use of whoami via powershell

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1033 |\2. Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system, or whether a user is actively using the system. They may do this, for example, by retrieving account usernames or by using Credential Dumping. The information may be collected in a number of different ways using other Discovery techniques, because user and username details are prevalent throughout a system and include running process ownership, file/directory ownership, session information, and system logs. Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la herramienta whoami para la detección de los usuarios del sistema |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100807" level="10">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">whoami</field>
		<description>Mitre ATT&CK T1033, Discovery, System Owner/User Discovery, use of whoami via $(win.eventdata.image)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1033, Discovery, System Owner/User Discovery, use of whoami via command line

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1033 |\2. Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system, or whether a user is actively using the system. They may do this, for example, by retrieving account usernames or by using Credential Dumping. The information may be collected in a number of different ways using other Discovery techniques, because user and username details are prevalent throughout a system and include running process ownership, file/directory ownership, session information, and system logs. Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la herramienta whoami para la detección de los usuarios del sistema |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f49191}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1059 - Command-Line Interface, Ejecución de Línea de comandos|100117]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100808" level="10">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandline">whoami</field>
		<description>Mitre ATT&CK T1033, Discovery, System Owner/User Discovery, use of whoami via $(win.eventdata.image)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1087, Account Discovery

{background:#dddddd}. |=. DESCRIPCIÓN |
|Adversaries may attempt to get a listing of accounts on a system or within an environment. This information can help adversaries determine which accounts exist to aid in follow-on behavior.|

----

h3.  T1087.001, Account Discovery, Local Account

----

h4. - T1087.001, Discovery, Account Discovery, Local Account, Powershell

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1087.001 |\2.Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el use del cmdlet de powershel para la descubierta de cuentas de usuario|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4104]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60010]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100266" level="10">
		<if_sid>60010</if_sid>
		<field name="win.system.eventID">^4104$</field>
		<field name="win.eventdata.ScriptBlockText">(\.*)Get-(\.*)</field>
		<description>Mitre ATT&CK T1087.001, Discovery, Account Discovery, Local Account, Powershell</description>
		<options>no_full_log</options>
		<group> MITRE ATT&CK, </group>
	</rule>
</code></pre>

----

h4. - T1087.001, Discovery, Account Discovery, Local Account, A security-enabled local group membership was enumerated

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1087.001 |\2.Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el la enumeración de grupos de usuario mediante el evento 4799 del registro de windows|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##b3b6f8}. **3** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4799]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
    <rule id="100260" level="3">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4799$</field>
		<description>Mitre ATT&CK T1087.001, Discovery, Account Discovery, Local Account, A security-enabled local group membership was enumerated</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1087.001, Discovery, Account Discovery, Local Account, Various security-enabled local group membership was enumerated

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1087.001 |\2.Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el la enumeración repetida de grupos de usuario mediante el evento 4799 del registro de windows|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f4f491}. **6** |=. Microsoft-Windows-Security-Auditing|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[Firmas#- T1087.001, Discovery, Account Discovery, Local Account, A security-enabled local group membership was enumerated|100260]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100261" timeframe="20" frequency="3" level="6">
		<if_matched_sid>100260</if_matched_sid>
		<same_field>win.system.computer</same_field>
		<description>Mitre ATT&CK T1087.001, Discovery, Account Discovery, Local Account, Various security-enabled local group membership was enumerated</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1087.001, Discovery, Account Discovery, Local Account, A handle to an object was requested, Audit SAM

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1087.001 |\2.Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 4661 de windows, referente a solicitudes sobre manejadores de objetos relativos a cuentas de usuario, **El evento 4661 es muy ruidoso y por lo tanto se desaconseja el habilitarlo**|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4661]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100262" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4661$</field>
		<field name="win.eventdata.SourceUserName">(\.*)\$</field>
		<field name="win.eventdata.ObjectName">(\.*)S-1-5-21-(\.*)-512|502|500|505|519|520|544|551|555(\.*)</field>
		<description>Mitre ATT&CK T1087.001, Discovery, Account Discovery, Local Account, A handle to an object was requested, Audit SAM</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1087.001, Discovery, Account Discovery, Local Account, A handle to an object was requested, known privileged AD accounts/groups enumeration

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1087.001 |\2.Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el evento 4661 de windows, referente a solicitudes sobre manejadores de objetos relativos a cuentas de usuario y grupos conocidaos, **El evento 4661 es muy ruidoso y por lo tanto se desaconseja el habilitarlo**|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4661]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100263" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^4661$</field>
		<field name="win.eventdata.ObjectType">(\.*)SAM(\.*)</field> 
		<description>Mitre ATT&CK T1087.001, Discovery, Account Discovery, Local Account, A handle to an object was requested, known privileged AD accounts/groups enumeration</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h4. - T1087.001, Discovery, Account Discovery, Local Account, Detects execution of Net.exe whether suspicious or benign

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1087.001 |\2.Adversaries may attempt to get a listing of local system accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del comando net para la descubierta de usuarios o grupos del sistema|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:##f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100801" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\net.exe||\\net1.exe</field>
		<field name="win.eventdata.commandline">group||localgroup||user||view||accounts||use</field>
		<description>Mitre ATT&CK T1087.001, Discovery, Account Discovery, Local Account, Detects execution of Net.exe whether suspicious or benign</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1087.002, Discovery, Account Discovery: Domain Account, use of adfind to enumerate domain users

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1087.002 |\2. Adversaries may attempt to get a listing of domain accounts. This information can help adversaries determine which domain accounts exist to aid in follow-on behavior.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario adfind.exe para la enumeración de usuarios de dominio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100118]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100810" level="7">
		<if_sid>100118</if_sid>
		<field name="win.eventdata.commandline">-f \(objectcategory=person\)</field>
		<description>Mitre ATT&CK T1087.002, Discovery, Account Discovery: Domain Account, use of adfind to enumerate domain users</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1135, Discovery, Network Share Discovery

----

h3. - T1135, Discovery, Network Share Discovery, Detects execution of Net.exe whether suspicious or benign

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1135 |\2. Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario **net.exe** |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operationa|=.  Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100802" level="7">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.parentImage">\\net.exe||\\net1.exe</field>
		<field name="win.eventdata.commandline">share</field>
		<description>Mitre ATT&CK T1135, Discovery, Network Share Discovery, Detects execution of Net.exe whether suspicious or benign</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1135, Discovery, Network Share Discovery, use of net view or net share to enumerate shares

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1135 |\2. Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.  |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario **net.exe** |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operationa|=.  Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100806" level="10">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.image">\\cmd.exe|\\powershell.exe</field>
		<field name="win.eventdata.commandline">net view|net share</field>
		<description>Mitre ATT&CK T1135, Discovery, Network Share Discovery, use of net view or net share to enumerate shares</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1057, Discovery, Process Discovery

----

h3. - T1057, Discovery, Process Discovery, use of tasklist or gpprocess qprocess.exe to enumerate process

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1057 |\2. Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network. Adversaries may use the information from Process Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de los binarios tasklist.exe y qprocess.exe para la enumeración de procesos |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **5** |=. Microsoft-Windows-Sysmon/Operationa|=.  Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100809" level="5">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.Image">tasklist.exe|qprocess.exe</field>
		<description>Mitre ATT&CK T1057, Discovery, Process Discovery, use of tasklist or gpprocess qprocess.exe to enumerate process</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1018, Discovery, Remote System Discovery

----

h3. - T1018, Discovery, Remote System Discovery, use of adfind to enumerate systems

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1018 |\2. dversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario adfind.exe para la enumeración de systemas en el de dominio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100118]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100811" level="7">
		<if_sid>100118</if_sid>
		<field name="win.eventdata.commandline">-f \(objectcategory=computer\)</field>
		<description>Mitre ATT&CK T1018, Discovery, Remote System Discovery, use of adfind to enumerate systems</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1018, Discovery, Remote System Discovery, use of net to enumerate systems

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1018 |\2. dversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario net.exe para la enumeración de systemas en el de dominio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100119]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100812" level="7">
		<if_sid>100119</if_sid>
		<field name="win.eventdata.commandline">view</field>
		<description>Mitre ATT&CK T1018, Discovery, Remote System Discovery, use of net to enumerate systems</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1482, Discovery, Domain Trust Discovery

----

h3. - T1482, Discovery, Domain Trust Discovery, use of adfind to enumerate domain organizational units

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1482 |\2. Adversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario adfind.exe para la enumeración de Organizational Units de dominio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100118]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
<rule id="100813" level="7">
		<if_sid>100118</if_sid>
		<field name="win.eventdata.commandline">-f \(objectcategory=organizationalUnit\)</field>
		<description>Mitre ATT&CK T1482, Discovery, Domain Trust Discovery, use of adfind to enumerate domain organizational units</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1482, Discovery, Domain Trust Discovery, use of adfind to enumerate domain organizational units II

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1482 |\2. Adversaries may attempt to gather information on domain trust relationships that may be used to identify lateral movement opportunities in Windows multi-domain/forest environments.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario adfind.exe para la enumeración de Organizational Units de dominio|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100118]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100814" level="7">
		<if_sid>100118</if_sid>
		<field name="win.eventdata.commandline">-gcb</field>
		<description>Mitre ATT&CK T1482, Discovery, Domain Trust Discovery, use of adfind to enumerate domain organizational units</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1016, Discovery, System Network Configuration Discovery

----

h3. - T1016, Discovery, System Network Configuration Discovery, use of adfind to enumerate subnetworks

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1016 |\2. Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario adfind.exe para la enumeración de subredes de la organización|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100118]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100815" level="7">
		<if_sid>100118</if_sid>
		<field name="win.eventdata.commandline">-f \(objectcategory=subnet\)</field>
		<description>Mitre ATT&CK T1016, Discovery, System Network Configuration Discovery, use of adfind to enumerate subnetworks</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2. T1069, Discovery, Permission Groups Discovery

----

h3. - T1069.002, Discovery, Permission Groups Discovery: Domain Groups, use of binary net.exe to discover groups

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1069.002 |\2. Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario net.exe para la enumeración de subredes de la organización|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f4f491}. **7** |=. Microsoft-Windows-Sysmon/Operational|=. Sysmon_event 1 |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100119]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100816" level="7">
		<if_sid>100119</if_sid>
		<field name="win.eventdata.commandline">group|localgroup</field>
		<description>Mitre ATT&CK T1069.002, Discovery, Permission Groups Discovery: Domain Groups, use of binary net.exe to discover groups</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. Command And Control

----

h2.  T1090, Command and Control, Connection Proxy

----

h3. - T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza los logins de tipo RemoteInteractive hacia localhost |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60106]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100240" level="10">
		<if_sid>60106</if_sid>
		<field name="win.system.eventID">^4624$</field>
		<field name="win.eventdata.LogonType">10</field>
		<field name="win.eventdata.IpAddress">127.0.0.1</field>
		<description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza los eventos de acceso RDP hacia localhost |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 4624]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60106]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100241" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5156$</field>
		<field name="win.eventdata.DestPort">^3389$</field>
		<field name="win.eventdata.SourceAddress">127.0.0.1</field>
		<description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza los eventos de conexiones desde y hacia localhost |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
<rule id="100701" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.SourceIp">127.\.*|::1</field>
		<field name="win.eventdata.DestinationIp">127.\.*|::1</field>   
		<description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----


h3. - T1090, Command and Control, Connection Proxy, RDP & SMB Tunneling using SECFORCE/Tunna

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el comportamiento de la herramienta SECFORCE/Tunna de creción de túneles via HTTP REF. https://github.com/SECFORCE/Tunna |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100702" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.Image">(\.*)\\w3wp.exe</field>
		<field name="win.eventdata.DestinationPort">^3389$|^445$</field>
		<field name="win.eventdata.DestinationIp">127.\.*|::1</field>   
		<description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP & SMB Tunneling using SECFORCE/Tunna</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090, Command and Control, Connection Proxy, traffic with destination to kwown TOR ports

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las conexiones a puertos usados por la red tor |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100703" level="12">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">^1723$|^9001$|^9030$</field>   
		<description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, traffic with destination to kwown TOR ports</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de powershell con comandos que inician conexiones hacia localhost |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1086 - Execution, PowerShell, Powershell or Script Execution|100113]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100704" level="7">
		<if_sid>100113</if_sid>
		<field name="win.eventdata.commandline">connectaddress=127\.0\.0\.1</field>   
		<description>Mitre ATT&CK T1090, Command and Control, Connection Proxy, RDP Tunneling via SSH</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1090, Command and Control, Connection Proxy, RDP Port fordwarding via netsh

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1090 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de netsh para conexión por RDP |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 1]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100906" level="12">
		<if_group>sysmon_event1</if_group>
		<field name="win.eventdata.CommandLine">\.*netsh\.*connectp=3389\.*</field>
		<description>Mitre ATT&CK T1090, Defense Evasion, Connection Proxy, RDP Port fordwarding via netsh</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1219, Command and Control, Remote Access Tools

----

h3. - T1219, Command and Control, Remote Access Tools, IRC Traffic

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1219 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las conexiones aceptadas a puertos IRC|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5156]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100242" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5156$</field>
		<field name="win.eventdata.DestPort">^6667$</field>
		<description>Mitre ATT&CK T1219, Command and Control, Remote Access Tools, IRC Traffic</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1219, Command and Control, Remote Access Tools, Teamviewer Traffic

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1219 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las conexiones aceptadas a puertos TEAMVIEWER|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5156]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100244" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5156$</field>
		<field name="win.eventdata.DestPort">^5938$</field>
		<description>Mitre ATT&CK T1219, Command and Control, Remote Access Tools, Teamviewer Traffic</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1219, Command and Control, Remote Access Tools, Go2assist/LogMeIn Traffic

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1219 |\2. Adversaries may use a connection proxy to direct network traffic between systems or act as an intermediary for network communications to a command and control server to avoid direct connections to their infrastructure. Many tools exist that enable traffic redirection through proxies or port redirection, including HTRAN, ZXProxy, and ZXPortMap. [1] Adversaries use these types of proxies to manage command and control communications, to reduce the number of simultaneous outbound network connections, to provide resiliency in the face of connection loss, or to ride over existing trusted communications paths between victims to avoid suspicion.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza las conexiones aceptadas a puertos como Go2assist/LogMeIn|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Security-Auditing|=. [[Modelo de datos#1.1.Eventos de windows | 5156]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[60103]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100245" level="10">
		<if_sid>60103</if_sid>
		<field name="win.system.eventID">^5156$</field>
		<field name="win.eventdata.DestPort">^8200$</field>
		<description>Mitre ATT&CK T1219, Command and Control, Remote Access Tools, Go2assist/LogMeIn Traffic</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1043, Command and Control, Commonly Used Port

----

h3. - T1043, Command and Control, Commonly Used Port, connection to known ports

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1043 |\2. Adversaries may communicate over a commonly used port to bypass firewalls or network detection systems and to blend with normal network activity to avoid more detailed inspection. They may use commonly open ports such as
    TCP:80 (HTTP)
    TCP:443 (HTTPS)
    TCP:25 (SMTP)
    TCP/UDP:53 (DNS)|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza conexiones a puertos conocidos|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 3]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100709" level="3">
		<if_group>sysmon_event3</if_group>
		<field name="win.eventdata.DestinationPort">^80$|^443$|^53$|^135$</field>   
		<description>Mitre ATT&CK T1043, Command and Control, Commonly Used Port, connection to $(win.eventdata.DestinationPort)</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1092, Command And Control, Communication Through Removable Media

----

h3. - T1092, Command And Control, Communication Through Removable Media, mounted USB

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1092 |\2.Adversaries can perform command and control between compromised hosts on potentially disconnected networks using removable media to transfer commands from system to system. Both systems would need to be compromised, with the likelihood that an Internet-connected system was compromised first and the second through lateral movement by Replication Through Removable Media. Commands and files would be relayed from the disconnected system to the Internet-connected system to which the adversary has direct access.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza la enrada de registro que se modifica a cuando se insertan unidades usb|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **0** |=. Microsoft-Windows-Sysmon/Operational|=. [[Modelo de datos#1.2.Eventos Sysmon|Sysmon 12]] |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100710" level="0">
		<if_group>sysmon_event_12</if_group>
		<field name="win.eventdata.TargetObject">SYSTEM\\\\CurrentControlSet\\\\Enum\\\\USB\\\\</field>
		<description>Mitre ATT&CK T1092, Command And Control, Communication Through Removable Media, mounted USB</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1092, Command And Control, Communication Through Removable Media, mounted USB

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1092 |\2.Adversaries can perform command and control between compromised hosts on potentially disconnected networks using removable media to transfer commands from system to system. Both systems would need to be compromised, with the likelihood that an Internet-connected system was compromised first and the second through lateral movement by Replication Through Removable Media. Commands and files would be relayed from the disconnected system to the Internet-connected system to which the adversary has direct access.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el montado de unidades usb|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#b3b6f8}. **3** |=. Microsoft-Windows-Sysmon/Operational|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[#- T1092, Command And Control, Communication Through Removable Media, mounted USB|100710]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100711" level="3">
		<if_sid>100710</if_sid>
		<field name="win.eventdata.TargetObject">\\\\Device Parameters\\\\Ceip\\\\DeviceInformation</field>
		<description>Mitre ATT&CK T1092, Command And Control, Communication Through Removable Media, mounted USB</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h2.  T1105, Lateral movement, Ingress Tool Transfer

----

h3. - T1105, Lateral Movement, Ingress Tool Transfer, Detetcs a suspicious Microsoft certutil execution with sub commands

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1105 |\2. Adversaries may transfer tools or other files from an external system into a compromised environment. Files may be copied from an external adversary controlled system through the command and control channel to bring tools into the victim network or through alternate protocols with another tool such as FTP. Files can also be copied over on Mac and Linux with native tools like scp, rsync, and sftp. |
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso de la herramienta certutil para la copia remota o decarga de ficheros|
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **12** |=. N/A|=. N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[100504]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="100504" level="12">
		<if_sid>100105</if_sid>
		<field name="win.eventdata.commandline">URL||urlcache||ping</field>
		<description>Mitre ATT&CK T1105, Command And Control , Ingress Tool Transfer, Detetcs a suspicious Microsoft certutil execution with sub commands</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. IMPACT

h2.  T1489, Impact, Service Stop

----

h3. - T1489, Impact, Service Stop, Service stopped with SC.EXE

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1489 |\2. Adversaries may stop or disable services on a system to render those services unavailable to legitimate users. Stopping critical services can inhibit or stop response to an incident or aid in the adversary's overall objectives to cause damage to the environment.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario sc.exe (service control) para parar servicios |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
|[[61603]]|||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101503" level="10">
		<if_sid>61603</if_sid>
		<field name="win.eventdata.commandline">\.*sc.exe\.* stop\.*|\.*sc\.* stop\.*|\.*sc.exe\.*config *disabled\.*|\.*sc\.*config *disabled\.*</field>
		<description>Mitre ATT&CK T1489, Impact, Service Stop, Service stopped with SC.EXE</description>
		<options>no_full_log</options>
	</rule>	
</code></pre>

----

h3. - T1489, Impact, Service Stop, Stop service using net.exe

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1489 |\2. Adversaries may stop or disable services on a system to render those services unavailable to legitimate users. Stopping critical services can inhibit or stop response to an incident or aid in the adversary's overall objectives to cause damage to the environment.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario net.exe para parar servicios |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101703" level="10">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandline">net.exe stop</field>
		<description>Mitre ATT&CK T1489, Impact, Service Stop, Stop service using net.exe</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h3. - T1489, Impact, Service Stop, Stop service by killing process

----

{background:#dddddd}. |=. ID |=. DESCRIPCIÓN ||
| T1489 |\2. Adversaries may stop or disable services on a system to render those services unavailable to legitimate users. Stopping critical services can inhibit or stop response to an incident or aid in the adversary's overall objectives to cause damage to the environment.|
{background:#dddddd}. |\3=. EXPLICACIÓN |
|\3. Esta firma monitoriza el uso del binario taskkill.exe |
{background:#dddddd}. |=. Nivel |=.Origen|=. ID Evento |
|={background:#f6bb7f}. **10** |=. Microsoft-Windows-Sysmon/Operational|=.  N/A |
{background:#dddddd}. |\3=. Firmas Relacionadas |
{background:#dddddd}. |=. Dependientes |=. Subordinadas | |
||||
{background:#dddddd}. |\3=. CÓDIGO |

<pre><code class="xml">
	<rule id="101704" level="12">
		<if_sid>100117</if_sid>
		<field name="win.eventdata.commandline">taskkill.exe</field>
		<description>Mitre ATT&CK T1489, Impact, Service Stop, Stop service by killing process</description>
		<options>no_full_log</options>
	</rule>
</code></pre>

----

h1. -Anexo A - Tabla de niveles

{background:#dddddd}. ||\8=. Niveles||
|{background:#dddddd}. *|\2/2={background:#b3b6f8}.0|\2/2={background:#f4f491}.5|\2/2={background:#f6bb7f}.10|\2/2={background:#f49191}.15|{background:#dddddd}. * |
{background:#dddddd}. | * | * |
{background:#dddddd}. | |\2. Bajo |\2. Medio |\2. Alto |\2. Crítico | |

----